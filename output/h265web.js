!function e(t,r,i){function a(s,o){if(!r[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var _=new Error("Cannot find module '"+s+"'");throw _.code="MODULE_NOT_FOUND",_}var d=r[s]={exports:{}};t[s][0].call(d.exports,(function(e){return a(t[s][1][e]||e)}),d,d.exports,e,t,r,i)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}({1:[function(e,t,r){var i,a,n=t.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function l(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{a="function"==typeof clearTimeout?clearTimeout:o}catch(e){a=o}}();var _,d=[],u=!1,c=-1;function h(){u&&_&&(u=!1,_.length?d=_.concat(d):c=-1,d.length&&f())}function f(){if(!u){var e=l(h);u=!0;for(var t=d.length;t;){for(_=d,d=[];++c<t;)_&&_[c].run();c=-1,t=d.length}_=null,u=!1,function(e){if(a===clearTimeout)return clearTimeout(e);if((a===o||!a)&&clearTimeout)return a=clearTimeout,clearTimeout(e);try{return a(e)}catch(t){try{return a.call(null,e)}catch(t){return a.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function m(){}n.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];d.push(new p(e,t)),1!==d.length||u||l(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=m,n.addListener=m,n.once=m,n.off=m,n.removeListener=m,n.removeAllListeners=m,n.emit=m,n.prependListener=m,n.prependOnceListener=m,n.listeners=function(e){return[]},n.binding=function(e){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(e){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],2:[function(e,t,r){const i=window.AudioContext||window.webkitAudioContext,a=e("../consts"),n=e("../av-common");t.exports=class{constructor(e={}){this.options={sampleRate:e.sampleRate||a.DEFAULT_SAMPLERATE,appendType:e.appendType||a.APPEND_TYPE_STREAM,playMode:e.playMode||a.AUDIO_MODE_SWAP},this.sourceChannel=-1,this.audioCtx=new i({latencyHint:"interactive",sampleRate:e.sampleRate}),this.gainNode=null,this.sourceList=[],this.startStatus=!1,this.sampleQueue=[],this.nextBuffer=null,this.playTimestamp=0,this.playTimestampDurMs=0,this.playStartTime=0,this.durationMs=-1,this._player_playbackRate=1,this.buffer_interval=null,this.isLIVE=!1,this.voice=1,this.onLoadCache=null,this.onPlayCallback=null}build(){let e=this;this.sourceList.push(this.audioCtx.createBufferSource()),this.sourceList.push(this.audioCtx.createBufferSource()),this.sourceList.forEach((t=>{t&&t.playbackRate&&(t.playbackRate.value,e._player_playbackRate,t.playbackRate.value=e._player_playbackRate)})),this.sourceList[0].onended=function(){e.swapSource(0,1)},this.sourceList[1].onended=function(){e.swapSource(1,0)},this.gainNode=this.audioCtx.createGain(),this.gainNode.gain.value=this.voice,this.gainNode.connect(this.audioCtx.destination),this._player_playbackRate=1,this.options,this.runNextBuffer()}resetStartParam(){this.playTimestamp=0,this.playStartTime=0,this._player_playbackRate=1}setOnLoadCache(e){this.onLoadCache=e}setDurationMs(e=-1){this.durationMs=e}setPlaybackRate(e=1){this._player_playbackRate=e,this.gainNode&&this._player_playbackRate>0&&(this._player_playbackRate,this.sourceList,this.sourceList.forEach((e=>{e&&e.playbackRate&&(e.playbackRate.value,this._player_playbackRate,e.playbackRate.value=this._player_playbackRate)})))}setVoice(e=1){this.voice=e,this.gainNode.gain.value=e}getAlignVPTS(){return this.playTimestamp+(n.GetMsTime()-this.playStartTime)/1e3}getTimestamp(){return this.playTimestamp}getTimestampMs(){return 1e3*this.playTimestamp}getTimestampDurMs(){return this.playTimestampDurMs}check_with_video_pts_ms(e=-1){let t=-1;for(;this.sampleQueue.length>0&&(t=1e3*this.sampleQueue[0].pts,t<e);){let e=this.sampleQueue.shift();e.data=null,e=null}return!0}swapSource(e=-1,t=-1){if(0==this.startStatus)return-1;if(e<0||e>=this.sourceList.length)return-1;if(t<0||t>=this.sourceList.length)return-1;try{this.sourceChannel===e&&null!==this.sourceList[e]&&(this.sourceList[e].disconnect(this.gainNode),this.sourceList[e]=null)}catch(t){console.error("[DEFINE ERROR] this disconnect source Index:"+e+" error happened!",t)}this.sourceChannel=t;let r=this.decodeSample(t,e);return-2==r&&this.isLIVE&&(this.getAlignVPTS()>=this.durationMs/1e3-.04?this.pause():null!==this.onLoadCache&&this.onLoadCache()),r}addSample(e=null){return!(null==e||!e||null==e)&&(0==this.sampleQueue.length&&(this.seekPos=e.pts),this.sampleQueue.push(e),!0)}getSampleQueueLen(){return this.sampleQueue.length}runNextBuffer(){let e=this;this.buffer_interval&&(clearInterval(this.buffer_interval),buffer_interval=null),this.buffer_interval=window.setInterval((()=>{if(null!=e.nextBuffer||e.sampleQueue.length<a.DEFAULT_CONSU_SAMPLE_LEN)return;e.nextBuffer={data:null,pts:-1,duration_ms:-1};let t=null;const r=Math.min(e.sampleQueue.length,a.DEFAULT_CONSU_SAMPLE_LEN);for(let i=0;i<r;i++){t=e.sampleQueue.shift();let n=null;if(n=e.options.appendType==a.APPEND_TYPE_STREAM?t:t.data,0===i?e.nextBuffer.pts=t.pts:i===r-1&&(e.nextBuffer.duration_ms=Math.round((t.pts-e.nextBuffer.pts)*(r/(r-1))*1e3)),null==e.nextBuffer.data)e.nextBuffer.data=new Uint8Array(n);else{let t=new Uint8Array(n.length+e.nextBuffer.data.length);t.set(e.nextBuffer.data,0),t.set(n,e.nextBuffer.data.length),e.nextBuffer.data=t}if(e.sampleQueue.length<=0)break;t=null}}),10)}decodeSample(e=-1,t=-1){let r=this;if(e<0||e>=this.sourceList.length)return-1;if(null!=this.sourceList[e]&&null!=this.sourceList[e]&&this.sourceList[e]||(this.sourceList[e]=this.audioCtx.createBufferSource(),this.sourceList.forEach((e=>{e&&e.playbackRate&&(e.playbackRate.value=r._player_playbackRate)})),this.sourceList[e].onended=function(){r.swapSource(e,t)}),0==this.sampleQueue.length)return this.isLIVE?(this.sourceList[e].connect(this.gainNode),this.sourceList[e].start(),this.sourceList[e].onended=function(){r.swapSource(e,t)},this.sourceList[e].stop(),0):-2;if(this.sourceList[e].buffer)return this.swapSource(e,t),0;if(null==this.nextBuffer||this.nextBuffer.data.length<1)return"running"==this.sourceList[e].context.state&&(this.sourceList[e].connect(this.gainNode),this.sourceList[e].start(),this.sourceList[e].startState=!0,this.sourceList[e].stop()),1;const i=this.nextBuffer.data.buffer;this.playTimestamp=this.nextBuffer.pts,this.playTimestampDurMs=this.nextBuffer.duration_ms,this.onPlayCallback(this.playTimestamp),this.playStartTime=n.GetMsTime();const a=new Uint8Array(i.slice(0,10));try{this.audioCtx.decodeAudioData(i,(function(t){null!==r.sourceList[e]&&(r.sourceList[e].buffer=t,r.sourceList[e].connect(r.gainNode),r.sourceList[e].start(),r.sourceList[e].startState=!0)}),(function(e){console.error("Error this with decoding audio data",e),console.error("Audio header error(HEX):",Array.from(a).map((e=>e.toString(16).padStart(2,"0"))).join(" ")),(255!==a[0]||240&~a[1])&&console.error(" Audio header error! Might caused by wrong adts header bytes data")}))}catch(e){return r.nextBuffer=null,-3}return this.nextBuffer=null,0}decodeWholeSamples(e=-1){let t=this;if(this.sourceChannel=e,e<0||e>=this.sourceList.length)return-1;if(null!=this.sourceList[e]&&null!=this.sourceList[e]&&this.sourceList[e]||(this.sourceList[e]=this.audioCtx.createBufferSource(),this.sourceList.forEach((e=>{e&&e.playbackRate&&(e.playbackRate.value,t._player_playbackRate,e.playbackRate.value=t._player_playbackRate)})),this.sourceList[e].onended=function(){}),0==this.sampleQueue.length)return-2;let r=null,i=null;for(let e=0;e<this.sampleQueue.length;e++){i=this.sampleQueue.shift();let e=null;if(e=this.options.appendType==a.APPEND_TYPE_STREAM?i:i.data,null==r)r=new Uint8Array(e);else{let t=new Uint8Array(e.length+r.length);t.set(r,0),t.set(e,r.length),r=t}if(this.sampleQueue.length<=0)break;i=null}let n=r;if(null==n||n.length<1)return this.sourceList[e].connect(this.gainNode),this.sourceList[e].start(),this.sourceList[e].stop(),1;let s=n.buffer;try{this.audioCtx.decodeAudioData(s,(function(r){t.sourceList[e].state,t.sourceList[e].buffer=r,t.sourceList[e].connect(t.gainNode),t.sourceList[e].start(),t.sourceList[e].startState=!0,t.sourceList[e].state}),(function(e){e.err}))}catch(e){return console.error("Crash[brower]! Please refresh your page"),-3}return 0}play(){if(this.startStatus,this.options.playMode,a.AUDIO_MODE_ONCE,0==this.startStatus){this.startStatus=!0;let e=0;e=this.options.playMode==a.AUDIO_MODE_ONCE?this.decodeWholeSamples(0):this.swapSource(0,1),-2==e&&this.pause()}}pause(){this.startStatus=!1;for(let e=0;e<this.sourceList.length;e++)if(void 0!==this.sourceList[e]&&null!==this.sourceList[e]){this.sourceList[e],this.gainNode;try{void 0!==this.sourceList[e].buffer&&null!==this.sourceList[e].buffer&&(this.sourceList[e].stop(),this.sourceList[e].disconnect(this.gainNode)),this.sourceList[e]=null}catch(e){console.error("audio pause error ",e)}}}stop(){this.pause(),this.buffer_interval&&(clearInterval(this.buffer_interval),this.buffer_interval=null),this.cleanQueue(),this.nextBuffer=null,this.sourceChannel=-1}cleanQueue(){this.sampleQueue.length=0;for(let e=0;e<this.sourceList.length;e++)try{void 0!==this.sourceList[e].buffer&&null!==this.sourceList[e].buffer&&(this.sourceList[e].stop(),this.sourceList[e].disconnect(this.gainNode)),this.sourceList[e]=null}catch(e){}}}},{"../av-common":4,"../consts":5}],3:[function(e,t,r){const i=window.AudioContext||window.webkitAudioContext,a=e("../consts"),n=e("../av-common");t.exports=()=>{let e={options:{sampleRate:a.DEFAULT_SAMPLERATE,appendType:a.APPEND_TYPE_FRAME,playMode:a.AUDIO_MODE_SWAP},sourceChannel:-1,audioCtx:new i({latencyHint:"interactive",sampleRate:a.DEFAULT_SAMPLERATE}),gainNode:null,sourceList:[],startStatus:!1,sampleQueue:[],nextBuffer:null,playTimestamp:0,playTimestampDurMs:0,playStartTime:0,durationMs:-1,isLIVE:!1,voice:1,onLoadCache:null,resetStartParam:()=>{e.playTimestamp=0,e.playStartTime=0},setOnLoadCache:t=>{e.onLoadCache=t},setDurationMs:(t=-1)=>{e.durationMs=t},setVoice:(t=1)=>{e.voice=t,e.gainNode.gain.value=t},getAlignVPTS:()=>e.playTimestamp+(n.GetMsTime()-e.playStartTime)/1e3,swapSource:(t=-1,r=-1)=>{if(0==e.startStatus)return null;if(t<0||t>=e.sourceList.length)return null;if(r<0||r>=e.sourceList.length)return null;try{e.sourceChannel===t&&null!==e.sourceList[t]&&(e.sourceList[t].disconnect(e.gainNode),e.sourceList[t]=null)}catch(e){console.error("[DEFINE ERROR] audioPcmModule disconnect source Index:"+t+" error happened!",e)}e.sourceChannel=r;let i=e.decodeSample(r,t);-2==i&&e.isLIVE&&(e.getAlignVPTS()>=e.durationMs/1e3-.04?e.pause():null!==e.onLoadCache&&e.onLoadCache())},addSample:(t=null)=>!(null==t||!t||null==t)&&(0==e.sampleQueue.length&&(e.seekPos=t.pts),e.sampleQueue.push(t),e.sampleQueue.length,!0),getTimestamp:()=>e.playTimestamp,getTimestampMs:()=>1e3*e.playTimestamp,getTimestampDurMs:()=>e.playTimestampDurMs,getSampleQueueLen:()=>e.sampleQueue.length,check_with_video_pts_ms:(t=-1)=>{let r=-1;for(;e.sampleQueue.length>0&&(r=1e3*e.sampleQueue[0].pts,r<t);){let t=e.sampleQueue.shift();t.data=null,t=null}return!0},runNextBuffer:()=>{window.setInterval((()=>{if(null!=e.nextBuffer&&e.nextBuffer.duration_ms>=a.DEFAULT_CONSU_SAMPLE_DUR)return;e.nextBuffer={data:null,pts:-1,duration_ms:0};let t=null,r=0;for(null!=e.nextBuffer&&(r=e.nextBuffer.duration_ms);r<a.DEFAULT_CONSU_SAMPLE_DUR&&(t=e.sampleQueue.shift(),null!=t);){let i=null;if(i=e.options.appendType==a.APPEND_TYPE_STREAM?new Float32Array(t.buffer):new Float32Array(t.data.buffer),e.nextBuffer.pts<0&&(e.nextBuffer.pts=t.pts),null==e.nextBuffer.data)e.nextBuffer.data=i;else{let t=new Float32Array(i.length+e.nextBuffer.data.length);t.set(e.nextBuffer.data,0),t.set(i,e.nextBuffer.data.length),e.nextBuffer.data=t}if(e.nextBuffer.duration_ms=e.nextBuffer.data.length/44100,r=e.nextBuffer.duration_ms,e.sampleQueue.length<=0)break;t=null}if(e.nextBuffer&&e.nextBuffer.data){e.nextBuffer.data.length}}),10)},decodeSample:(t=-1,r=-1)=>{if(t<0||t>=e.sourceList.length)return-1;if(null!=e.sourceList[t]&&null!=e.sourceList[t]&&e.sourceList[t]||(e.sourceList[t]=e.audioCtx.createBufferSource(),e.sourceList[t].onended=function(){e.swapSource(t,r)}),0==e.sampleQueue.length)return e.isLIVE?(e.sourceList[t].connect(e.gainNode),e.sourceList[t].start(),e.sourceList[t].onended=function(){e.swapSource(t,r)},e.sourceList[t].stop(),0):-2;if(e.sourceList[t].buffer)return e.swapSource(t,r),0;if(!e.nextBuffer||!e.nextBuffer.data||e.nextBuffer.data.length<1)return e.sourceList[t].connect(e.gainNode),e.sourceList[t].start(),e.sourceList[t].startState=!0,e.sourceList[t].stop(),1;const i=e.nextBuffer.data;e.playTimestamp=e.nextBuffer.pts,e.playTimestampDurMs=e.nextBuffer.duration_ms,e.playStartTime=n.GetMsTime(),e.nextBuffer.data,e.playTimestamp;try{const r=e.audioCtx.createBuffer(1,i.length,e.options.sampleRate);r.copyToChannel(i,0),null!==e.sourceList[t]&&(e.sourceList[t].buffer=r,e.sourceList[t].connect(e.gainNode),e.sourceList[t].start(),e.sourceList[t].startState=!0)}catch(t){return e.nextBuffer=null,-3}return e.nextBuffer=null,0},decodeWholeSamples:(t=-1)=>{if(e.sourceChannel=t,t<0||t>=e.sourceList.length)return-1;if(null!=e.sourceList[t]&&null!=e.sourceList[t]&&e.sourceList[t]||(e.sourceList[t]=e.audioCtx.createBufferSource(),e.sourceList[t].onended=function(){}),0==e.sampleQueue.length)return-2;let r=null,i=null;for(let t=0;t<e.sampleQueue.length;t++){i=e.sampleQueue.shift();let t=null;if(t=e.options.appendType==a.APPEND_TYPE_STREAM?i:i.data,null==r)r=new Uint8Array(t);else{let e=new Uint8Array(t.length+r.length);e.set(r,0),e.set(t,r.length),r=e}if(e.sampleQueue.length<=0)break;i=null}let n=r;if(null==n||n.length<1)return e.sourceList[t].connect(e.gainNode),e.sourceList[t].start(),e.sourceList[t].stop(),1;let s=n.buffer;try{const r=e.audioCtx.createBuffer(1,s.byteLength,e.options.sampleRate);r.copyToChannel(s,0),e.sourceList[t].buffer=r,e.sourceList[t].connect(e.gainNode),e.sourceList[t].start(),e.sourceList[t].startState=!0}catch(e){return console.error("Crash[brower]! Please refresh your page"),-3}return 0},play:()=>{if(0==e.startStatus){e.startStatus=!0;let t=0;t=e.options.playMode==a.AUDIO_MODE_ONCE?e.decodeWholeSamples(0):e.swapSource(0,1),-2==t&&e.pause()}},pause:()=>{e.startStatus=!1;for(let t=0;t<e.sourceList.length;t++)if(void 0!==e.sourceList[t]&&null!==e.sourceList[t]){e.sourceList[t],e.gainNode;try{void 0!==e.sourceList[t].buffer&&null!==e.sourceList[t].buffer&&(e.sourceList[t].stop(),e.sourceList[t].disconnect(e.gainNode)),e.sourceList[t]=null}catch(e){console.error("audio pause error ",e)}}},stop:()=>{e.pause(),e.cleanQueue(),e.nextBuffer=null,e.sourceChannel=-1},cleanQueue:()=>{e.sampleQueue.length=0;for(let t=0;t<e.sourceList.length;t++)try{void 0!==e.sourceList[t].buffer&&null!==e.sourceList[t].buffer&&(e.sourceList[t].stop(),e.sourceList[t].disconnect(e.gainNode)),e.sourceList[t]=null}catch(e){}}};return e.sourceList.push(e.audioCtx.createBufferSource()),e.sourceList.push(e.audioCtx.createBufferSource()),e.sourceList[0].onended=function(){e.swapSource(0,1)},e.sourceList[1].onended=function(){e.swapSource(1,0)},e.gainNode=e.audioCtx.createGain(),e.gainNode.gain.value=e.voice,e.gainNode.connect(e.audioCtx.destination),e.options,e.runNextBuffer(),e}},{"../av-common":4,"../consts":5}],4:[function(e,t,r){const i=e("./consts"),a=[{format:"mp4",value:"mp4",core:i.PLAYER_CORE_TYPE_CNATIVE},{format:"mov",value:"mp4",core:i.PLAYER_CORE_TYPE_CNATIVE},{format:"mkv",value:"mp4",core:i.PLAYER_CORE_TYPE_CNATIVE},{format:"flv",value:"flv",core:i.PLAYER_CORE_TYPE_CNATIVE},{format:"m3u8",value:"hls",core:i.PLAYER_CORE_TYPE_DEFAULT},{format:"m3u",value:"hls",core:i.PLAYER_CORE_TYPE_DEFAULT},{format:"ts",value:"ts",core:i.PLAYER_CORE_TYPE_DEFAULT},{format:"ps",value:"ts",core:i.PLAYER_CORE_TYPE_DEFAULT},{format:"mpegts",value:"ts",core:i.PLAYER_CORE_TYPE_DEFAULT},{format:"hevc",value:"raw265",core:i.PLAYER_CORE_TYPE_DEFAULT},{format:"h265",value:"raw265",core:i.PLAYER_CORE_TYPE_DEFAULT},{format:"265",value:"raw265",core:i.PLAYER_CORE_TYPE_DEFAULT}],n=[{format:i.URI_PROTOCOL_HTTP,value:i.URI_PROTOCOL_HTTP_DESC},{format:i.URI_PROTOCOL_WEBSOCKET,value:i.URI_PROTOCOL_WEBSOCKET_DESC}];t.exports={frameDataAlignCrop:function(e,t,r,i,a,n,s,o){if(0==e-i)return[n,s,o];{let l=i*a,_=l/4,d=new Uint8Array(l),u=new Uint8Array(_),c=new Uint8Array(_),h=i,f=i/2;for(let t=0;t<a;t++)d.set(n.subarray(t*e,h),t*a);for(let e=0;e<a/2;e++)u.set(s.subarray(e*t,f),e*a/2);for(let e=0;e<a/2;e++)c.set(o.subarray(e*r,f),e*a/2);return[d,u,c]}},GetUriFormat:function(e){if(null!=e)for(let t=0;t<a.length;t++){const r=a[t];let i="."+r.format;if(e.search(i)>=0)return r.value,r.value.toLowerCase()}return a[0].value,a[0].value.toLowerCase()},GetFormatPlayCore:function(e){if(null!=e)for(let t=0;t<a.length;t++){const r=a[t];if(r.value===e)return r.core}return a[0].core},GetUriProtocol:function(e){if(null!=e)for(let t=0;t<n.length;t++){const r=n[t];let i=r.format+"[s]{0,}://";if(e.search(i)>=0)return r.value}return n[0].value},GetMsTime:function(){return(new Date).getTime()},GetScriptPath:function(e){let t=[e.toString().match(/^\s*function\s*\(\s*\)\s*\{(([\s\S](?!\}$))*[\s\S])/)[1]];return window.URL.createObjectURL(new Blob(t,{type:"text/javascript"}))},BrowserJudge:function(){let e=window.document,t=window.navigator.userAgent.toLowerCase(),r=e.documentMode,i=window.chrome||!1,a={agent:t,isIE:/msie/.test(t),isGecko:t.indexOf("gecko")>0&&t.indexOf("like gecko")<0,isWebkit:t.indexOf("webkit")>0,isStrict:"CSS1Compat"===e.compatMode,supportSubTitle:function(){return"track"in e.createElement("track")},supportScope:function(){return"scoped"in e.createElement("style")},ieVersion:function(){try{return t.match(/msie ([\d.]+)/)[1]||0}catch(e){return r}},operaVersion:function(){try{if(window.opera)return t.match(/opera.([\d.]+)/)[1];if(t.indexOf("opr")>0)return t.match(/opr\/([\d.]+)/)[1]}catch(e){return 0}},versionFilter:function(){if(1===arguments.length&&"string"==typeof arguments[0]){let e=arguments[0],t=e.indexOf(".");if(t>0){let r=e.indexOf(".",t+1);if(-1!==r)return e.substr(0,r)}return e}return 1===arguments.length?arguments[0]:0}};try{a.type=a.isIE?"IE":window.opera||t.indexOf("opr")>0?"Opera":t.indexOf("chrome")>0?"Chrome":t.indexOf("safari")>0||window.openDatabase?"Safari":t.indexOf("firefox")>0?"Firefox":"unknow",a.version="IE"===a.type?a.ieVersion():"Firefox"===a.type?t.match(/firefox\/([\d.]+)/)[1]:"Chrome"===a.type?t.match(/chrome\/([\d.]+)/)[1]:"Opera"===a.type?a.operaVersion():"Safari"===a.type?t.match(/version\/([\d.]+)/)[1]:"0",a.shell=function(){if(t.indexOf("maxthon")>0)return a.version=t.match(/maxthon\/([\d.]+)/)[1]||a.version,"傲游浏览器";if(t.indexOf("qqbrowser")>0)return a.version=t.match(/qqbrowser\/([\d.]+)/)[1]||a.version,"QQ浏览器";if(t.indexOf("se 2.x")>0)return"搜狗浏览器";if(i&&"Opera"!==a.type){let e=window.external,r=window.clientInformation.languages;if(e&&"LiebaoGetVersion"in e)return"猎豹浏览器";if(t.indexOf("bidubrowser")>0)return a.version=t.match(/bidubrowser\/([\d.]+)/)[1]||t.match(/chrome\/([\d.]+)/)[1],"百度浏览器";if(a.supportSubTitle()&&void 0===r){let e=Object.keys(i.webstore).length;window;return e>1?"360极速浏览器":"360安全浏览器"}return"Chrome"}return a.type},a.name=a.shell(),a.version=a.versionFilter(a.version)}catch(e){}return[a.type,a.version]},ParseGetMediaURL:function(e,t="http"){if("http"!==t&&"ws"!==t&&"wss"!==t&&(e.indexOf("ws")>=0||e.indexOf("wss")>=0)&&(t="ws"),"ws"===t||"wss"===t)return e;let r=e;if(e.indexOf(t)>=0)r=e;else if("/"===e[0])r="/"===e[1]?t+":"+e:window.location.origin+e;else if(":"===e[0])r=t+e;else{let t=window.location.href.split("/");r=window.location.href.replace(t[t.length-1],e)}return r}}},{"./consts":5}],5:[function(e,t,r){t.exports={H265WEBJS_COMPILE_MULTI_THREAD_SHAREDBUFFER:0,DEFAULT_PLAYERE_LOAD_TIMEOUT:20,DEFAILT_WEBGL_PLAY_ID:"glplayer",PLAYER_IN_TYPE_MP4:"mp4",PLAYER_IN_TYPE_FLV:"flv",PLAYER_IN_TYPE_HTTPFLV:"httpflv",PLAYER_IN_TYPE_RAW_265:"raw265",PLAYER_IN_TYPE_TS:"ts",PLAYER_IN_TYPE_MPEGTS:"mpegts",PLAYER_IN_TYPE_M3U8:"hls",PLAYER_IN_TYPE_M3U8_VOD:"m3u8",PLAYER_IN_TYPE_M3U8_LIVE:"hls",APPEND_TYPE_STREAM:0,APPEND_TYPE_FRAME:1,APPEND_TYPE_SEQUENCE:2,DEFAULT_WIDTH:600,DEFAULT_HEIGHT:600,DEFAULT_FPS:30,DEFAULT_FRAME_DUR:40,DEFAULT_FIXED:!1,DEFAULT_SAMPLERATE:44100,DEFAULT_CHANNELS:2,DEFAULT_CONSU_SAMPLE_LEN:20,DEFAULT_CONSU_SAMPLE_DUR:.4,PLAYER_MODE_VOD:"vod",PLAYER_MODE_NOTIME_LIVE:"live",AUDIO_MODE_ONCE:"ONCE",AUDIO_MODE_SWAP:"SWAP",DEFAULT_STRING_LIVE:"LIVE",CODEC_H265:0,CODEC_H264:1,PLAYER_CORE_TYPE_DEFAULT:0,PLAYER_CORE_TYPE_CNATIVE:1,PLAYER_CNATIVE_VOD_RETRY_MAX:7,URI_PROTOCOL_WEBSOCKET:"ws",URI_PROTOCOL_WEBSOCKET_DESC:"websocket",URI_PROTOCOL_HTTP:"http",URI_PROTOCOL_HTTP_DESC:"http",FETCH_FIRST_MAX_TIMES:5,FETCH_HTTP_FLV_TIMEOUT_MS:7e3,V_CODEC_NAME_HEVC:265,V_CODEC_NAME_AVC:264,V_CODEC_NAME_UNKN:500,A_CODEC_NAME_AAC:112,A_CODEC_NAME_MP3:113,A_CODEC_NAME_UNKN:500,CACHE_NO_LOADCACHE:1001,CACHE_WITH_PLAY_SIGN:1002,CACHE_WITH_NOPLAY_SIGN:1003,V_CODEC_AVC_DEFAULT_FPS:25}},{}],6:[function(e,t,r){(function(e){(function(){var i,a;i=self,a=function(){return function(){var t={"./node_modules/es6-promise/dist/es6-promise.js":
/*!******************************************************!*\
  !*** ./node_modules/es6-promise/dist/es6-promise.js ***!
  \******************************************************/function(t,r,i){
/*!
 * @overview es6-promise - a tiny implementation of Promises/A+.
 * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
 * @license   Licensed under MIT license
 *            See https://raw.githubusercontent.com/stefanpenner/es6-promise/master/LICENSE
 * @version   v4.2.8+1e68dce6
 */
t.exports=function(){"use strict";function t(e){var t=typeof e;return null!==e&&("object"===t||"function"===t)}function r(e){return"function"==typeof e}var a=Array.isArray?Array.isArray:function(e){return"[object Array]"===Object.prototype.toString.call(e)},n=0,s=void 0,o=void 0,l=function(e,t){E[n]=e,E[n+1]=t,2===(n+=2)&&(o?o(w):L())};function _(e){o=e}function d(e){l=e}var u="undefined"!=typeof window?window:void 0,c=u||{},h=c.MutationObserver||c.WebKitMutationObserver,f="undefined"==typeof self&&void 0!==e&&"[object process]"==={}.toString.call(e),p="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel;function m(){return function(){return e.nextTick(w)}}function y(){return void 0!==s?function(){s(w)}:b()}function g(){var e=0,t=new h(w),r=document.createTextNode("");return t.observe(r,{characterData:!0}),function(){r.data=e=++e%2}}function v(){var e=new MessageChannel;return e.port1.onmessage=w,function(){return e.port2.postMessage(0)}}function b(){var e=setTimeout;return function(){return e(w,1)}}var E=new Array(1e3);function w(){for(var e=0;e<n;e+=2)(0,E[e])(E[e+1]),E[e]=void 0,E[e+1]=void 0;n=0}function S(){try{var e=Function("return this")().require("vertx");return s=e.runOnLoop||e.runOnContext,y()}catch(e){return b()}}var L=void 0;function k(e,t){var r=this,i=new this.constructor(T);void 0===i[x]&&K(i);var a=r._state;if(a){var n=arguments[a-1];l((function(){return z(a,i,n,r._result)}))}else G(r,i,e,t);return i}function A(e){var t=this;if(e&&"object"==typeof e&&e.constructor===t)return e;var r=new t(T);return U(r,e),r}L=f?m():h?g():p?v():void 0===u?S():b();var x=Math.random().toString(36).substring(2);function T(){}var C=void 0,R=1,O=2;function P(){return new TypeError("You cannot resolve a promise with itself")}function I(){return new TypeError("A promises callback cannot return that same promise.")}function M(e,t,r,i){try{e.call(t,r,i)}catch(e){return e}}function D(e,t,r){l((function(e){var i=!1,a=M(r,t,(function(r){i||(i=!0,t!==r?U(e,r):j(e,r))}),(function(t){i||(i=!0,V(e,t))}),"Settle: "+(e._label||" unknown promise"));!i&&a&&(i=!0,V(e,a))}),e)}function B(e,t){t._state===R?j(e,t._result):t._state===O?V(e,t._result):G(t,void 0,(function(t){return U(e,t)}),(function(t){return V(e,t)}))}function F(e,t,i){t.constructor===e.constructor&&i===k&&t.constructor.resolve===A?B(e,t):void 0===i?j(e,t):r(i)?D(e,t,i):j(e,t)}function U(e,r){if(e===r)V(e,P());else if(t(r)){var i=void 0;try{i=r.then}catch(t){return void V(e,t)}F(e,r,i)}else j(e,r)}function N(e){e._onerror&&e._onerror(e._result),H(e)}function j(e,t){e._state===C&&(e._result=t,e._state=R,0!==e._subscribers.length&&l(H,e))}function V(e,t){e._state===C&&(e._state=O,e._result=t,l(N,e))}function G(e,t,r,i){var a=e._subscribers,n=a.length;e._onerror=null,a[n]=t,a[n+R]=r,a[n+O]=i,0===n&&e._state&&l(H,e)}function H(e){var t=e._subscribers,r=e._state;if(0!==t.length){for(var i=void 0,a=void 0,n=e._result,s=0;s<t.length;s+=3)i=t[s],a=t[s+r],i?z(r,i,a,n):a(n);e._subscribers.length=0}}function z(e,t,i,a){var n=r(i),s=void 0,o=void 0,l=!0;if(n){try{s=i(a)}catch(e){l=!1,o=e}if(t===s)return void V(t,I())}else s=a;t._state!==C||(n&&l?U(t,s):!1===l?V(t,o):e===R?j(t,s):e===O&&V(t,s))}function W(e,t){try{t((function(t){U(e,t)}),(function(t){V(e,t)}))}catch(t){V(e,t)}}var Y=0;function q(){return Y++}function K(e){e[x]=Y++,e._state=void 0,e._result=void 0,e._subscribers=[]}function Q(){return new Error("Array Methods must be provided an Array")}var X=function(){function e(e,t){this._instanceConstructor=e,this.promise=new e(T),this.promise[x]||K(this.promise),a(t)?(this.length=t.length,this._remaining=t.length,this._result=new Array(this.length),0===this.length?j(this.promise,this._result):(this.length=this.length||0,this._enumerate(t),0===this._remaining&&j(this.promise,this._result))):V(this.promise,Q())}return e.prototype._enumerate=function(e){for(var t=0;this._state===C&&t<e.length;t++)this._eachEntry(e[t],t)},e.prototype._eachEntry=function(e,t){var r=this._instanceConstructor,i=r.resolve;if(i===A){var a=void 0,n=void 0,s=!1;try{a=e.then}catch(e){s=!0,n=e}if(a===k&&e._state!==C)this._settledAt(e._state,t,e._result);else if("function"!=typeof a)this._remaining--,this._result[t]=e;else if(r===re){var o=new r(T);s?V(o,n):F(o,e,a),this._willSettleAt(o,t)}else this._willSettleAt(new r((function(t){return t(e)})),t)}else this._willSettleAt(i(e),t)},e.prototype._settledAt=function(e,t,r){var i=this.promise;i._state===C&&(this._remaining--,e===O?V(i,r):this._result[t]=r),0===this._remaining&&j(i,this._result)},e.prototype._willSettleAt=function(e,t){var r=this;G(e,void 0,(function(e){return r._settledAt(R,t,e)}),(function(e){return r._settledAt(O,t,e)}))},e}();function J(e){return new X(this,e).promise}function $(e){var t=this;return a(e)?new t((function(r,i){for(var a=e.length,n=0;n<a;n++)t.resolve(e[n]).then(r,i)})):new t((function(e,t){return t(new TypeError("You must pass an array to race."))}))}function Z(e){var t=new this(T);return V(t,e),t}function ee(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function te(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}var re=function(){function e(t){this[x]=q(),this._result=this._state=void 0,this._subscribers=[],T!==t&&("function"!=typeof t&&ee(),this instanceof e?W(this,t):te())}return e.prototype.catch=function(e){return this.then(null,e)},e.prototype.finally=function(e){var t=this,i=t.constructor;return r(e)?t.then((function(t){return i.resolve(e()).then((function(){return t}))}),(function(t){return i.resolve(e()).then((function(){throw t}))})):t.then(e,e)},e}();function ie(){var e=void 0;if(void 0!==i.g)e=i.g;else if("undefined"!=typeof self)e=self;else try{e=Function("return this")()}catch(e){throw new Error("polyfill failed because global object is unavailable in this environment")}var t=e.Promise;if(t){var r=null;try{r=Object.prototype.toString.call(t.resolve())}catch(e){}if("[object Promise]"===r&&!t.cast)return}e.Promise=re}return re.prototype.then=k,re.all=J,re.race=$,re.resolve=A,re.reject=Z,re._setScheduler=_,re._setAsap=d,re._asap=l,re.polyfill=ie,re.Promise=re,re}()},"./node_modules/events/events.js":
/*!***************************************!*\
  !*** ./node_modules/events/events.js ***!
  \***************************************/function(e){"use strict";var t,r="object"==typeof Reflect?Reflect:null,i=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var a=Number.isNaN||function(e){return e!=e};function n(){n.init.call(this)}e.exports=n,e.exports.once=function(e,t){return new Promise((function(r,i){function a(r){e.removeListener(t,n),i(r)}function n(){"function"==typeof e.removeListener&&e.removeListener("error",a),r([].slice.call(arguments))}p(e,t,n,{once:!0}),"error"!==t&&function(e,t,r){"function"==typeof e.on&&p(e,"error",t,r)}(e,a,{once:!0})}))},n.EventEmitter=n,n.prototype._events=void 0,n.prototype._eventsCount=0,n.prototype._maxListeners=void 0;var s=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function l(e){return void 0===e._maxListeners?n.defaultMaxListeners:e._maxListeners}function _(e,t,r,i){var a,n,s;if(o(r),void 0===(n=e._events)?(n=e._events=Object.create(null),e._eventsCount=0):(void 0!==n.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),n=e._events),s=n[t]),void 0===s)s=n[t]=r,++e._eventsCount;else if("function"==typeof s?s=n[t]=i?[r,s]:[s,r]:i?s.unshift(r):s.push(r),(a=l(e))>0&&s.length>a&&!s.warned){s.warned=!0;var _=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");_.name="MaxListenersExceededWarning",_.emitter=e,_.type=t,_.count=s.length,console&&console.warn}return e}function d(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function u(e,t,r){var i={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},a=d.bind(i);return a.listener=r,i.wrapFn=a,a}function c(e,t,r){var i=e._events;if(void 0===i)return[];var a=i[t];return void 0===a?[]:"function"==typeof a?r?[a.listener||a]:[a]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(a):f(a,a.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),i=0;i<t;++i)r[i]=e[i];return r}function p(e,t,r,i){if("function"==typeof e.on)i.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function a(n){i.once&&e.removeEventListener(t,a),r(n)}))}}Object.defineProperty(n,"defaultMaxListeners",{enumerable:!0,get:function(){return s},set:function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");s=e}}),n.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},n.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||a(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},n.prototype.getMaxListeners=function(){return l(this)},n.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var a="error"===e,n=this._events;if(void 0!==n)a=a&&void 0===n.error;else if(!a)return!1;if(a){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var o=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw o.context=s,o}var l=n[e];if(void 0===l)return!1;if("function"==typeof l)i(l,this,t);else{var _=l.length,d=f(l,_);for(r=0;r<_;++r)i(d[r],this,t)}return!0},n.prototype.addListener=function(e,t){return _(this,e,t,!1)},n.prototype.on=n.prototype.addListener,n.prototype.prependListener=function(e,t){return _(this,e,t,!0)},n.prototype.once=function(e,t){return o(t),this.on(e,u(this,e,t)),this},n.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,u(this,e,t)),this},n.prototype.removeListener=function(e,t){var r,i,a,n,s;if(o(t),void 0===(i=this._events))return this;if(void 0===(r=i[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,n=r.length-1;n>=0;n--)if(r[n]===t||r[n].listener===t){s=r[n].listener,a=n;break}if(a<0)return this;0===a?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,a),1===r.length&&(i[e]=r[0]),void 0!==i.removeListener&&this.emit("removeListener",e,s||t)}return this},n.prototype.off=n.prototype.removeListener,n.prototype.removeAllListeners=function(e){var t,r,i;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var a,n=Object.keys(r);for(i=0;i<n.length;++i)"removeListener"!==(a=n[i])&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(i=t.length-1;i>=0;i--)this.removeListener(e,t[i]);return this},n.prototype.listeners=function(e){return c(this,e,!0)},n.prototype.rawListeners=function(e){return c(this,e,!1)},n.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},n.prototype.listenerCount=h,n.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},"./node_modules/webworkify-webpack/index.js":
/*!**************************************************!*\
  !*** ./node_modules/webworkify-webpack/index.js ***!
  \**************************************************/function(e,t,r){function i(e){var t={};function r(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,r),a.l=!0,a.exports}r.m=e,r.c=t,r.i=function(e){return e},r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},r.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="/",r.oe=function(e){throw console.error(e),e};var i=r(r.s=ENTRY_MODULE);return i.default||i}var a="[\\.|\\-|\\+|\\w|/|@]+",n="\\(\\s*(/\\*.*?\\*/)?\\s*.*?("+a+").*?\\)";function s(e){return(e+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(e,t,i){var o={};o[i]=[];var l=t.toString(),_=l.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!_)return o;for(var d,u=_[1],c=new RegExp("(\\\\n|\\W)"+s(u)+n,"g");d=c.exec(l);)"dll-reference"!==d[3]&&o[i].push(d[3]);for(c=new RegExp("\\("+s(u)+'\\("(dll-reference\\s('+a+'))"\\)\\)'+n,"g");d=c.exec(l);)e[d[2]]||(o[i].push(d[1]),e[d[2]]=r(d[1]).m),o[d[2]]=o[d[2]]||[],o[d[2]].push(d[4]);for(var h,f=Object.keys(o),p=0;p<f.length;p++)for(var m=0;m<o[f[p]].length;m++)h=o[f[p]][m],isNaN(1*h)||(o[f[p]][m]=1*o[f[p]][m]);return o}function l(e){return Object.keys(e).reduce((function(t,r){return t||e[r].length>0}),!1)}e.exports=function(e,t){t=t||{};var a={main:r.m},n=t.all?{main:Object.keys(a.main)}:function(e,t){for(var r={main:[t]},i={main:[]},a={main:{}};l(r);)for(var n=Object.keys(r),s=0;s<n.length;s++){var _=n[s],d=r[_].pop();if(a[_]=a[_]||{},!a[_][d]&&e[_][d]){a[_][d]=!0,i[_]=i[_]||[],i[_].push(d);for(var u=o(e,e[_][d],_),c=Object.keys(u),h=0;h<c.length;h++)r[c[h]]=r[c[h]]||[],r[c[h]]=r[c[h]].concat(u[c[h]])}}return i}(a,e),s="";Object.keys(n).filter((function(e){return"main"!==e})).forEach((function(e){for(var t=0;n[e][t];)t++;n[e].push(t),a[e][t]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",s=s+"var "+e+" = ("+i.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+n[e].map((function(t){return JSON.stringify(t)+": "+a[e][t].toString()})).join(",")+"});\n"})),s=s+"new (("+i.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+n.main.map((function(e){return JSON.stringify(e)+": "+a.main[e].toString()})).join(",")+"}))(self);";var _=new window.Blob([s],{type:"text/javascript"});if(t.bare)return _;var d=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(_),u=new window.Worker(d);return u.objectURL=d,u}},"./src/config.js":
/*!***********************!*\
  !*** ./src/config.js ***!
  \***********************/function(e,t,r){"use strict";r.r(t),r.d(t,{defaultConfig:function(){return i},createDefaultConfig:function(){return a}});var i={enableWorker:!1,enableStashBuffer:!0,stashInitialSize:void 0,isLive:!1,lazyLoad:!0,lazyLoadMaxDuration:180,lazyLoadRecoverDuration:30,deferLoadAfterSourceOpen:!0,autoCleanupMaxBackwardDuration:180,autoCleanupMinBackwardDuration:120,statisticsInfoReportInterval:600,fixAudioTimestampGap:!0,accurateSeek:!1,seekType:"range",seekParamStart:"bstart",seekParamEnd:"bend",rangeLoadZeroStart:!1,customSeekHandler:void 0,reuseRedirectedURL:!1,headers:void 0,customLoader:void 0};function a(){return Object.assign({},i)}},"./src/core/features.js":
/*!******************************!*\
  !*** ./src/core/features.js ***!
  \******************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),a=r(/*! ../config.js */"./src/config.js"),n=function(){function e(){}return e.supportMSEH264Playback=function(){return window.MediaSource&&window.MediaSource.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"')},e.supportNetworkStreamIO=function(){var e=new i.default({},(0,a.createDefaultConfig)()),t=e.loaderType;return e.destroy(),"fetch-stream-loader"==t||"xhr-moz-chunked-loader"==t},e.getNetworkLoaderTypeName=function(){var e=new i.default({},(0,a.createDefaultConfig)()),t=e.loaderType;return e.destroy(),t},e.supportNativeMediaPlayback=function(t){null==e.videoElement&&(e.videoElement=window.document.createElement("video"));var r=e.videoElement.canPlayType(t);return"probably"===r||"maybe"==r},e.getFeatureList=function(){var t={mseFlvPlayback:!1,mseLiveFlvPlayback:!1,networkStreamIO:!1,networkLoaderName:"",nativeMP4H264Playback:!1,nativeMP4H265Playback:!1,nativeWebmVP8Playback:!1,nativeWebmVP9Playback:!1};return t.mseFlvPlayback=e.supportMSEH264Playback(),t.networkStreamIO=e.supportNetworkStreamIO(),t.networkLoaderName=e.getNetworkLoaderTypeName(),t.mseLiveFlvPlayback=t.mseFlvPlayback&&t.networkStreamIO,t.nativeMP4H264Playback=e.supportNativeMediaPlayback('video/mp4; codecs="avc1.42001E, mp4a.40.2"'),t.nativeMP4H265Playback=e.supportNativeMediaPlayback('video/mp4; codecs="hvc1.1.6.L93.B0"'),t.nativeWebmVP8Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp8.0, vorbis"'),t.nativeWebmVP9Playback=e.supportNativeMediaPlayback('video/webm; codecs="vp9"'),t},e}();t.default=n},"./src/core/media-info.js":
/*!********************************!*\
  !*** ./src/core/media-info.js ***!
  \********************************/function(e,t,r){"use strict";r.r(t);var i=function(){function e(){this.mimeType=null,this.duration=null,this.hasAudio=null,this.hasVideo=null,this.audioCodec=null,this.videoCodec=null,this.audioDataRate=null,this.videoDataRate=null,this.audioSampleRate=null,this.audioChannelCount=null,this.width=null,this.height=null,this.fps=null,this.profile=null,this.level=null,this.refFrames=null,this.chromaFormat=null,this.sarNum=null,this.sarDen=null,this.metadata=null,this.segments=null,this.segmentCount=null,this.hasKeyframesIndex=null,this.keyframesIndex=null}return e.prototype.isComplete=function(){var e=!1===this.hasAudio||!0===this.hasAudio&&null!=this.audioCodec&&null!=this.audioSampleRate&&null!=this.audioChannelCount,t=!1===this.hasVideo||!0===this.hasVideo&&null!=this.videoCodec&&null!=this.width&&null!=this.height&&null!=this.fps&&null!=this.profile&&null!=this.level&&null!=this.refFrames&&null!=this.chromaFormat&&null!=this.sarNum&&null!=this.sarDen;return null!=this.mimeType&&null!=this.duration&&null!=this.metadata&&null!=this.hasKeyframesIndex&&e&&t},e.prototype.isSeekable=function(){return!0===this.hasKeyframesIndex},e.prototype.getNearestKeyframe=function(e){if(null==this.keyframesIndex)return null;var t=this.keyframesIndex,r=this._search(t.times,e);return{index:r,milliseconds:t.times[r],fileposition:t.filepositions[r]}},e.prototype._search=function(e,t){var r=0,i=e.length-1,a=0,n=0,s=i;for(t<e[0]&&(r=0,n=s+1);n<=s;){if((a=n+Math.floor((s-n)/2))===i||t>=e[a]&&t<e[a+1]){r=a;break}e[a]<t?n=a+1:s=a-1}return r},e}();t.default=i},"./src/core/media-segment-info.js":
/*!****************************************!*\
  !*** ./src/core/media-segment-info.js ***!
  \****************************************/function(e,t,r){"use strict";r.r(t),r.d(t,{SampleInfo:function(){return i},MediaSegmentInfo:function(){return a},IDRSampleList:function(){return n},MediaSegmentInfoList:function(){return s}});var i=function(e,t,r,i,a){this.dts=e,this.pts=t,this.duration=r,this.originalDts=i,this.isSyncPoint=a,this.fileposition=null},a=function(){function e(){this.beginDts=0,this.endDts=0,this.beginPts=0,this.endPts=0,this.originalBeginDts=0,this.originalEndDts=0,this.syncPoints=[],this.firstSample=null,this.lastSample=null}return e.prototype.appendSyncPoint=function(e){e.isSyncPoint=!0,this.syncPoints.push(e)},e}(),n=function(){function e(){this._list=[]}return e.prototype.clear=function(){this._list=[]},e.prototype.appendArray=function(e){var t=this._list;0!==e.length&&(t.length>0&&e[0].originalDts<t[t.length-1].originalDts&&this.clear(),Array.prototype.push.apply(t,e))},e.prototype.getLastSyncPointBeforeDts=function(e){if(0==this._list.length)return null;var t=this._list,r=0,i=t.length-1,a=0,n=0,s=i;for(e<t[0].dts&&(r=0,n=s+1);n<=s;){if((a=n+Math.floor((s-n)/2))===i||e>=t[a].dts&&e<t[a+1].dts){r=a;break}t[a].dts<e?n=a+1:s=a-1}return this._list[r]},e}(),s=function(){function e(e){this._type=e,this._list=[],this._lastAppendLocation=-1}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"length",{get:function(){return this._list.length},enumerable:!1,configurable:!0}),e.prototype.isEmpty=function(){return 0===this._list.length},e.prototype.clear=function(){this._list=[],this._lastAppendLocation=-1},e.prototype._searchNearestSegmentBefore=function(e){var t=this._list;if(0===t.length)return-2;var r=t.length-1,i=0,a=0,n=r,s=0;if(e<t[0].originalBeginDts)return s=-1;for(;a<=n;){if((i=a+Math.floor((n-a)/2))===r||e>t[i].lastSample.originalDts&&e<t[i+1].originalBeginDts){s=i;break}t[i].originalBeginDts<e?a=i+1:n=i-1}return s},e.prototype._searchNearestSegmentAfter=function(e){return this._searchNearestSegmentBefore(e)+1},e.prototype.append=function(e){var t=this._list,r=e,i=this._lastAppendLocation,a=0;-1!==i&&i<t.length&&r.originalBeginDts>=t[i].lastSample.originalDts&&(i===t.length-1||i<t.length-1&&r.originalBeginDts<t[i+1].originalBeginDts)?a=i+1:t.length>0&&(a=this._searchNearestSegmentBefore(r.originalBeginDts)+1),this._lastAppendLocation=a,this._list.splice(a,0,r)},e.prototype.getLastSegmentBefore=function(e){var t=this._searchNearestSegmentBefore(e);return t>=0?this._list[t]:null},e.prototype.getLastSampleBefore=function(e){var t=this.getLastSegmentBefore(e);return null!=t?t.lastSample:null},e.prototype.getLastSyncPointBefore=function(e){for(var t=this._searchNearestSegmentBefore(e),r=this._list[t].syncPoints;0===r.length&&t>0;)t--,r=this._list[t].syncPoints;return r.length>0?r[r.length-1]:null},e}()},"./src/core/mse-controller.js":
/*!************************************!*\
  !*** ./src/core/mse-controller.js ***!
  \************************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),a=r.n(i),n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./mse-events.js */"./src/core/mse-events.js"),l=r(/*! ./media-segment-info.js */"./src/core/media-segment-info.js"),_=r(/*! ../utils/exception.js */"./src/utils/exception.js"),d=function(){function e(e){this.TAG="MSEController",this._config=e,this._emitter=new(a()),this._config.isLive&&null==this._config.autoCleanupSourceBuffer&&(this._config.autoCleanupSourceBuffer=!0),this.e={onSourceOpen:this._onSourceOpen.bind(this),onSourceEnded:this._onSourceEnded.bind(this),onSourceClose:this._onSourceClose.bind(this),onSourceBufferError:this._onSourceBufferError.bind(this),onSourceBufferUpdateEnd:this._onSourceBufferUpdateEnd.bind(this)},this._mediaSource=null,this._mediaSourceObjectURL=null,this._mediaElement=null,this._isBufferFull=!1,this._hasPendingEos=!1,this._requireSetMediaDuration=!1,this._pendingMediaDuration=0,this._pendingSourceBufferInit=[],this._mimeTypes={video:null,audio:null},this._sourceBuffers={video:null,audio:null},this._lastInitSegments={video:null,audio:null},this._pendingSegments={video:[],audio:[]},this._pendingRemoveRanges={video:[],audio:[]},this._idrList=new l.IDRSampleList}return e.prototype.destroy=function(){(this._mediaElement||this._mediaSource)&&this.detachMediaElement(),this.e=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaSource)throw new _.IllegalStateException("MediaSource has been attached to an HTMLMediaElement!");var t=this._mediaSource=new window.MediaSource;t.addEventListener("sourceopen",this.e.onSourceOpen),t.addEventListener("sourceended",this.e.onSourceEnded),t.addEventListener("sourceclose",this.e.onSourceClose),this._mediaElement=e,this._mediaSourceObjectURL=window.URL.createObjectURL(this._mediaSource),e.src=this._mediaSourceObjectURL},e.prototype.detachMediaElement=function(){if(this._mediaSource){var e=this._mediaSource;for(var t in this._sourceBuffers){var r=this._pendingSegments[t];r.splice(0,r.length),this._pendingSegments[t]=null,this._pendingRemoveRanges[t]=null,this._lastInitSegments[t]=null;var i=this._sourceBuffers[t];if(i){if("closed"!==e.readyState){try{e.removeSourceBuffer(i)}catch(e){n.default.e(this.TAG,e.message)}i.removeEventListener("error",this.e.onSourceBufferError),i.removeEventListener("updateend",this.e.onSourceBufferUpdateEnd)}this._mimeTypes[t]=null,this._sourceBuffers[t]=null}}if("open"===e.readyState)try{e.endOfStream()}catch(e){n.default.e(this.TAG,e.message)}e.removeEventListener("sourceopen",this.e.onSourceOpen),e.removeEventListener("sourceended",this.e.onSourceEnded),e.removeEventListener("sourceclose",this.e.onSourceClose),this._pendingSourceBufferInit=[],this._isBufferFull=!1,this._idrList.clear(),this._mediaSource=null}this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement=null),this._mediaSourceObjectURL&&(window.URL.revokeObjectURL(this._mediaSourceObjectURL),this._mediaSourceObjectURL=null)},e.prototype.appendInitSegment=function(e,t){if(!this._mediaSource||"open"!==this._mediaSource.readyState)return this._pendingSourceBufferInit.push(e),void this._pendingSegments[e.type].push(e);var r=e,i=""+r.container;r.codec&&r.codec.length>0&&(i+=";codecs="+r.codec);var a=!1;if(n.default.v(this.TAG,"Received Initialization Segment, mimeType: "+i),this._lastInitSegments[r.type]=r,i!==this._mimeTypes[r.type]){if(this._mimeTypes[r.type])n.default.v(this.TAG,"Notice: "+r.type+" mimeType changed, origin: "+this._mimeTypes[r.type]+", target: "+i);else{a=!0;try{var l=this._sourceBuffers[r.type]=this._mediaSource.addSourceBuffer(i);l.addEventListener("error",this.e.onSourceBufferError),l.addEventListener("updateend",this.e.onSourceBufferUpdateEnd)}catch(e){return n.default.e(this.TAG,e.message),void this._emitter.emit(o.default.ERROR,{code:e.code,msg:e.message})}}this._mimeTypes[r.type]=i}t||this._pendingSegments[r.type].push(r),a||this._sourceBuffers[r.type]&&!this._sourceBuffers[r.type].updating&&this._doAppendSegments(),s.default.safari&&"audio/mpeg"===r.container&&r.mediaDuration>0&&(this._requireSetMediaDuration=!0,this._pendingMediaDuration=r.mediaDuration/1e3,this._updateMediaSourceDuration())},e.prototype.appendMediaSegment=function(e){var t=e;this._pendingSegments[t.type].push(t),this._config.autoCleanupSourceBuffer&&this._needCleanupSourceBuffer()&&this._doCleanupSourceBuffer();var r=this._sourceBuffers[t.type];!r||r.updating||this._hasPendingRemoveRanges()||this._doAppendSegments()},e.prototype.seek=function(e){for(var t in this._sourceBuffers)if(this._sourceBuffers[t]){var r=this._sourceBuffers[t];if("open"===this._mediaSource.readyState)try{r.abort()}catch(e){n.default.e(this.TAG,e.message)}this._idrList.clear();var i=this._pendingSegments[t];if(i.splice(0,i.length),"closed"!==this._mediaSource.readyState){for(var a=0;a<r.buffered.length;a++){var o=r.buffered.start(a),l=r.buffered.end(a);this._pendingRemoveRanges[t].push({start:o,end:l})}if(r.updating||this._doRemoveRanges(),s.default.safari){var _=this._lastInitSegments[t];_&&(this._pendingSegments[t].push(_),r.updating||this._doAppendSegments())}}}},e.prototype.endOfStream=function(){var e=this._mediaSource,t=this._sourceBuffers;e&&"open"===e.readyState?t.video&&t.video.updating||t.audio&&t.audio.updating?this._hasPendingEos=!0:(this._hasPendingEos=!1,e.endOfStream()):e&&"closed"===e.readyState&&this._hasPendingSegments()&&(this._hasPendingEos=!0)},e.prototype.getNearestKeyframe=function(e){return this._idrList.getLastSyncPointBeforeDts(e)},e.prototype._needCleanupSourceBuffer=function(){if(!this._config.autoCleanupSourceBuffer)return!1;var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){var i=r.buffered;if(i.length>=1&&e-i.start(0)>=this._config.autoCleanupMaxBackwardDuration)return!0}}return!1},e.prototype._doCleanupSourceBuffer=function(){var e=this._mediaElement.currentTime;for(var t in this._sourceBuffers){var r=this._sourceBuffers[t];if(r){for(var i=r.buffered,a=!1,n=0;n<i.length;n++){var s=i.start(n),o=i.end(n);if(s<=e&&e<o+3){if(e-s>=this._config.autoCleanupMaxBackwardDuration){a=!0;var l=e-this._config.autoCleanupMinBackwardDuration;this._pendingRemoveRanges[t].push({start:s,end:l})}}else o<e&&(a=!0,this._pendingRemoveRanges[t].push({start:s,end:o}))}a&&!r.updating&&this._doRemoveRanges()}}},e.prototype._updateMediaSourceDuration=function(){var e=this._sourceBuffers;if(0!==this._mediaElement.readyState&&"open"===this._mediaSource.readyState&&!(e.video&&e.video.updating||e.audio&&e.audio.updating)){var t=this._mediaSource.duration,r=this._pendingMediaDuration;r>0&&(isNaN(t)||r>t)&&(n.default.v(this.TAG,"Update MediaSource duration from "+t+" to "+r),this._mediaSource.duration=r),this._requireSetMediaDuration=!1,this._pendingMediaDuration=0}},e.prototype._doRemoveRanges=function(){for(var e in this._pendingRemoveRanges)if(this._sourceBuffers[e]&&!this._sourceBuffers[e].updating)for(var t=this._sourceBuffers[e],r=this._pendingRemoveRanges[e];r.length&&!t.updating;){var i=r.shift();t.remove(i.start,i.end)}},e.prototype._doAppendSegments=function(){var e=this._pendingSegments;for(var t in e)if(this._sourceBuffers[t]&&!this._sourceBuffers[t].updating&&e[t].length>0){var r=e[t].shift();if(r.timestampOffset){var i=this._sourceBuffers[t].timestampOffset,a=r.timestampOffset/1e3;Math.abs(i-a)>.1&&(n.default.v(this.TAG,"Update MPEG audio timestampOffset from "+i+" to "+a),this._sourceBuffers[t].timestampOffset=a),delete r.timestampOffset}if(!r.data||0===r.data.byteLength)continue;try{this._sourceBuffers[t].appendBuffer(r.data),this._isBufferFull=!1,"video"===t&&r.hasOwnProperty("info")&&this._idrList.appendArray(r.info.syncPoints)}catch(e){this._pendingSegments[t].unshift(r),22===e.code?(this._isBufferFull||this._emitter.emit(o.default.BUFFER_FULL),this._isBufferFull=!0):(n.default.e(this.TAG,t,e.message),this._emitter.emit(o.default.ERROR,{code:e.code,msg:e.message}))}}},e.prototype._onSourceOpen=function(){if(n.default.v(this.TAG,"MediaSource onSourceOpen"),this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._pendingSourceBufferInit.length>0)for(var e=this._pendingSourceBufferInit;e.length;){var t=e.shift();this.appendInitSegment(t,!0)}this._hasPendingSegments()&&this._doAppendSegments(),this._emitter.emit(o.default.SOURCE_OPEN)},e.prototype._onSourceEnded=function(){n.default.v(this.TAG,"MediaSource onSourceEnded")},e.prototype._onSourceClose=function(){n.default.v(this.TAG,"MediaSource onSourceClose"),this._mediaSource&&null!=this.e&&(this._mediaSource.removeEventListener("sourceopen",this.e.onSourceOpen),this._mediaSource.removeEventListener("sourceended",this.e.onSourceEnded),this._mediaSource.removeEventListener("sourceclose",this.e.onSourceClose))},e.prototype._hasPendingSegments=function(){var e=this._pendingSegments;return(e.video&&e.video.length)>0||e.audio&&e.audio.length>0},e.prototype._hasPendingRemoveRanges=function(){var e=this._pendingRemoveRanges;return(e.video&&e.video.length)>0||e.audio&&e.audio.length>0},e.prototype._onSourceBufferUpdateEnd=function(){this._requireSetMediaDuration?this._updateMediaSourceDuration():this._hasPendingRemoveRanges()?this._doRemoveRanges():this._hasPendingSegments()?this._doAppendSegments():this._hasPendingEos&&this.endOfStream(),this._emitter.emit(o.default.UPDATE_END)},e.prototype._onSourceBufferError=function(e){n.default.e(this.TAG,"SourceBuffer Error: "+e)},e}();t.default=d},"./src/core/mse-events.js":
/*!********************************!*\
  !*** ./src/core/mse-events.js ***!
  \********************************/function(e,t,r){"use strict";r.r(t),t.default={ERROR:"error",SOURCE_OPEN:"source_open",UPDATE_END:"update_end",BUFFER_FULL:"buffer_full"}},"./src/core/transmuxer.js":
/*!********************************!*\
  !*** ./src/core/transmuxer.js ***!
  \********************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),a=r.n(i),n=r(/*! webworkify-webpack */"./node_modules/webworkify-webpack/index.js"),s=r.n(n),o=r(/*! ../utils/logger.js */"./src/utils/logger.js"),l=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),_=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),d=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),u=r(/*! ./media-info.js */"./src/core/media-info.js"),c=function(){function e(e,t){if(this.TAG="Transmuxer",this._emitter=new(a()),t.enableWorker&&"undefined"!=typeof Worker)try{this._worker=s()(/*! ./transmuxing-worker */"./src/core/transmuxing-worker.js"),this._workerDestroying=!1,this._worker.addEventListener("message",this._onWorkerMessage.bind(this)),this._worker.postMessage({cmd:"init",param:[e,t]}),this.e={onLoggingConfigChanged:this._onLoggingConfigChanged.bind(this)},l.default.registerListener(this.e.onLoggingConfigChanged),this._worker.postMessage({cmd:"logging_config",param:l.default.getConfig()})}catch(r){o.default.e(this.TAG,"Error while initialize transmuxing worker, fallback to inline transmuxing"),this._worker=null,this._controller=new _.default(e,t)}else this._controller=new _.default(e,t);if(this._controller){var r=this._controller;r.on(d.default.IO_ERROR,this._onIOError.bind(this)),r.on(d.default.DEMUX_ERROR,this._onDemuxError.bind(this)),r.on(d.default.INIT_SEGMENT,this._onInitSegment.bind(this)),r.on(d.default.MEDIA_SEGMENT,this._onMediaSegment.bind(this)),r.on(d.default.LOADING_COMPLETE,this._onLoadingComplete.bind(this)),r.on(d.default.RECOVERED_EARLY_EOF,this._onRecoveredEarlyEof.bind(this)),r.on(d.default.MEDIA_INFO,this._onMediaInfo.bind(this)),r.on(d.default.METADATA_ARRIVED,this._onMetaDataArrived.bind(this)),r.on(d.default.SCRIPTDATA_ARRIVED,this._onScriptDataArrived.bind(this)),r.on(d.default.STATISTICS_INFO,this._onStatisticsInfo.bind(this)),r.on(d.default.RECOMMEND_SEEKPOINT,this._onRecommendSeekpoint.bind(this))}}return e.prototype.destroy=function(){this._worker?this._workerDestroying||(this._workerDestroying=!0,this._worker.postMessage({cmd:"destroy"}),l.default.removeListener(this.e.onLoggingConfigChanged),this.e=null):(this._controller.destroy(),this._controller=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.hasWorker=function(){return null!=this._worker},e.prototype.open=function(){this._worker?this._worker.postMessage({cmd:"start"}):this._controller.start()},e.prototype.close=function(){this._worker?this._worker.postMessage({cmd:"stop"}):this._controller.stop()},e.prototype.seek=function(e){this._worker?this._worker.postMessage({cmd:"seek",param:e}):this._controller.seek(e)},e.prototype.pause=function(){this._worker?this._worker.postMessage({cmd:"pause"}):this._controller.pause()},e.prototype.resume=function(){this._worker?this._worker.postMessage({cmd:"resume"}):this._controller.resume()},e.prototype._onInitSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.INIT_SEGMENT,e,t)}))},e.prototype._onMediaSegment=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.MEDIA_SEGMENT,e,t)}))},e.prototype._onLoadingComplete=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(d.default.LOADING_COMPLETE)}))},e.prototype._onRecoveredEarlyEof=function(){var e=this;Promise.resolve().then((function(){e._emitter.emit(d.default.RECOVERED_EARLY_EOF)}))},e.prototype._onMediaInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.MEDIA_INFO,e)}))},e.prototype._onMetaDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.METADATA_ARRIVED,e)}))},e.prototype._onScriptDataArrived=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.SCRIPTDATA_ARRIVED,e)}))},e.prototype._onStatisticsInfo=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.STATISTICS_INFO,e)}))},e.prototype._onIOError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.IO_ERROR,e,t)}))},e.prototype._onDemuxError=function(e,t){var r=this;Promise.resolve().then((function(){r._emitter.emit(d.default.DEMUX_ERROR,e,t)}))},e.prototype._onRecommendSeekpoint=function(e){var t=this;Promise.resolve().then((function(){t._emitter.emit(d.default.RECOMMEND_SEEKPOINT,e)}))},e.prototype._onLoggingConfigChanged=function(e){this._worker&&this._worker.postMessage({cmd:"logging_config",param:e})},e.prototype._onWorkerMessage=function(e){var t=e.data,r=t.data;if("destroyed"===t.msg||this._workerDestroying)return this._workerDestroying=!1,this._worker.terminate(),void(this._worker=null);switch(t.msg){case d.default.INIT_SEGMENT:case d.default.MEDIA_SEGMENT:this._emitter.emit(t.msg,r.type,r.data);break;case d.default.LOADING_COMPLETE:case d.default.RECOVERED_EARLY_EOF:this._emitter.emit(t.msg);break;case d.default.MEDIA_INFO:Object.setPrototypeOf(r,u.default.prototype),this._emitter.emit(t.msg,r);break;case d.default.METADATA_ARRIVED:case d.default.SCRIPTDATA_ARRIVED:case d.default.STATISTICS_INFO:this._emitter.emit(t.msg,r);break;case d.default.IO_ERROR:case d.default.DEMUX_ERROR:this._emitter.emit(t.msg,r.type,r.info);break;case d.default.RECOMMEND_SEEKPOINT:this._emitter.emit(t.msg,r);break;case"logcat_callback":o.default.emitter.emit("log",r.type,r.logcat)}},e}();t.default=c},"./src/core/transmuxing-controller.js":
/*!********************************************!*\
  !*** ./src/core/transmuxing-controller.js ***!
  \********************************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),a=r.n(i),n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./media-info.js */"./src/core/media-info.js"),l=r(/*! ../demux/flv-demuxer.js */"./src/demux/flv-demuxer.js"),_=r(/*! ../remux/mp4-remuxer.js */"./src/remux/mp4-remuxer.js"),d=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),u=r(/*! ../io/io-controller.js */"./src/io/io-controller.js"),c=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js"),h=function(){function e(e,t){this.TAG="TransmuxingController",this._emitter=new(a()),this._config=t,e.segments||(e.segments=[{duration:e.duration,filesize:e.filesize,url:e.url}]),"boolean"!=typeof e.cors&&(e.cors=!0),"boolean"!=typeof e.withCredentials&&(e.withCredentials=!1),this._mediaDataSource=e,this._currentSegmentIndex=0;var r=0;this._mediaDataSource.segments.forEach((function(i){i.timestampBase=r,r+=i.duration,i.cors=e.cors,i.withCredentials=e.withCredentials,t.referrerPolicy&&(i.referrerPolicy=t.referrerPolicy)})),isNaN(r)||this._mediaDataSource.duration===r||(this._mediaDataSource.duration=r),this._mediaInfo=null,this._demuxer=null,this._remuxer=null,this._ioctl=null,this._pendingSeekTime=null,this._pendingResolveSeekPoint=null,this._statisticsReporter=null}return e.prototype.destroy=function(){this._mediaInfo=null,this._mediaDataSource=null,this._statisticsReporter&&this._disableStatisticsReporter(),this._ioctl&&(this._ioctl.destroy(),this._ioctl=null),this._demuxer&&(this._demuxer.destroy(),this._demuxer=null),this._remuxer&&(this._remuxer.destroy(),this._remuxer=null),this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.start=function(){this._loadSegment(0),this._enableStatisticsReporter()},e.prototype._loadSegment=function(e,t){this._currentSegmentIndex=e;var r=this._mediaDataSource.segments[e],i=this._ioctl=new u.default(r,this._config,e);i.onError=this._onIOException.bind(this),i.onSeeked=this._onIOSeeked.bind(this),i.onComplete=this._onIOComplete.bind(this),i.onRedirect=this._onIORedirect.bind(this),i.onRecoveredEarlyEof=this._onIORecoveredEarlyEof.bind(this),t?this._demuxer.bindDataSource(this._ioctl):i.onDataArrival=this._onInitChunkArrival.bind(this),i.open(t)},e.prototype.stop=function(){this._internalAbort(),this._disableStatisticsReporter()},e.prototype._internalAbort=function(){this._ioctl&&(this._ioctl.destroy(),this._ioctl=null)},e.prototype.pause=function(){this._ioctl&&this._ioctl.isWorking()&&(this._ioctl.pause(),this._disableStatisticsReporter())},e.prototype.resume=function(){this._ioctl&&this._ioctl.isPaused()&&(this._ioctl.resume(),this._enableStatisticsReporter())},e.prototype.seek=function(e){if(null!=this._mediaInfo&&this._mediaInfo.isSeekable()){var t=this._searchSegmentIndexContains(e);if(t===this._currentSegmentIndex){var r=this._mediaInfo.segments[t];if(null==r)this._pendingSeekTime=e;else{var i=r.getNearestKeyframe(e);this._remuxer.seek(i.milliseconds),this._ioctl.seek(i.fileposition),this._pendingResolveSeekPoint=i.milliseconds}}else{var a=this._mediaInfo.segments[t];null==a?(this._pendingSeekTime=e,this._internalAbort(),this._remuxer.seek(),this._remuxer.insertDiscontinuity(),this._loadSegment(t)):(i=a.getNearestKeyframe(e),this._internalAbort(),this._remuxer.seek(e),this._remuxer.insertDiscontinuity(),this._demuxer.resetMediaInfo(),this._demuxer.timestampBase=this._mediaDataSource.segments[t].timestampBase,this._loadSegment(t,i.fileposition),this._pendingResolveSeekPoint=i.milliseconds,this._reportSegmentMediaInfo(t))}this._enableStatisticsReporter()}},e.prototype._searchSegmentIndexContains=function(e){for(var t=this._mediaDataSource.segments,r=t.length-1,i=0;i<t.length;i++)if(e<t[i].timestampBase){r=i-1;break}return r},e.prototype._onInitChunkArrival=function(e,t){var r=this,i=null,a=0;if(t>0)this._demuxer.bindDataSource(this._ioctl),this._demuxer.timestampBase=this._mediaDataSource.segments[this._currentSegmentIndex].timestampBase,a=this._demuxer.parseChunks(e,t);else if((i=l.default.probe(e)).match){this._demuxer=new l.default(i,this._config),this._remuxer||(this._remuxer=new _.default(this._config));var s=this._mediaDataSource;null==s.duration||isNaN(s.duration)||(this._demuxer.overridedDuration=s.duration),"boolean"==typeof s.hasAudio&&(this._demuxer.overridedHasAudio=s.hasAudio),"boolean"==typeof s.hasVideo&&(this._demuxer.overridedHasVideo=s.hasVideo),this._demuxer.timestampBase=s.segments[this._currentSegmentIndex].timestampBase,this._demuxer.onError=this._onDemuxException.bind(this),this._demuxer.onMediaInfo=this._onMediaInfo.bind(this),this._demuxer.onMetaDataArrived=this._onMetaDataArrived.bind(this),this._demuxer.onScriptDataArrived=this._onScriptDataArrived.bind(this),this._remuxer.bindDataSource(this._demuxer.bindDataSource(this._ioctl)),this._remuxer.onInitSegment=this._onRemuxerInitSegmentArrival.bind(this),this._remuxer.onMediaSegment=this._onRemuxerMediaSegmentArrival.bind(this),a=this._demuxer.parseChunks(e,t)}else i=null,n.default.e(this.TAG,"Non-FLV, Unsupported media type!"),Promise.resolve().then((function(){r._internalAbort()})),this._emitter.emit(c.default.DEMUX_ERROR,d.default.FORMAT_UNSUPPORTED,"Non-FLV, Unsupported media type"),a=0;return a},e.prototype._onMediaInfo=function(e){var t=this;null==this._mediaInfo&&(this._mediaInfo=Object.assign({},e),this._mediaInfo.keyframesIndex=null,this._mediaInfo.segments=[],this._mediaInfo.segmentCount=this._mediaDataSource.segments.length,Object.setPrototypeOf(this._mediaInfo,o.default.prototype));var r=Object.assign({},e);Object.setPrototypeOf(r,o.default.prototype),this._mediaInfo.segments[this._currentSegmentIndex]=r,this._reportSegmentMediaInfo(this._currentSegmentIndex),null!=this._pendingSeekTime&&Promise.resolve().then((function(){var e=t._pendingSeekTime;t._pendingSeekTime=null,t.seek(e)}))},e.prototype._onMetaDataArrived=function(e){this._emitter.emit(c.default.METADATA_ARRIVED,e)},e.prototype._onScriptDataArrived=function(e){this._emitter.emit(c.default.SCRIPTDATA_ARRIVED,e)},e.prototype._onIOSeeked=function(){this._remuxer.insertDiscontinuity()},e.prototype._onIOComplete=function(e){var t=e+1;t<this._mediaDataSource.segments.length?(this._internalAbort(),this._remuxer.flushStashedSamples(),this._loadSegment(t)):(this._remuxer.flushStashedSamples(),this._emitter.emit(c.default.LOADING_COMPLETE),this._disableStatisticsReporter())},e.prototype._onIORedirect=function(e){var t=this._ioctl.extraData;this._mediaDataSource.segments[t].redirectedURL=e},e.prototype._onIORecoveredEarlyEof=function(){this._emitter.emit(c.default.RECOVERED_EARLY_EOF)},e.prototype._onIOException=function(e,t){n.default.e(this.TAG,"IOException: type = "+e+", code = "+t.code+", msg = "+t.msg),this._emitter.emit(c.default.IO_ERROR,e,t),this._disableStatisticsReporter()},e.prototype._onDemuxException=function(e,t){n.default.e(this.TAG,"DemuxException: type = "+e+", info = "+t),this._emitter.emit(c.default.DEMUX_ERROR,e,t)},e.prototype._onRemuxerInitSegmentArrival=function(e,t){this._emitter.emit(c.default.INIT_SEGMENT,e,t)},e.prototype._onRemuxerMediaSegmentArrival=function(e,t){if(null==this._pendingSeekTime&&(this._emitter.emit(c.default.MEDIA_SEGMENT,e,t),null!=this._pendingResolveSeekPoint&&"video"===e)){var r=t.info.syncPoints,i=this._pendingResolveSeekPoint;this._pendingResolveSeekPoint=null,s.default.safari&&r.length>0&&r[0].originalDts===i&&(i=r[0].pts),this._emitter.emit(c.default.RECOMMEND_SEEKPOINT,i)}},e.prototype._enableStatisticsReporter=function(){null==this._statisticsReporter&&(this._statisticsReporter=self.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval))},e.prototype._disableStatisticsReporter=function(){this._statisticsReporter&&(self.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype._reportSegmentMediaInfo=function(e){var t=this._mediaInfo.segments[e],r=Object.assign({},t);r.duration=this._mediaInfo.duration,r.segmentCount=this._mediaInfo.segmentCount,delete r.segments,delete r.keyframesIndex,this._emitter.emit(c.default.MEDIA_INFO,r)},e.prototype._reportStatisticsInfo=function(){var e={};e.url=this._ioctl.currentURL,e.hasRedirect=this._ioctl.hasRedirect,e.hasRedirect&&(e.redirectedURL=this._ioctl.currentRedirectedURL),e.speed=this._ioctl.currentSpeed,e.loaderType=this._ioctl.loaderType,e.currentSegmentIndex=this._currentSegmentIndex,e.totalSegmentCount=this._mediaDataSource.segments.length,this._emitter.emit(c.default.STATISTICS_INFO,e)},e}();t.default=h},"./src/core/transmuxing-events.js":
/*!****************************************!*\
  !*** ./src/core/transmuxing-events.js ***!
  \****************************************/function(e,t,r){"use strict";r.r(t),t.default={IO_ERROR:"io_error",DEMUX_ERROR:"demux_error",INIT_SEGMENT:"init_segment",MEDIA_SEGMENT:"media_segment",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info",RECOMMEND_SEEKPOINT:"recommend_seekpoint"}},"./src/core/transmuxing-worker.js":
/*!****************************************!*\
  !*** ./src/core/transmuxing-worker.js ***!
  \****************************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/logging-control.js */"./src/utils/logging-control.js"),a=r(/*! ../utils/polyfill.js */"./src/utils/polyfill.js"),n=r(/*! ./transmuxing-controller.js */"./src/core/transmuxing-controller.js"),s=r(/*! ./transmuxing-events.js */"./src/core/transmuxing-events.js");t.default=function(e){var t=null,r=function(t,r){e.postMessage({msg:"logcat_callback",data:{type:t,logcat:r}})}.bind(this);function o(t,r){var i={msg:s.default.INIT_SEGMENT,data:{type:t,data:r}};e.postMessage(i,[r.data])}function l(t,r){var i={msg:s.default.MEDIA_SEGMENT,data:{type:t,data:r}};e.postMessage(i,[r.data])}function _(){var t={msg:s.default.LOADING_COMPLETE};e.postMessage(t)}function d(){var t={msg:s.default.RECOVERED_EARLY_EOF};e.postMessage(t)}function u(t){var r={msg:s.default.MEDIA_INFO,data:t};e.postMessage(r)}function c(t){var r={msg:s.default.METADATA_ARRIVED,data:t};e.postMessage(r)}function h(t){var r={msg:s.default.SCRIPTDATA_ARRIVED,data:t};e.postMessage(r)}function f(t){var r={msg:s.default.STATISTICS_INFO,data:t};e.postMessage(r)}function p(t,r){e.postMessage({msg:s.default.IO_ERROR,data:{type:t,info:r}})}function m(t,r){e.postMessage({msg:s.default.DEMUX_ERROR,data:{type:t,info:r}})}function y(t){e.postMessage({msg:s.default.RECOMMEND_SEEKPOINT,data:t})}a.default.install(),e.addEventListener("message",(function(a){switch(a.data.cmd){case"init":(t=new n.default(a.data.param[0],a.data.param[1])).on(s.default.IO_ERROR,p.bind(this)),t.on(s.default.DEMUX_ERROR,m.bind(this)),t.on(s.default.INIT_SEGMENT,o.bind(this)),t.on(s.default.MEDIA_SEGMENT,l.bind(this)),t.on(s.default.LOADING_COMPLETE,_.bind(this)),t.on(s.default.RECOVERED_EARLY_EOF,d.bind(this)),t.on(s.default.MEDIA_INFO,u.bind(this)),t.on(s.default.METADATA_ARRIVED,c.bind(this)),t.on(s.default.SCRIPTDATA_ARRIVED,h.bind(this)),t.on(s.default.STATISTICS_INFO,f.bind(this)),t.on(s.default.RECOMMEND_SEEKPOINT,y.bind(this));break;case"destroy":t&&(t.destroy(),t=null),e.postMessage({msg:"destroyed"});break;case"start":t.start();break;case"stop":t.stop();break;case"seek":t.seek(a.data.param);break;case"pause":t.pause();break;case"resume":t.resume();break;case"logging_config":var g=a.data.param;i.default.applyConfig(g),!0===g.enableCallback?i.default.addLogListener(r):i.default.removeLogListener(r)}}))}},"./src/demux/amf-parser.js":
/*!*********************************!*\
  !*** ./src/demux/amf-parser.js ***!
  \*********************************/function(e,t,r){"use strict";r.r(t);var i,a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),n=r(/*! ../utils/utf8-conv.js */"./src/utils/utf8-conv.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0]),l=function(){function e(){}return e.parseScriptData=function(t,r,i){var n={};try{var s=e.parseValue(t,r,i),o=e.parseValue(t,r+s.size,i-s.size);n[s.data]=o.data}catch(e){a.default.e("AMF",e.toString())}return n},e.parseObject=function(t,r,i){if(i<3)throw new s.IllegalStateException("Data not enough when parse ScriptDataObject");var a=e.parseString(t,r,i),n=e.parseValue(t,r+a.size,i-a.size),o=n.objectEnd;return{data:{name:a.data,value:n.data},size:a.size+n.size,objectEnd:o}},e.parseVariable=function(t,r,i){return e.parseObject(t,r,i)},e.parseString=function(e,t,r){if(r<2)throw new s.IllegalStateException("Data not enough when parse String");var i=new DataView(e,t,r).getUint16(0,!o);return{data:i>0?(0,n.default)(new Uint8Array(e,t+2,i)):"",size:2+i}},e.parseLongString=function(e,t,r){if(r<4)throw new s.IllegalStateException("Data not enough when parse LongString");var i=new DataView(e,t,r).getUint32(0,!o);return{data:i>0?(0,n.default)(new Uint8Array(e,t+4,i)):"",size:4+i}},e.parseDate=function(e,t,r){if(r<10)throw new s.IllegalStateException("Data size invalid when parse Date");var i=new DataView(e,t,r),a=i.getFloat64(0,!o),n=i.getInt16(8,!o);return{data:new Date(a+=60*n*1e3),size:10}},e.parseValue=function(t,r,i){if(i<1)throw new s.IllegalStateException("Data not enough when parse Value");var n,l=new DataView(t,r,i),_=1,d=l.getUint8(0),u=!1;try{switch(d){case 0:n=l.getFloat64(1,!o),_+=8;break;case 1:n=!!l.getUint8(1),_+=1;break;case 2:var c=e.parseString(t,r+1,i-1);n=c.data,_+=c.size;break;case 3:n={};var h=0;for(9==(16777215&l.getUint32(i-4,!o))&&(h=3);_<i-4;){var f=e.parseObject(t,r+_,i-_-h);if(f.objectEnd)break;n[f.data.name]=f.data.value,_+=f.size}_<=i-3&&9==(16777215&l.getUint32(_-1,!o))&&(_+=3);break;case 8:for(n={},_+=4,h=0,9==(16777215&l.getUint32(i-4,!o))&&(h=3);_<i-8;){var p=e.parseVariable(t,r+_,i-_-h);if(p.objectEnd)break;n[p.data.name]=p.data.value,_+=p.size}_<=i-3&&9==(16777215&l.getUint32(_-1,!o))&&(_+=3);break;case 9:n=void 0,_=1,u=!0;break;case 10:n=[];var m=l.getUint32(1,!o);_+=4;for(var y=0;y<m;y++){var g=e.parseValue(t,r+_,i-_);n.push(g.data),_+=g.size}break;case 11:var v=e.parseDate(t,r+1,i-1);n=v.data,_+=v.size;break;case 12:var b=e.parseString(t,r+1,i-1);n=b.data,_+=b.size;break;default:_=i,a.default.w("AMF","Unsupported AMF value type "+d)}}catch(e){a.default.e("AMF",e.toString())}return{data:n,size:_,objectEnd:u}},e}();t.default=l},"./src/demux/demux-errors.js":
/*!***********************************!*\
  !*** ./src/demux/demux-errors.js ***!
  \***********************************/function(e,t,r){"use strict";r.r(t),t.default={OK:"OK",FORMAT_ERROR:"FormatError",FORMAT_UNSUPPORTED:"FormatUnsupported",CODEC_UNSUPPORTED:"CodecUnsupported"}},"./src/demux/exp-golomb.js":
/*!*********************************!*\
  !*** ./src/demux/exp-golomb.js ***!
  \*********************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/exception.js */"./src/utils/exception.js"),a=function(){function e(e){this.TAG="ExpGolomb",this._buffer=e,this._buffer_index=0,this._total_bytes=e.byteLength,this._total_bits=8*e.byteLength,this._current_word=0,this._current_word_bits_left=0}return e.prototype.destroy=function(){this._buffer=null},e.prototype._fillCurrentWord=function(){var e=this._total_bytes-this._buffer_index;if(e<=0)throw new i.IllegalStateException("ExpGolomb: _fillCurrentWord() but no bytes available");var t=Math.min(4,e),r=new Uint8Array(4);r.set(this._buffer.subarray(this._buffer_index,this._buffer_index+t)),this._current_word=new DataView(r.buffer).getUint32(0,!1),this._buffer_index+=t,this._current_word_bits_left=8*t},e.prototype.readBits=function(e){if(e>32)throw new i.InvalidArgumentException("ExpGolomb: readBits() bits exceeded max 32bits!");if(e<=this._current_word_bits_left){var t=this._current_word>>>32-e;return this._current_word<<=e,this._current_word_bits_left-=e,t}var r=this._current_word_bits_left?this._current_word:0;r>>>=32-this._current_word_bits_left;var a=e-this._current_word_bits_left;this._fillCurrentWord();var n=Math.min(a,this._current_word_bits_left),s=this._current_word>>>32-n;return this._current_word<<=n,this._current_word_bits_left-=n,r=r<<n|s},e.prototype.readBool=function(){return 1===this.readBits(1)},e.prototype.readByte=function(){return this.readBits(8)},e.prototype._skipLeadingZero=function(){var e;for(e=0;e<this._current_word_bits_left;e++)if(this._current_word&2147483648>>>e)return this._current_word<<=e,this._current_word_bits_left-=e,e;return this._fillCurrentWord(),e+this._skipLeadingZero()},e.prototype.readUEG=function(){var e=this._skipLeadingZero();return this.readBits(e+1)-1},e.prototype.readSEG=function(){var e=this.readUEG();return 1&e?e+1>>>1:-1*(e>>>1)},e}();t.default=a},"./src/demux/flv-demuxer.js":
/*!**********************************!*\
  !*** ./src/demux/flv-demuxer.js ***!
  \**********************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ./amf-parser.js */"./src/demux/amf-parser.js"),n=r(/*! ./sps-parser.js */"./src/demux/sps-parser.js"),s=r(/*! ./hevc-sps-parser.js */"./src/demux/hevc-sps-parser.js"),o=r(/*! ./demux-errors.js */"./src/demux/demux-errors.js"),l=r(/*! ../core/media-info.js */"./src/core/media-info.js"),_=r(/*! ../utils/exception.js */"./src/utils/exception.js"),d=function(){function e(e,t){var r;this.TAG="FLVDemuxer",this._config=t,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null,this._dataOffset=e.dataOffset,this._firstParse=!0,this._dispatch=!1,this._hasAudio=e.hasAudioTrack,this._hasVideo=e.hasVideoTrack,this._hasAudioFlagOverrided=!1,this._hasVideoFlagOverrided=!1,this._audioInitialMetadataDispatched=!1,this._videoInitialMetadataDispatched=!1,this._mediaInfo=new l.default,this._mediaInfo.hasAudio=this._hasAudio,this._mediaInfo.hasVideo=this._hasVideo,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._naluLengthSize=4,this._timestampBase=0,this._timescale=1e3,this._duration=0,this._durationOverrided=!1,this._referenceFrameRate={fixed:!0,fps:23.976,fps_num:23976,fps_den:1e3},this._flvSoundRateTable=[5500,11025,22050,44100,48e3],this._mpegSamplingRates=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],this._mpegAudioV10SampleRateTable=[44100,48e3,32e3,0],this._mpegAudioV20SampleRateTable=[22050,24e3,16e3,0],this._mpegAudioV25SampleRateTable=[11025,12e3,8e3,0],this._mpegAudioL1BitRateTable=[0,32,64,96,128,160,192,224,256,288,320,352,384,416,448,-1],this._mpegAudioL2BitRateTable=[0,32,48,56,64,80,96,112,128,160,192,224,256,320,384,-1],this._mpegAudioL3BitRateTable=[0,32,40,48,56,64,80,96,112,128,160,192,224,256,320,-1],this._videoTrack={type:"video",id:1,sequenceNumber:0,samples:[],length:0},this._audioTrack={type:"audio",id:2,sequenceNumber:0,samples:[],length:0},this._littleEndian=(r=new ArrayBuffer(2),new DataView(r).setInt16(0,256,!0),256===new Int16Array(r)[0])}return e.prototype.destroy=function(){this._mediaInfo=null,this._metadata=null,this._audioMetadata=null,this._videoMetadata=null,this._videoTrack=null,this._audioTrack=null,this._onError=null,this._onMediaInfo=null,this._onMetaDataArrived=null,this._onScriptDataArrived=null,this._onTrackMetadata=null,this._onDataAvailable=null},e.probe=function(e){var t=new Uint8Array(e),r={match:!1};if(70!==t[0]||76!==t[1]||86!==t[2]||1!==t[3])return r;var i,a,n=(4&t[4])>>>2!=0,s=!!(1&t[4]),o=(i=t)[a=5]<<24|i[a+1]<<16|i[a+2]<<8|i[a+3];return o<9?r:{match:!0,consumed:o,dataOffset:o,hasAudioTrack:n,hasVideoTrack:s}},e.prototype.bindDataSource=function(e){return e.onDataArrival=this.parseChunks.bind(this),this},Object.defineProperty(e.prototype,"onTrackMetadata",{get:function(){return this._onTrackMetadata},set:function(e){this._onTrackMetadata=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaInfo",{get:function(){return this._onMediaInfo},set:function(e){this._onMediaInfo=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMetaDataArrived",{get:function(){return this._onMetaDataArrived},set:function(e){this._onMetaDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onScriptDataArrived",{get:function(){return this._onScriptDataArrived},set:function(e){this._onScriptDataArrived=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataAvailable",{get:function(){return this._onDataAvailable},set:function(e){this._onDataAvailable=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timestampBase",{get:function(){return this._timestampBase},set:function(e){this._timestampBase=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedDuration",{get:function(){return this._duration},set:function(e){this._durationOverrided=!0,this._duration=e,this._mediaInfo.duration=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasAudio",{set:function(e){this._hasAudioFlagOverrided=!0,this._hasAudio=e,this._mediaInfo.hasAudio=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"overridedHasVideo",{set:function(e){this._hasVideoFlagOverrided=!0,this._hasVideo=e,this._mediaInfo.hasVideo=e},enumerable:!1,configurable:!0}),e.prototype.resetMediaInfo=function(){this._mediaInfo=new l.default},e.prototype._isInitialMetadataDispatched=function(){return this._hasAudio&&this._hasVideo?this._audioInitialMetadataDispatched&&this._videoInitialMetadataDispatched:this._hasAudio&&!this._hasVideo?this._audioInitialMetadataDispatched:!(this._hasAudio||!this._hasVideo)&&this._videoInitialMetadataDispatched},e.prototype.parseChunks=function(t,r){if(!(this._onError&&this._onMediaInfo&&this._onTrackMetadata&&this._onDataAvailable))throw new _.IllegalStateException("Flv: onError & onMediaInfo & onTrackMetadata & onDataAvailable callback must be specified");var a=0,n=this._littleEndian;if(0===r){if(!(t.byteLength>13))return 0;a=e.probe(t).dataOffset}for(this._firstParse&&(this._firstParse=!1,r+a!==this._dataOffset&&i.default.w(this.TAG,"First time parsing but chunk byteStart invalid!"),0!==(s=new DataView(t,a)).getUint32(0,!n)&&i.default.w(this.TAG,"PrevTagSize0 !== 0 !!!"),a+=4);a<t.byteLength;){this._dispatch=!0;var s=new DataView(t,a);if(a+11+4>t.byteLength)break;var o=s.getUint8(0),l=16777215&s.getUint32(0,!n);if(a+11+l+4>t.byteLength)break;if(8===o||9===o||18===o){var d=s.getUint8(4),u=s.getUint8(5),c=s.getUint8(6)|u<<8|d<<16|s.getUint8(7)<<24;16777215&s.getUint32(7,!n)&&i.default.w(this.TAG,"Meet tag which has StreamID != 0!");var h=a+11;switch(o){case 8:this._parseAudioData(t,h,l,c);break;case 9:this._parseVideoData(t,h,l,c,r+a);break;case 18:this._parseScriptData(t,h,l)}var f=s.getUint32(11+l,!n);f!==11+l&&i.default.w(this.TAG,"Invalid PrevTagSize "+f),a+=11+l+4}else i.default.w(this.TAG,"Unsupported tag type "+o+", skipped"),a+=11+l+4}return this._isInitialMetadataDispatched()&&this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack),a},e.prototype._parseScriptData=function(e,t,r){var n=a.default.parseScriptData(e,t,r);if(n.hasOwnProperty("onMetaData")){if(null==n.onMetaData||"object"!=typeof n.onMetaData)return void i.default.w(this.TAG,"Invalid onMetaData structure!");this._metadata&&i.default.w(this.TAG,"Found another onMetaData tag!"),this._metadata=n;var s=this._metadata.onMetaData;if(this._onMetaDataArrived&&this._onMetaDataArrived(Object.assign({},s)),"boolean"==typeof s.hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=s.hasAudio,this._mediaInfo.hasAudio=this._hasAudio),"boolean"==typeof s.hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=s.hasVideo,this._mediaInfo.hasVideo=this._hasVideo),"number"==typeof s.audiodatarate&&(this._mediaInfo.audioDataRate=s.audiodatarate),"number"==typeof s.videodatarate&&(this._mediaInfo.videoDataRate=s.videodatarate),"number"==typeof s.width&&(this._mediaInfo.width=s.width),"number"==typeof s.height&&(this._mediaInfo.height=s.height),"number"==typeof s.duration){if(!this._durationOverrided){var o=Math.floor(s.duration*this._timescale);this._duration=o,this._mediaInfo.duration=o}}else this._mediaInfo.duration=0;if("number"==typeof s.framerate){var l=Math.floor(1e3*s.framerate);if(l>0){var _=l/1e3;this._referenceFrameRate.fixed=!0,this._referenceFrameRate.fps=_,this._referenceFrameRate.fps_num=l,this._referenceFrameRate.fps_den=1e3,this._mediaInfo.fps=_}}if("object"==typeof s.keyframes){this._mediaInfo.hasKeyframesIndex=!0;var d=s.keyframes;this._mediaInfo.keyframesIndex=this._parseKeyframesIndex(d),s.keyframes=null}else this._mediaInfo.hasKeyframesIndex=!1;this._dispatch=!1,this._mediaInfo.metadata=s,i.default.v(this.TAG,"Parsed onMetaData"),this._mediaInfo.isComplete()&&this._onMediaInfo(this._mediaInfo)}Object.keys(n).length>0&&this._onScriptDataArrived&&this._onScriptDataArrived(Object.assign({},n))},e.prototype._parseKeyframesIndex=function(e){for(var t=[],r=[],i=1;i<e.times.length;i++){var a=this._timestampBase+Math.floor(1e3*e.times[i]);t.push(a),r.push(e.filepositions[i])}return{times:t,filepositions:r}},e.prototype._parseAudioData=function(e,t,r,a){if(r<=1)i.default.w(this.TAG,"Flv: Invalid audio packet, missing SoundData payload!");else if(!0!==this._hasAudioFlagOverrided||!1!==this._hasAudio){this._littleEndian;var n=new DataView(e,t,r).getUint8(0),s=n>>>4;if(2===s||10===s){var l=0,_=(12&n)>>>2;if(_>=0&&_<=4){l=this._flvSoundRateTable[_];var d=1&n,u=this._audioMetadata,c=this._audioTrack;if(u||(!1===this._hasAudio&&!1===this._hasAudioFlagOverrided&&(this._hasAudio=!0,this._mediaInfo.hasAudio=!0),(u=this._audioMetadata={}).type="audio",u.id=c.id,u.timescale=this._timescale,u.duration=this._duration,u.audioSampleRate=l,u.channelCount=0===d?1:2),10===s){var h=this._parseAACAudioData(e,t+1,r-1);if(null==h)return;if(0===h.packetType){u.config&&i.default.w(this.TAG,"Found another AudioSpecificConfig!");var f=h.data;u.audioSampleRate=f.samplingRate,u.channelCount=f.channelCount,u.codec=f.codec,u.originalCodec=f.originalCodec,u.config=f.config,u.refSampleDuration=1024/u.audioSampleRate*u.timescale,i.default.v(this.TAG,"Parsed AudioSpecificConfig"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._audioInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("audio",u),(y=this._mediaInfo).audioCodec=u.originalCodec,y.audioSampleRate=u.audioSampleRate,y.audioChannelCount=u.channelCount,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()&&this._onMediaInfo(y)}else if(1===h.packetType){var p=this._timestampBase+a,m={unit:h.data,length:h.data.byteLength,dts:p,pts:p};c.samples.push(m),c.length+=h.data.length}else i.default.e(this.TAG,"Flv: Unsupported AAC data type "+h.packetType)}else if(2===s){if(!u.codec){var y;if(null==(f=this._parseMP3AudioData(e,t+1,r-1,!0)))return;u.audioSampleRate=f.samplingRate,u.channelCount=f.channelCount,u.codec=f.codec,u.originalCodec=f.originalCodec,u.refSampleDuration=1152/u.audioSampleRate*u.timescale,i.default.v(this.TAG,"Parsed MPEG Audio Frame Header"),this._audioInitialMetadataDispatched=!0,this._onTrackMetadata("audio",u),(y=this._mediaInfo).audioCodec=u.codec,y.audioSampleRate=u.audioSampleRate,y.audioChannelCount=u.channelCount,y.audioDataRate=f.bitRate,y.hasVideo?null!=y.videoCodec&&(y.mimeType='video/x-flv; codecs="'+y.videoCodec+","+y.audioCodec+'"'):y.mimeType='video/x-flv; codecs="'+y.audioCodec+'"',y.isComplete()&&this._onMediaInfo(y)}var g=this._parseMP3AudioData(e,t+1,r-1,!1);if(null==g)return;p=this._timestampBase+a;var v={unit:g,length:g.byteLength,dts:p,pts:p};c.samples.push(v),c.length+=g.length}}else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid audio sample rate idx: "+_)}else this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported audio codec idx: "+s)}},e.prototype._parseAACAudioData=function(e,t,r){if(!(r<=1)){var a={},n=new Uint8Array(e,t,r);return a.packetType=n[0],0===n[0]?a.data=this._parseAACAudioSpecificConfig(e,t+1,r-1):a.data=n.subarray(1),a}i.default.w(this.TAG,"Flv: Invalid AAC packet, missing AACPacketType or/and Data!")},e.prototype._parseAACAudioSpecificConfig=function(e,t,r){var i,a,n=new Uint8Array(e,t,r),s=null,l=0,_=null;if(l=i=n[0]>>>3,(a=(7&n[0])<<1|n[1]>>>7)<0||a>=this._mpegSamplingRates.length)this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid sampling frequency index!");else{var d=this._mpegSamplingRates[a],u=(120&n[1])>>>3;if(!(u<0||u>=8)){5===l&&(_=(7&n[1])<<1|n[2]>>>7,n[2]);var c=self.navigator.userAgent.toLowerCase();return-1!==c.indexOf("firefox")?a>=6?(l=5,s=new Array(4),_=a-3):(l=2,s=new Array(2),_=a):-1!==c.indexOf("android")?(l=2,s=new Array(2),_=a):(l=5,_=a,s=new Array(4),a>=6?_=a-3:1===u&&(l=2,s=new Array(2),_=a)),s[0]=l<<3,s[0]|=(15&a)>>>1,s[1]=(15&a)<<7,s[1]|=(15&u)<<3,5===l&&(s[1]|=(15&_)>>>1,s[2]=(1&_)<<7,s[2]|=8,s[3]=0),{config:s,samplingRate:d,channelCount:u,codec:"mp4a.40."+l,originalCodec:"mp4a.40."+i}}this._onError(o.default.FORMAT_ERROR,"Flv: AAC invalid channel configuration")}},e.prototype._parseMP3AudioData=function(e,t,r,a){if(!(r<4)){this._littleEndian;var n=new Uint8Array(e,t,r),s=null;if(a){if(255!==n[0])return;var o=n[1]>>>3&3,l=(6&n[1])>>1,_=(240&n[2])>>>4,d=(12&n[2])>>>2,u=3&~(n[3]>>>6)?2:1,c=0,h=0;switch(o){case 0:c=this._mpegAudioV25SampleRateTable[d];break;case 2:c=this._mpegAudioV20SampleRateTable[d];break;case 3:c=this._mpegAudioV10SampleRateTable[d]}switch(l){case 1:_<this._mpegAudioL3BitRateTable.length&&(h=this._mpegAudioL3BitRateTable[_]);break;case 2:_<this._mpegAudioL2BitRateTable.length&&(h=this._mpegAudioL2BitRateTable[_]);break;case 3:_<this._mpegAudioL1BitRateTable.length&&(h=this._mpegAudioL1BitRateTable[_])}s={bitRate:h,samplingRate:c,channelCount:u,codec:"mp3",originalCodec:"mp3"}}else s=n;return s}i.default.w(this.TAG,"Flv: Invalid MP3 packet, header missing!")},e.prototype._parseVideoData=function(e,t,r,a,n){if(r<=1)i.default.w(this.TAG,"Flv: Invalid video packet, missing VideoData payload!");else if(!0!==this._hasVideoFlagOverrided||!1!==this._hasVideo){var s=new Uint8Array(e,t,r)[0],l=(240&s)>>>4,_=15&s;7===_||12===_?7===_?this._parseAVCVideoPacket(e,t+1,r-1,a,n,l):12===_&&this._parseHVCVideoPacket(e,t+1,r-1,a,n,l):this._onError(o.default.CODEC_UNSUPPORTED,"Flv: Unsupported codec in video frame: "+_)}},e.prototype._parseAVCVideoPacket=function(e,t,r,a,n,s){if(r<4)i.default.w(this.TAG,"Flv: Invalid AVC packet, missing AVCPacketType or/and CompositionTime");else{var l=this._littleEndian,_=new DataView(e,t,r),d=_.getUint8(0),u=(16777215&_.getUint32(0,!l))<<8>>8;if(0===d)this._parseAVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===d)this._parseAVCVideoData(e,t+4,r-4,a,n,s,u);else if(2!==d)return void this._onError(o.default.FORMAT_ERROR,"Flv: Invalid video packet type "+d)}},e.prototype._parseAVCDecoderConfigurationRecord=function(e,t,r){if(r<7)i.default.w(this.TAG,"Flv: Invalid AVCDecoderConfigurationRecord, lack of data!");else{var a=this._videoMetadata,s=this._videoTrack,l=this._littleEndian,_=new DataView(e,t,r);a?void 0!==a.avcc&&i.default.w(this.TAG,"Found another AVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(a=this._videoMetadata={}).type="video",a.id=s.id,a.timescale=this._timescale,a.duration=this._duration);var d=_.getUint8(0),u=_.getUint8(1);if(_.getUint8(2),_.getUint8(3),1===d&&0!==u)if(this._naluLengthSize=1+(3&_.getUint8(4)),3===this._naluLengthSize||4===this._naluLengthSize){var c=31&_.getUint8(5);if(0!==c){c>1&&i.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: SPS Count = "+c);for(var h=6,f=0;f<c;f++){var p=_.getUint16(h,!l);if(h+=2,0!==p){var m=new Uint8Array(e,t+h,p);h+=p;var y=n.default.parseSPS(m);if(0===f){a.codecWidth=y.codec_size.width,a.codecHeight=y.codec_size.height,a.presentWidth=y.present_size.width,a.presentHeight=y.present_size.height,a.profile=y.profile_string,a.level=y.level_string,a.bitDepth=y.bit_depth,a.chromaFormat=y.chroma_format,a.sarRatio=y.sar_ratio,a.frameRate=y.frame_rate,!1!==y.frame_rate.fixed&&0!==y.frame_rate.fps_num&&0!==y.frame_rate.fps_den||(a.frameRate=this._referenceFrameRate);var g=a.frameRate.fps_den,v=a.frameRate.fps_num;a.refSampleDuration=a.timescale*(g/v);for(var b=m.subarray(1,4),E="avc1.",w=0;w<3;w++){var S=b[w].toString(16);S.length<2&&(S="0"+S),E+=S}a.codec=E;var L=this._mediaInfo;L.width=a.codecWidth,L.height=a.codecHeight,L.fps=a.frameRate.fps,L.profile=a.profile,L.level=a.level,L.refFrames=y.ref_frames,L.chromaFormat=y.chroma_format_string,L.sarNum=a.sarRatio.width,L.sarDen=a.sarRatio.height,L.videoCodec=E,L.hasAudio?null!=L.audioCodec&&(L.mimeType='video/x-flv; codecs="'+L.videoCodec+","+L.audioCodec+'"'):L.mimeType='video/x-flv; codecs="'+L.videoCodec+'"',L.isComplete()&&this._onMediaInfo(L)}}}var k=_.getUint8(h);if(0!==k){for(k>1&&i.default.w(this.TAG,"Flv: Strange AVCDecoderConfigurationRecord: PPS Count = "+k),h++,f=0;f<k;f++)p=_.getUint16(h,!l),h+=2,0!==p&&(h+=p);a.avcc=new Uint8Array(r),a.avcc.set(new Uint8Array(e,t,r),0),i.default.v(this.TAG,"Parsed AVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",a)}else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No PPS")}else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord: No SPS")}else this._onError(o.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid AVCDecoderConfigurationRecord")}},e.prototype._parseAVCVideoData=function(e,t,r,a,n,s,o){for(var l=this._littleEndian,_=new DataView(e,t,r),d=[],u=0,c=0,h=this._naluLengthSize,f=this._timestampBase+a,p=1===s;c<r;){if(c+4>=r){i.default.w(this.TAG,"Malformed Nalu near timestamp "+f+", offset = "+c+", dataSize = "+r);break}var m=_.getUint32(c,!l);if(3===h&&(m>>>=8),m>r-h)return void i.default.w(this.TAG,"Malformed Nalus near timestamp "+f+", NaluSize > DataSize!");var y=31&_.getUint8(c+h);5===y&&(p=!0);var g=new Uint8Array(e,t+c,h+m),v={type:y,data:g};d.push(v),u+=g.byteLength,c+=h+m}if(d.length){var b=this._videoTrack,E={units:d,length:u,isKeyframe:p,dts:f,cts:o,pts:f+o};p&&(E.fileposition=n),b.samples.push(E),b.length+=u}},e.prototype._parseHVCVideoPacket=function(e,t,r,a,n,s){if(r<4)i.default.w(this.TAG,"Flv: Invalid HVC packet, missing HVCPacketType or/and CompositionTime");else{var l=this._littleEndian,_=new DataView(e,t,r),d=_.getUint8(0),u=(16777215&_.getUint32(0,!l))<<8>>8;if(0===d)this._parseHVCDecoderConfigurationRecord(e,t+4,r-4);else if(1===d)this._parseHVCVideoData(e,t+4,r-4,a,n,s,u);else if(2!==d)return void this._onError(o.default.FORMAT_ERROR,"Flv: Invalid video packet type "+d)}},e.prototype._parseHVCDecoderConfigurationRecord=function(e,t,r){if(r<23)i.default.w(this.TAG,"Flv: Invalid HVCDecoderConfigurationRecord, lack of data!");else{var a=this._videoMetadata,n=this._videoTrack,l=this._littleEndian,_=new DataView(e,t,r);if(a?void 0!==a.avcc&&i.default.w(this.TAG,"Found another HVCDecoderConfigurationRecord!"):(!1===this._hasVideo&&!1===this._hasVideoFlagOverrided&&(this._hasVideo=!0,this._mediaInfo.hasVideo=!0),(a=this._videoMetadata={}).type="video",a.id=n.id,a.timescale=this._timescale,a.duration=this._duration),1===_.getUint8(0))if(this._naluLengthSize=1+(3&_.getUint8(21)),3===this._naluLengthSize||4===this._naluLengthSize){for(var d,u,c,h=_.getUint8(22),f=23,p=[],m=0;m<h;m++){var y=63&_.getUint8(f++),g=_.getUint16(f,!l);if(f+=2,0!==g){switch(y){case 32:d+=g;break;case 33:u+=g;break;case 34:c+=g}for(var v=0;v<g;v++){var b=_.getUint16(f,!l);if(f+=2,0!==b){if(33===y){var E=new Uint8Array(e,t+f,b);p.push(E)}f+=b}}}}if(0!==d)if(d>1&&i.default.w(this.TAG,"Flv: Strange HVCDecoderConfigurationRecord: VPS Count = "+d),0!==u)if(u>1&&i.default.w(this.TAG,"Flv: Strange HVCDecoderConfigurationRecord: SPS Count = "+u),0!==c){c>1&&i.default.w(this.TAG,"Flv: Strange HVCDecoderConfigurationRecord: PPS Count = "+u);var w=p[0],S=s.default.parseSPS(w);a.codecWidth=S.codec_size.width,a.codecHeight=S.codec_size.height,a.presentWidth=S.present_size.width,a.presentHeight=S.present_size.height,a.profile=S.profile_string,a.level=S.level_string,a.profile_idc=S.profile_idc,a.level_idc=S.level_idc,a.bitDepth=S.bit_depth,a.chromaFormat=S.chroma_format,a.sarRatio=S.sar_ratio,a.frameRate=S.frame_rate,!1!==S.frame_rate.fixed&&0!==S.frame_rate.fps_num&&0!==S.frame_rate.fps_den||(a.frameRate=this._referenceFrameRate);var L=a.frameRate.fps_den,k=a.frameRate.fps_num;a.refSampleDuration=a.timescale*(L/k);var A="hvc1."+a.profile_idc+".1.L"+a.level_idc+".B0";a.codec=A;var x=this._mediaInfo;x.width=a.codecWidth,x.height=a.codecHeight,x.fps=a.frameRate.fps,x.profile=a.profile,x.level=a.level,x.refFrames=S.ref_frames,x.chromaFormat=S.chroma_format_string,x.sarNum=a.sarRatio.width,x.sarDen=a.sarRatio.height,x.videoCodec=A,x.hasAudio?null!=x.audioCodec&&(x.mimeType='video/x-flv; codecs="'+x.videoCodec+","+x.audioCodec+'"'):x.mimeType='video/x-flv; codecs="'+x.videoCodec+'"',x.isComplete()&&this._onMediaInfo(x),a.avcc=new Uint8Array(r),a.avcc.set(new Uint8Array(e,t,r),0),i.default.v(this.TAG,"Parsed HVCDecoderConfigurationRecord"),this._isInitialMetadataDispatched()?this._dispatch&&(this._audioTrack.length||this._videoTrack.length)&&this._onDataAvailable(this._audioTrack,this._videoTrack):this._videoInitialMetadataDispatched=!0,this._dispatch=!1,this._onTrackMetadata("video",a)}else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord: No PPS");else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord: No SPS");else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord: No VPS")}else this._onError(o.default.FORMAT_ERROR,"Flv: Strange NaluLengthSizeMinusOne: "+(this._naluLengthSize-1));else this._onError(o.default.FORMAT_ERROR,"Flv: Invalid HVCDecoderConfigurationRecord")}},e.prototype._parseHVCVideoData=function(e,t,r,a,n,s,o){for(var l=this._littleEndian,_=new DataView(e,t,r),d=[],u=0,c=0,h=this._naluLengthSize,f=this._timestampBase+a,p=1===s;c<r;){if(c+4>=r){i.default.w(this.TAG,"Malformed Nalu near timestamp "+f+", offset = "+c+", dataSize = "+r);break}var m=_.getUint32(c,!l);if(3===h&&(m>>>=8),m>r-h)return void i.default.w(this.TAG,"Malformed Nalus near timestamp "+f+", NaluSize > DataSize!");var y=_.getUint8(c+h)>>1&63;y>=16&&y<=23&&(p=!0);var g=new Uint8Array(e,t+c,h+m),v={type:y,data:g};d.push(v),u+=g.byteLength,c+=h+m}if(d.length){var b=this._videoTrack,E={units:d,length:u,isKeyframe:p,dts:f,cts:o,pts:f+o};p&&(E.fileposition=n),b.samples.push(E),b.length+=u}},e}();t.default=d},"./src/demux/hevc-sps-parser.js":
/*!**************************************!*\
  !*** ./src/demux/hevc-sps-parser.js ***!
  \**************************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ./exp-golomb.js */"./src/demux/exp-golomb.js"),a=r(/*! ./sps-parser.js */"./src/demux/sps-parser.js"),n=function(){function e(){}return e.parseSPS=function(t){var r=a.default._ebsp2rbsp(t),n=new i.default(r),s={};n.readBits(16),n.readBits(4);var o=n.readBits(3);n.readBits(1),e._hvcc_parse_ptl(n,s,o),n.readUEG();var l=0,_=n.readUEG();3==_&&(l=n.readBits(1)),s.sar_width=s.sar_height=1,s.conf_win_left_offset=s.conf_win_right_offset=s.conf_win_top_offset=s.conf_win_bottom_offset=0,s.def_disp_win_left_offset=s.def_disp_win_right_offset=s.def_disp_win_top_offset=s.def_disp_win_bottom_offset=0;var d=n.readUEG(),u=n.readUEG();n.readBits(1)&&(s.conf_win_left_offset=n.readUEG(),s.conf_win_right_offset=n.readUEG(),s.conf_win_top_offset=n.readUEG(),s.conf_win_bottom_offset=n.readUEG(),1===s.default_display_window_flag&&(s.conf_win_left_offset,s.def_disp_win_left_offset,s.conf_win_right_offset,s.def_disp_win_right_offset,s.conf_win_top_offset,s.def_disp_win_top_offset,s.conf_win_bottom_offset,s.def_disp_win_bottom_offset));var c=n.readUEG()+8;n.readUEG();for(var h=n.readUEG(),f=n.readBits(1)?0:o;f<=o;f++)e._skip_sub_layer_ordering_info(n);n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG(),n.readUEG(),n.readBits(1)&&n.readBits(1)&&e._skip_scaling_list_data(n),n.readBits(1),n.readBits(1),n.readBits(1)&&(n.readBits(4),n.readBits(4),n.readUEG(),n.readUEG(),n.readBits(1));var p=[],m=n.readUEG();for(f=0;f<m;f++){var y=e._parse_rps(n,f,m,p);if(y<0)return y}if(n.readBits(1)){var g=n.readUEG();for(f=0;f<g;f++){var v=Math.min(h+4,16);if(v>32){for(var b=v/32,E=v%32,w=0;w<b;w++)n.readBits(32);n.readBits(E)}else n.readBits(v);n.readBits(1)}}n.readBits(1),n.readBits(1),n.readBits(1)&&e._hvcc_parse_vui(n,s,o);var S=e.getProfileString(s.profile_idc),L=e.getLevelString(s.level_idc),k=1;1===s.sar_width&&1===s.sar_height||(k=s.sar_width/s.sar_height);var A=d,x=u,T=1===_&&0===l?2:1;A-=(1!==_&&2!=_||0!==l?1:2)*(s.conf_win_left_offset+s.conf_win_right_offset),x-=T*(s.conf_win_top_offset+s.conf_win_bottom_offset);var C=Math.ceil(A*k);return n.destroy(),n=null,{profile_string:S,level_string:L,profile_idc:s.profile_idc,level_idc:s.level_idc,bit_depth:c,ref_frames:1,chroma_format:_,chroma_format_string:e.getChromaFormatString(_),frame_rate:{fixed:s.fps_fixed,fps:s.fps,fps_den:s.fps_den,fps_num:s.fps_num},sar_ratio:{width:s.sar_width,height:s.sar_height},codec_size:{width:A,height:x},present_size:{width:C,height:x}}},e._hvcc_parse_ptl=function(e,t,r){e.readBits(2);var i=e.readBits(1),a=e.readBits(5);e.readBits(32),e.readBits(32),e.readBits(16);var n=e.readByte();void 0===t.tier_flag||void 0===t.level_idc||t.tier_flag<i?t.level_idc=n:t.level_idc=Math.max(t.level_idc,n),t.profile_idc=Math.max(void 0===t.profile_idc?0:t.profile_idc,a);for(var s=[],o=[],l=0;l<r;l++)s.push(e.readBits(1)),o.push(e.readBits(1));if(r>0)for(l=r;l<8;l++)e.readBits(2);for(l=0;l<r;l++)s[l]&&(e.readBits(32),e.readBits(32),e.readBits(24)),o[l]&&e.readByte()},e._parse_rps=function(e,t,r,i){if(t&&e.readBits(1)){if(t>=r)return-1;e.readBits(1),e.readUEG(),i[t]=0;for(var a=0;a<=i[t-1];a++){var n=0,s=e.readBits(1);s||(n=e.readBits(1)),(s||n)&&i[t]++}}else{var o=e.readUEG(),l=e.readUEG();for(i[t]=o+l,a=0;a<o;a++)e.readUEG(),e.readBits(1);for(a=0;a<l;a++)e.readUEG(),e.readBits(1)}return 0},e._hvcc_parse_vui=function(t,r,i){t.readBits(1)&&255==t.readByte()&&(r.sar_width=t.readBits(16),r.sar_height=t.readBits(16)),t.readBits(1)&&t.readBits(1),t.readBits(1)&&(t.readBits(4),t.readBits(1)&&t.readBits(24)),t.readBits(1)&&(t.readUEG(),t.readUEG()),t.readBits(3),r.default_display_window_flag=t.readBits(1),r.default_display_window_flag&&(r.def_disp_win_left_offset=t.readUEG(),r.def_disp_win_right_offset=t.readUEG(),r.def_disp_win_top_offset=t.readUEG(),r.def_disp_win_bottom_offset=t.readUEG()),t.readBits(1)&&(e._skip_timing_info(t,r),t.readBits(1)&&e._skip_hrd_parameters(t,r,1,i)),t.readBits(1)&&(t.readBits(3),t.readUEG(),t.readUEG(),t.readUEG(),t.readUEG(),t.readUEG())},e._skip_sub_layer_ordering_info=function(e,t){e.readUEG(),e.readUEG(),e.readUEG()},e._skip_scaling_list_data=function(e){for(var t=0;t<4;t++)for(var r=0;r<(3==t?2:6);r++)if(e.readBits(1)){var i=Math.min(64,1<<4+(t<<1));t>1&&e.readSEG();for(var a=0;a<i;a++)e.readSEG()}else e.readUEG()},e._skip_sub_layer_hrd_parameters=function(e,t,r){for(var i=0;i<=t;i++)e.readUEG(),e.readUEG(),r&&(e.readUEG(),e.readUEG()),e.readBits(1)},e._skip_timing_info=function(e,t){t.fps_den=e.readBits(32),t.fps_num=e.readBits(32),t.fps_den>0&&(t.fps=t.fps_num/t.fps_den);var r=0;e.readBits(1)&&(r=e.readUEG())>=0&&(t.fps/=r+1)},e._skip_hrd_parameters=function(t,r,i){var a=0,n=0;if(r&&(a=t.readBits(1),n=t.readBits(1),a||n)){var s=t.readBits(1);s&&t.readBits(19),t.readByte(),s&&t.readBits(4),t.readBits(15)}for(var o=0;o<=i;o++){var l=0,_=0,d=0,u=t.readBits(1);hvcc.fps_fixed=u,u||(d=t.readBits(1)),d?t.readUEG():_=t.readBits(1),_||(l=t.readUEG(t)),a&&e._skip_sub_layer_hrd_parameters(t,l,0),n&&e._skip_sub_layer_hrd_parameters(t,l,0)}},e.getProfileString=function(e){switch(e){case 1:return"Main";case 2:return"Main10";case 3:return"MainSP";case 4:return"Rext";case 9:return"SCC";default:return"Unknown"}},e.getLevelString=function(e){return(e/30).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 0:return"4:0:0";case 1:return"4:2:0";case 2:return"4:2:2";case 3:return"4:4:4";default:return"Unknown"}},e}();t.default=n},"./src/demux/sps-parser.js":
/*!*********************************!*\
  !*** ./src/demux/sps-parser.js ***!
  \*********************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ./exp-golomb.js */"./src/demux/exp-golomb.js"),a=function(){function e(){}return e._ebsp2rbsp=function(e){for(var t=e,r=t.byteLength,i=new Uint8Array(r),a=0,n=0;n<r;n++)n>=2&&3===t[n]&&0===t[n-1]&&0===t[n-2]||(i[a]=t[n],a++);return new Uint8Array(i.buffer,0,a)},e.parseSPS=function(t){var r=e._ebsp2rbsp(t),a=new i.default(r);a.readByte();var n=a.readByte();a.readByte();var s=a.readByte();a.readUEG();var o=e.getProfileString(n),l=e.getLevelString(s),_=1,d=420,u=8;if((100===n||110===n||122===n||244===n||44===n||83===n||86===n||118===n||128===n||138===n||144===n)&&(3===(_=a.readUEG())&&a.readBits(1),_<=3&&(d=[0,420,422,444][_]),u=a.readUEG()+8,a.readUEG(),a.readBits(1),a.readBool()))for(var c=3!==_?8:12,h=0;h<c;h++)a.readBool()&&(h<6?e._skipScalingList(a,16):e._skipScalingList(a,64));a.readUEG();var f=a.readUEG();if(0===f)a.readUEG();else if(1===f){a.readBits(1),a.readSEG(),a.readSEG();var p=a.readUEG();for(h=0;h<p;h++)a.readSEG()}var m=a.readUEG();a.readBits(1);var y=a.readUEG(),g=a.readUEG(),v=a.readBits(1);0===v&&a.readBits(1),a.readBits(1);var b=0,E=0,w=0,S=0;a.readBool()&&(b=a.readUEG(),E=a.readUEG(),w=a.readUEG(),S=a.readUEG());var L=1,k=1,A=0,x=!0,T=0,C=0;if(a.readBool()){if(a.readBool()){var R=a.readByte();R>0&&R<16?(L=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2][R-1],k=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1][R-1]):255===R&&(L=a.readByte()<<8|a.readByte(),k=a.readByte()<<8|a.readByte())}if(a.readBool()&&a.readBool(),a.readBool()&&(a.readBits(4),a.readBool()&&a.readBits(24)),a.readBool()&&(a.readUEG(),a.readUEG()),a.readBool()){var O=a.readBits(32),P=a.readBits(32);x=a.readBool(),A=(T=P)/(C=2*O)}}var I=1;1===L&&1===k||(I=L/k);var M=0,D=0;0===_?(M=1,D=2-v):(M=3===_?1:2,D=(1===_?2:1)*(2-v));var B=16*(y+1),F=16*(g+1)*(2-v);B-=(b+E)*M,F-=(w+S)*D;var U=Math.ceil(B*I);return a.destroy(),a=null,{profile_string:o,level_string:l,bit_depth:u,ref_frames:m,chroma_format:d,chroma_format_string:e.getChromaFormatString(d),frame_rate:{fixed:x,fps:A,fps_den:C,fps_num:T},sar_ratio:{width:L,height:k},codec_size:{width:B,height:F},present_size:{width:U,height:F}}},e._skipScalingList=function(e,t){for(var r=8,i=8,a=0;a<t;a++)0!==i&&(i=(r+e.readSEG()+256)%256),r=0===i?r:i},e.getProfileString=function(e){switch(e){case 66:return"Baseline";case 77:return"Main";case 88:return"Extended";case 100:return"High";case 110:return"High10";case 122:return"High422";case 244:return"High444";default:return"Unknown"}},e.getLevelString=function(e){return(e/10).toFixed(1)},e.getChromaFormatString=function(e){switch(e){case 420:return"4:2:0";case 422:return"4:2:2";case 444:return"4:4:4";default:return"Unknown"}},e}();t.default=a},"./src/flv.js":
/*!********************!*\
  !*** ./src/flv.js ***!
  \********************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ./utils/polyfill.js */"./src/utils/polyfill.js"),a=r(/*! ./core/features.js */"./src/core/features.js"),n=r(/*! ./io/loader.js */"./src/io/loader.js"),s=r(/*! ./player/flv-player.js */"./src/player/flv-player.js"),o=r(/*! ./player/native-player.js */"./src/player/native-player.js"),l=r(/*! ./player/player-events.js */"./src/player/player-events.js"),_=r(/*! ./player/player-errors.js */"./src/player/player-errors.js"),d=r(/*! ./utils/logging-control.js */"./src/utils/logging-control.js"),u=r(/*! ./utils/exception.js */"./src/utils/exception.js");i.default.install();var c={createPlayer:function(e,t){var r=e;if(null==r||"object"!=typeof r)throw new u.InvalidArgumentException("MediaDataSource must be an javascript object!");if(!r.hasOwnProperty("type"))throw new u.InvalidArgumentException("MediaDataSource must has type field to indicate video file type!");return"flv"===r.type?new s.default(r,t):new o.default(r,t)},isSupported:function(){return a.default.supportMSEH264Playback()},getFeatureList:function(){return a.default.getFeatureList()}};c.BaseLoader=n.BaseLoader,c.LoaderStatus=n.LoaderStatus,c.LoaderErrors=n.LoaderErrors,c.Events=l.default,c.ErrorTypes=_.ErrorTypes,c.ErrorDetails=_.ErrorDetails,c.FlvPlayer=s.default,c.NativePlayer=o.default,c.LoggingControl=d.default,Object.defineProperty(c,"version",{enumerable:!0,get:function(){return"1.7.0"}}),t.default=c},"./src/index.js":
/*!**********************!*\
  !*** ./src/index.js ***!
  \**********************/function(e,t,r){e.exports=r(/*! ./flv.js */"./src/flv.js").default},"./src/io/fetch-stream-loader.js":
/*!***************************************!*\
  !*** ./src/io/fetch-stream-loader.js ***!
  \***************************************/function(e,t,r){"use strict";r.r(t);var i,a=r(/*! ../utils/browser.js */"./src/utils/browser.js"),n=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(e){function t(t,r){var i=e.call(this,"fetch-stream-loader")||this;return i.TAG="FetchStreamLoader",i._seekHandler=t,i._config=r,i._needStash=!0,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return o(t,e),t.isSupported=function(){try{var e=a.default.msedge&&a.default.version.minor>=15048,t=!a.default.msedge||e;return self.fetch&&self.ReadableStream&&t}catch(e){return!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){var r=this;this._dataSource=e,this._range=t;var i=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(i=e.redirectedURL);var a=this._seekHandler.getConfig(i,t),o=new self.Headers;if("object"==typeof a.headers){var l=a.headers;for(var _ in l)l.hasOwnProperty(_)&&o.append(_,l[_])}var d={method:"GET",headers:o,mode:"cors",cache:"default",referrerPolicy:"no-referrer-when-downgrade"};if("object"==typeof this._config.headers)for(var _ in this._config.headers)o.append(_,this._config.headers[_]);!1===e.cors&&(d.mode="same-origin"),e.withCredentials&&(d.credentials="include"),e.referrerPolicy&&(d.referrerPolicy=e.referrerPolicy),self.AbortController&&(this._abortController=new self.AbortController,d.signal=this._abortController.signal),this._status=n.LoaderStatus.kConnecting,self.fetch(a.url,d).then((function(e){if(r._requestAbort)return r._status=n.LoaderStatus.kIdle,void e.body.cancel();if(e.ok&&e.status>=200&&e.status<=299){if(e.url!==a.url&&r._onURLRedirect){var t=r._seekHandler.removeURLParameters(e.url);r._onURLRedirect(t)}var i=e.headers.get("Content-Length");return null!=i&&(r._contentLength=parseInt(i),0!==r._contentLength&&r._onContentLengthKnown&&r._onContentLengthKnown(r._contentLength)),r._pump.call(r,e.body.getReader())}if(r._status=n.LoaderStatus.kError,!r._onError)throw new s.RuntimeException("FetchStreamLoader: Http code invalid, "+e.status+" "+e.statusText);r._onError(n.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:e.status,msg:e.statusText})})).catch((function(e){if(!r._abortController||!r._abortController.signal.aborted){if(r._status=n.LoaderStatus.kError,!r._onError)throw e;r._onError(n.LoaderErrors.EXCEPTION,{code:-1,msg:e.message})}}))},t.prototype.abort=function(){if(this._requestAbort=!0,(this._status!==n.LoaderStatus.kBuffering||!a.default.chrome)&&this._abortController)try{this._abortController.abort()}catch(e){}},t.prototype._pump=function(e){var t=this;return e.read().then((function(r){if(r.done)if(null!==t._contentLength&&t._receivedLength<t._contentLength){t._status=n.LoaderStatus.kError;var i=n.LoaderErrors.EARLY_EOF,a={code:-1,msg:"Fetch stream meet Early-EOF"};if(!t._onError)throw new s.RuntimeException(a.msg);t._onError(i,a)}else t._status=n.LoaderStatus.kComplete,t._onComplete&&t._onComplete(t._range.from,t._range.from+t._receivedLength-1);else{if(t._abortController&&t._abortController.signal.aborted)return void(t._status=n.LoaderStatus.kComplete);if(!0===t._requestAbort)return t._status=n.LoaderStatus.kComplete,e.cancel();t._status=n.LoaderStatus.kBuffering;var o=r.value.buffer,l=t._range.from+t._receivedLength;t._receivedLength+=o.byteLength,t._onDataArrival&&t._onDataArrival(o,l,t._receivedLength),t._pump(e)}})).catch((function(e){if(t._abortController&&t._abortController.signal.aborted)t._status=n.LoaderStatus.kComplete;else if(11!==e.code||!a.default.msedge){t._status=n.LoaderStatus.kError;var r=0,i=null;if(19!==e.code&&"network error"!==e.message||!(null===t._contentLength||null!==t._contentLength&&t._receivedLength<t._contentLength)?(r=n.LoaderErrors.EXCEPTION,i={code:e.code,msg:e.message}):(r=n.LoaderErrors.EARLY_EOF,i={code:e.code,msg:"Fetch stream meet Early-EOF"}),!t._onError)throw new s.RuntimeException(i.msg);t._onError(r,i)}}))},t}(n.BaseLoader);t.default=l},"./src/io/io-controller.js":
/*!*********************************!*\
  !*** ./src/io/io-controller.js ***!
  \*********************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),n=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ./fetch-stream-loader.js */"./src/io/fetch-stream-loader.js"),o=r(/*! ./xhr-moz-chunked-loader.js */"./src/io/xhr-moz-chunked-loader.js"),l=r(/*! ./xhr-range-loader.js */"./src/io/xhr-range-loader.js"),_=r(/*! ./websocket-loader.js */"./src/io/websocket-loader.js"),d=r(/*! ./range-seek-handler.js */"./src/io/range-seek-handler.js"),u=r(/*! ./param-seek-handler.js */"./src/io/param-seek-handler.js"),c=r(/*! ../utils/exception.js */"./src/utils/exception.js"),h=function(){function e(e,t,r){this.TAG="IOController",this._config=t,this._extraData=r,this._stashInitialSize=393216,null!=t.stashInitialSize&&t.stashInitialSize>0&&(this._stashInitialSize=t.stashInitialSize),this._stashUsed=0,this._stashSize=this._stashInitialSize,this._bufferSize=3145728,this._stashBuffer=new ArrayBuffer(this._bufferSize),this._stashByteStart=0,this._enableStash=!0,!1===t.enableStashBuffer&&(this._enableStash=!1),this._loader=null,this._loaderClass=null,this._seekHandler=null,this._dataSource=e,this._isWebSocketURL=/wss?:\/\/(.+?)/.test(e.url),this._refTotalLength=e.filesize?e.filesize:null,this._totalLength=this._refTotalLength,this._fullRequestFlag=!1,this._currentRange=null,this._redirectedURL=null,this._speedNormalized=0,this._speedSampler=new a.default,this._speedNormalizeList=[64,128,256,384,512,768,1024,1536,2048,3072,4096],this._isEarlyEofReconnecting=!1,this._paused=!1,this._resumeFrom=0,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._selectSeekHandler(),this._selectLoader(),this._createLoader()}return e.prototype.destroy=function(){this._loader.isWorking()&&this._loader.abort(),this._loader.destroy(),this._loader=null,this._loaderClass=null,this._dataSource=null,this._stashBuffer=null,this._stashUsed=this._stashSize=this._bufferSize=this._stashByteStart=0,this._currentRange=null,this._speedSampler=null,this._isEarlyEofReconnecting=!1,this._onDataArrival=null,this._onSeeked=null,this._onError=null,this._onComplete=null,this._onRedirect=null,this._onRecoveredEarlyEof=null,this._extraData=null},e.prototype.isWorking=function(){return this._loader&&this._loader.isWorking()&&!this._paused},e.prototype.isPaused=function(){return this._paused},Object.defineProperty(e.prototype,"status",{get:function(){return this._loader.status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"extraData",{get:function(){return this._extraData},set:function(e){this._extraData=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSeeked",{get:function(){return this._onSeeked},set:function(e){this._onSeeked=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRedirect",{get:function(){return this._onRedirect},set:function(e){this._onRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecoveredEarlyEof",{get:function(){return this._onRecoveredEarlyEof},set:function(e){this._onRecoveredEarlyEof=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentURL",{get:function(){return this._dataSource.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasRedirect",{get:function(){return null!=this._redirectedURL||null!=this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentRedirectedURL",{get:function(){return this._redirectedURL||this._dataSource.redirectedURL},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentSpeed",{get:function(){return this._loaderClass===l.default?this._loader.currentSpeed:this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loaderType",{get:function(){return this._loader.type},enumerable:!1,configurable:!0}),e.prototype._selectSeekHandler=function(){var e=this._config;if("range"===e.seekType)this._seekHandler=new d.default(this._config.rangeLoadZeroStart);else if("param"===e.seekType){var t=e.seekParamStart||"bstart",r=e.seekParamEnd||"bend";this._seekHandler=new u.default(t,r)}else{if("custom"!==e.seekType)throw new c.InvalidArgumentException("Invalid seekType in config: "+e.seekType);if("function"!=typeof e.customSeekHandler)throw new c.InvalidArgumentException("Custom seekType specified in config but invalid customSeekHandler!");this._seekHandler=new e.customSeekHandler}},e.prototype._selectLoader=function(){if(null!=this._config.customLoader)this._loaderClass=this._config.customLoader;else if(this._isWebSocketURL)this._loaderClass=_.default;else if(s.default.isSupported())this._loaderClass=s.default;else if(o.default.isSupported())this._loaderClass=o.default;else{if(!l.default.isSupported())throw new c.RuntimeException("Your browser doesn't support xhr with arraybuffer responseType!");this._loaderClass=l.default}},e.prototype._createLoader=function(){this._loader=new this._loaderClass(this._seekHandler,this._config),!1===this._loader.needStashBuffer&&(this._enableStash=!1),this._loader.onContentLengthKnown=this._onContentLengthKnown.bind(this),this._loader.onURLRedirect=this._onURLRedirect.bind(this),this._loader.onDataArrival=this._onLoaderChunkArrival.bind(this),this._loader.onComplete=this._onLoaderComplete.bind(this),this._loader.onError=this._onLoaderError.bind(this)},e.prototype.open=function(e){this._currentRange={from:0,to:-1},e&&(this._currentRange.from=e),this._speedSampler.reset(),e||(this._fullRequestFlag=!0),this._loader.open(this._dataSource,Object.assign({},this._currentRange))},e.prototype.abort=function(){this._loader.abort(),this._paused&&(this._paused=!1,this._resumeFrom=0)},e.prototype.pause=function(){this.isWorking()&&(this._loader.abort(),0!==this._stashUsed?(this._resumeFrom=this._stashByteStart,this._currentRange.to=this._stashByteStart-1):this._resumeFrom=this._currentRange.to+1,this._stashUsed=0,this._stashByteStart=0,this._paused=!0)},e.prototype.resume=function(){if(this._paused){this._paused=!1;var e=this._resumeFrom;this._resumeFrom=0,this._internalSeek(e,!0)}},e.prototype.seek=function(e){this._paused=!1,this._stashUsed=0,this._stashByteStart=0,this._internalSeek(e,!0)},e.prototype._internalSeek=function(e,t){this._loader.isWorking()&&this._loader.abort(),this._flushStashBuffer(t),this._loader.destroy(),this._loader=null;var r={from:e,to:-1};this._currentRange={from:r.from,to:-1},this._speedSampler.reset(),this._stashSize=this._stashInitialSize,this._createLoader(),this._loader.open(this._dataSource,r),this._onSeeked&&this._onSeeked()},e.prototype.updateUrl=function(e){if(!e||"string"!=typeof e||0===e.length)throw new c.InvalidArgumentException("Url must be a non-empty string!");this._dataSource.url=e},e.prototype._expandBuffer=function(e){for(var t=this._stashSize;t+1048576<e;)t*=2;if((t+=1048576)!==this._bufferSize){var r=new ArrayBuffer(t);if(this._stashUsed>0){var i=new Uint8Array(this._stashBuffer,0,this._stashUsed);new Uint8Array(r,0,t).set(i,0)}this._stashBuffer=r,this._bufferSize=t}},e.prototype._normalizeSpeed=function(e){var t=this._speedNormalizeList,r=t.length-1,i=0,a=0,n=r;if(e<t[0])return t[0];for(;a<=n;){if((i=a+Math.floor((n-a)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?a=i+1:n=i-1}},e.prototype._adjustStashSize=function(e){var t=0;(t=this._config.isLive||e<512?e:e>=512&&e<=1024?Math.floor(1.5*e):2*e)>8192&&(t=8192);var r=1024*t+1048576;this._bufferSize<r&&this._expandBuffer(r),this._stashSize=1024*t},e.prototype._dispatchChunks=function(e,t){return this._currentRange.to=t+e.byteLength-1,this._onDataArrival(e,t)},e.prototype._onURLRedirect=function(e){this._redirectedURL=e,this._onRedirect&&this._onRedirect(e)},e.prototype._onContentLengthKnown=function(e){e&&this._fullRequestFlag&&(this._totalLength=e,this._fullRequestFlag=!1)},e.prototype._onLoaderChunkArrival=function(e,t,r){if(!this._onDataArrival)throw new c.IllegalStateException("IOController: No existing consumer (onDataArrival) callback!");if(!this._paused){this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,this._onRecoveredEarlyEof&&this._onRecoveredEarlyEof()),this._speedSampler.addBytes(e.byteLength);var i=this._speedSampler.lastSecondKBps;if(0!==i){var a=this._normalizeSpeed(i);this._speedNormalized!==a&&(this._speedNormalized=a,this._adjustStashSize(a))}if(this._enableStash)if(0===this._stashUsed&&0===this._stashByteStart&&(this._stashByteStart=t),this._stashUsed+e.byteLength<=this._stashSize)(o=new Uint8Array(this._stashBuffer,0,this._stashSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength;else if(o=new Uint8Array(this._stashBuffer,0,this._bufferSize),this._stashUsed>0){var n=this._stashBuffer.slice(0,this._stashUsed);(l=this._dispatchChunks(n,this._stashByteStart))<n.byteLength?l>0&&(_=new Uint8Array(n,l),o.set(_,0),this._stashUsed=_.byteLength,this._stashByteStart+=l):(this._stashUsed=0,this._stashByteStart+=l),this._stashUsed+e.byteLength>this._bufferSize&&(this._expandBuffer(this._stashUsed+e.byteLength),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength}else(l=this._dispatchChunks(e,t))<e.byteLength&&((s=e.byteLength-l)>this._bufferSize&&(this._expandBuffer(s),o=new Uint8Array(this._stashBuffer,0,this._bufferSize)),o.set(new Uint8Array(e,l),0),this._stashUsed+=s,this._stashByteStart=t+l);else if(0===this._stashUsed){var s;(l=this._dispatchChunks(e,t))<e.byteLength&&((s=e.byteLength-l)>this._bufferSize&&this._expandBuffer(s),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e,l),0),this._stashUsed+=s,this._stashByteStart=t+l)}else{var o,l;if(this._stashUsed+e.byteLength>this._bufferSize&&this._expandBuffer(this._stashUsed+e.byteLength),(o=new Uint8Array(this._stashBuffer,0,this._bufferSize)).set(new Uint8Array(e),this._stashUsed),this._stashUsed+=e.byteLength,(l=this._dispatchChunks(this._stashBuffer.slice(0,this._stashUsed),this._stashByteStart))<this._stashUsed&&l>0){var _=new Uint8Array(this._stashBuffer,l);o.set(_,0)}this._stashUsed-=l,this._stashByteStart+=l}}},e.prototype._flushStashBuffer=function(e){if(this._stashUsed>0){var t=this._stashBuffer.slice(0,this._stashUsed),r=this._dispatchChunks(t,this._stashByteStart),a=t.byteLength-r;if(r<t.byteLength){if(!e){if(r>0){var n=new Uint8Array(this._stashBuffer,0,this._bufferSize),s=new Uint8Array(t,r);n.set(s,0),this._stashUsed=s.byteLength,this._stashByteStart+=r}return 0}i.default.w(this.TAG,a+" bytes unconsumed data remain when flush buffer, dropped")}return this._stashUsed=0,this._stashByteStart=0,a}return 0},e.prototype._onLoaderComplete=function(e,t){this._flushStashBuffer(!0),this._onComplete&&this._onComplete(this._extraData)},e.prototype._onLoaderError=function(e,t){switch(i.default.e(this.TAG,"Loader error, code = "+t.code+", msg = "+t.msg),this._flushStashBuffer(!1),this._isEarlyEofReconnecting&&(this._isEarlyEofReconnecting=!1,e=n.LoaderErrors.UNRECOVERABLE_EARLY_EOF),e){case n.LoaderErrors.EARLY_EOF:if(!this._config.isLive&&this._totalLength){var r=this._currentRange.to+1;return void(r<this._totalLength&&(i.default.w(this.TAG,"Connection lost, trying reconnect..."),this._isEarlyEofReconnecting=!0,this._internalSeek(r,!1)))}e=n.LoaderErrors.UNRECOVERABLE_EARLY_EOF;case n.LoaderErrors.UNRECOVERABLE_EARLY_EOF:case n.LoaderErrors.CONNECTING_TIMEOUT:case n.LoaderErrors.HTTP_STATUS_CODE_INVALID:case n.LoaderErrors.EXCEPTION:}if(!this._onError)throw new c.RuntimeException("IOException: "+t.msg);this._onError(e,t)},e}();t.default=h},"./src/io/loader.js":
/*!**************************!*\
  !*** ./src/io/loader.js ***!
  \**************************/function(e,t,r){"use strict";r.r(t),r.d(t,{LoaderStatus:function(){return a},LoaderErrors:function(){return n},BaseLoader:function(){return s}});var i=r(/*! ../utils/exception.js */"./src/utils/exception.js"),a={kIdle:0,kConnecting:1,kBuffering:2,kError:3,kComplete:4},n={OK:"OK",EXCEPTION:"Exception",HTTP_STATUS_CODE_INVALID:"HttpStatusCodeInvalid",CONNECTING_TIMEOUT:"ConnectingTimeout",EARLY_EOF:"EarlyEof",UNRECOVERABLE_EARLY_EOF:"UnrecoverableEarlyEof"},s=function(){function e(e){this._type=e||"undefined",this._status=a.kIdle,this._needStash=!1,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null}return e.prototype.destroy=function(){this._status=a.kIdle,this._onContentLengthKnown=null,this._onURLRedirect=null,this._onDataArrival=null,this._onError=null,this._onComplete=null},e.prototype.isWorking=function(){return this._status===a.kConnecting||this._status===a.kBuffering},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"status",{get:function(){return this._status},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"needStashBuffer",{get:function(){return this._needStash},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onContentLengthKnown",{get:function(){return this._onContentLengthKnown},set:function(e){this._onContentLengthKnown=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onURLRedirect",{get:function(){return this._onURLRedirect},set:function(e){this._onURLRedirect=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDataArrival",{get:function(){return this._onDataArrival},set:function(e){this._onDataArrival=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onError",{get:function(){return this._onError},set:function(e){this._onError=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onComplete",{get:function(){return this._onComplete},set:function(e){this._onComplete=e},enumerable:!1,configurable:!0}),e.prototype.open=function(e,t){throw new i.NotImplementedException("Unimplemented abstract function!")},e.prototype.abort=function(){throw new i.NotImplementedException("Unimplemented abstract function!")},e}()},"./src/io/param-seek-handler.js":
/*!**************************************!*\
  !*** ./src/io/param-seek-handler.js ***!
  \**************************************/function(e,t,r){"use strict";r.r(t);var i=function(){function e(e,t){this._startName=e,this._endName=t}return e.prototype.getConfig=function(e,t){var r=e;if(0!==t.from||-1!==t.to){var i=!0;-1===r.indexOf("?")&&(r+="?",i=!1),i&&(r+="&"),r+=this._startName+"="+t.from.toString(),-1!==t.to&&(r+="&"+this._endName+"="+t.to.toString())}return{url:r,headers:{}}},e.prototype.removeURLParameters=function(e){var t=e.split("?")[0],r=void 0,i=e.indexOf("?");-1!==i&&(r=e.substring(i+1));var a="";if(null!=r&&r.length>0)for(var n=r.split("&"),s=0;s<n.length;s++){var o=n[s].split("="),l=s>0;o[0]!==this._startName&&o[0]!==this._endName&&(l&&(a+="&"),a+=n[s])}return 0===a.length?t:t+"?"+a},e}();t.default=i},"./src/io/range-seek-handler.js":
/*!**************************************!*\
  !*** ./src/io/range-seek-handler.js ***!
  \**************************************/function(e,t,r){"use strict";r.r(t);var i=function(){function e(e){this._zeroStart=e||!1}return e.prototype.getConfig=function(e,t){var r={};if(0!==t.from||-1!==t.to){var i=void 0;i=-1!==t.to?"bytes="+t.from.toString()+"-"+t.to.toString():"bytes="+t.from.toString()+"-",r.Range=i}else this._zeroStart&&(r.Range="bytes=0-");return{url:e,headers:r}},e.prototype.removeURLParameters=function(e){return e},e}();t.default=i},"./src/io/speed-sampler.js":
/*!*********************************!*\
  !*** ./src/io/speed-sampler.js ***!
  \*********************************/function(e,t,r){"use strict";r.r(t);var i=function(){function e(){this._firstCheckpoint=0,this._lastCheckpoint=0,this._intervalBytes=0,this._totalBytes=0,this._lastSecondBytes=0,self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now}return e.prototype.reset=function(){this._firstCheckpoint=this._lastCheckpoint=0,this._totalBytes=this._intervalBytes=0,this._lastSecondBytes=0},e.prototype.addBytes=function(e){0===this._firstCheckpoint?(this._firstCheckpoint=this._now(),this._lastCheckpoint=this._firstCheckpoint,this._intervalBytes+=e,this._totalBytes+=e):this._now()-this._lastCheckpoint<1e3?(this._intervalBytes+=e,this._totalBytes+=e):(this._lastSecondBytes=this._intervalBytes,this._intervalBytes=e,this._totalBytes+=e,this._lastCheckpoint=this._now())},Object.defineProperty(e.prototype,"currentKBps",{get:function(){this.addBytes(0);var e=(this._now()-this._lastCheckpoint)/1e3;return 0==e&&(e=1),this._intervalBytes/e/1024},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastSecondKBps",{get:function(){return this.addBytes(0),0!==this._lastSecondBytes?this._lastSecondBytes/1024:this._now()-this._lastCheckpoint>=500?this.currentKBps:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"averageKBps",{get:function(){var e=(this._now()-this._firstCheckpoint)/1e3;return this._totalBytes/e/1024},enumerable:!1,configurable:!0}),e}();t.default=i},"./src/io/websocket-loader.js":
/*!************************************!*\
  !*** ./src/io/websocket-loader.js ***!
  \************************************/function(e,t,r){"use strict";r.r(t);var i,a=r(/*! ./loader.js */"./src/io/loader.js"),n=r(/*! ../utils/exception.js */"./src/utils/exception.js"),s=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=function(e){function t(){var t=e.call(this,"websocket-loader")||this;return t.TAG="WebSocketLoader",t._needStash=!0,t._ws=null,t._requestAbort=!1,t._receivedLength=0,t}return s(t,e),t.isSupported=function(){try{return void 0!==self.WebSocket}catch(e){return!1}},t.prototype.destroy=function(){this._ws&&this.abort(),e.prototype.destroy.call(this)},t.prototype.open=function(e){try{var t=this._ws=new self.WebSocket(e.url);t.binaryType="arraybuffer",t.onopen=this._onWebSocketOpen.bind(this),t.onclose=this._onWebSocketClose.bind(this),t.onmessage=this._onWebSocketMessage.bind(this),t.onerror=this._onWebSocketError.bind(this),this._status=a.LoaderStatus.kConnecting}catch(e){this._status=a.LoaderStatus.kError;var r={code:e.code,msg:e.message};if(!this._onError)throw new n.RuntimeException(r.msg);this._onError(a.LoaderErrors.EXCEPTION,r)}},t.prototype.abort=function(){var e=this._ws;!e||0!==e.readyState&&1!==e.readyState||(this._requestAbort=!0,e.close()),this._ws=null,this._status=a.LoaderStatus.kComplete},t.prototype._onWebSocketOpen=function(e){this._status=a.LoaderStatus.kBuffering},t.prototype._onWebSocketClose=function(e){!0!==this._requestAbort?(this._status=a.LoaderStatus.kComplete,this._onComplete&&this._onComplete(0,this._receivedLength-1)):this._requestAbort=!1},t.prototype._onWebSocketMessage=function(e){var t=this;if(e.data instanceof ArrayBuffer)this._dispatchArrayBuffer(e.data);else if(e.data instanceof Blob){var r=new FileReader;r.onload=function(){t._dispatchArrayBuffer(r.result)},r.readAsArrayBuffer(e.data)}else{this._status=a.LoaderStatus.kError;var i={code:-1,msg:"Unsupported WebSocket message type: "+e.data.constructor.name};if(!this._onError)throw new n.RuntimeException(i.msg);this._onError(a.LoaderErrors.EXCEPTION,i)}},t.prototype._dispatchArrayBuffer=function(e){var t=e,r=this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)},t.prototype._onWebSocketError=function(e){this._status=a.LoaderStatus.kError;var t={code:e.code,msg:e.message};if(!this._onError)throw new n.RuntimeException(t.msg);this._onError(a.LoaderErrors.EXCEPTION,t)},t}(a.BaseLoader);t.default=o},"./src/io/xhr-moz-chunked-loader.js":
/*!******************************************!*\
  !*** ./src/io/xhr-moz-chunked-loader.js ***!
  \******************************************/function(e,t,r){"use strict";r.r(t);var i,a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),n=r(/*! ./loader.js */"./src/io/loader.js"),s=r(/*! ../utils/exception.js */"./src/utils/exception.js"),o=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),l=function(e){function t(t,r){var i=e.call(this,"xhr-moz-chunked-loader")||this;return i.TAG="MozChunkedLoader",i._seekHandler=t,i._config=r,i._needStash=!0,i._xhr=null,i._requestAbort=!1,i._contentLength=null,i._receivedLength=0,i}return o(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="moz-chunked-arraybuffer","moz-chunked-arraybuffer"===e.responseType}catch(e){return a.default.w("MozChunkedLoader",e.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onloadend=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},t.prototype.open=function(e,t){this._dataSource=e,this._range=t;var r=e.url;this._config.reuseRedirectedURL&&null!=e.redirectedURL&&(r=e.redirectedURL);var i=this._seekHandler.getConfig(r,t);this._requestURL=i.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",i.url,!0),a.responseType="moz-chunked-arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onloadend=this._onLoadEnd.bind(this),a.onerror=this._onXhrError.bind(this),e.withCredentials&&(a.withCredentials=!0),"object"==typeof i.headers){var s=i.headers;for(var o in s)s.hasOwnProperty(o)&&a.setRequestHeader(o,s[o])}if("object"==typeof this._config.headers)for(var o in s=this._config.headers)s.hasOwnProperty(o)&&a.setRequestHeader(o,s[o]);this._status=n.LoaderStatus.kConnecting,a.send()},t.prototype.abort=function(){this._requestAbort=!0,this._xhr&&this._xhr.abort(),this._status=n.LoaderStatus.kComplete},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL&&t.responseURL!==this._requestURL&&this._onURLRedirect){var r=this._seekHandler.removeURLParameters(t.responseURL);this._onURLRedirect(r)}if(0!==t.status&&(t.status<200||t.status>299)){if(this._status=n.LoaderStatus.kError,!this._onError)throw new s.RuntimeException("MozChunkedLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(n.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}else this._status=n.LoaderStatus.kBuffering}},t.prototype._onProgress=function(e){if(this._status!==n.LoaderStatus.kError){null===this._contentLength&&null!==e.total&&0!==e.total&&(this._contentLength=e.total,this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength));var t=e.target.response,r=this._range.from+this._receivedLength;this._receivedLength+=t.byteLength,this._onDataArrival&&this._onDataArrival(t,r,this._receivedLength)}},t.prototype._onLoadEnd=function(e){!0!==this._requestAbort?this._status!==n.LoaderStatus.kError&&(this._status=n.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1)):this._requestAbort=!1},t.prototype._onXhrError=function(e){this._status=n.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&e.loaded<this._contentLength?(t=n.LoaderErrors.EARLY_EOF,r={code:-1,msg:"Moz-Chunked stream meet Early-Eof"}):(t=n.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new s.RuntimeException(r.msg);this._onError(t,r)},t}(n.BaseLoader);t.default=l},"./src/io/xhr-range-loader.js":
/*!************************************!*\
  !*** ./src/io/xhr-range-loader.js ***!
  \************************************/function(e,t,r){"use strict";r.r(t);var i,a=r(/*! ../utils/logger.js */"./src/utils/logger.js"),n=r(/*! ./speed-sampler.js */"./src/io/speed-sampler.js"),s=r(/*! ./loader.js */"./src/io/loader.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),_=function(e){function t(t,r){var i=e.call(this,"xhr-range-loader")||this;return i.TAG="RangeLoader",i._seekHandler=t,i._config=r,i._needStash=!1,i._chunkSizeKBList=[128,256,384,512,768,1024,1536,2048,3072,4096,5120,6144,7168,8192],i._currentChunkSizeKB=384,i._currentSpeedNormalized=0,i._zeroSpeedChunkCount=0,i._xhr=null,i._speedSampler=new n.default,i._requestAbort=!1,i._waitForTotalLength=!1,i._totalLengthReceived=!1,i._currentRequestURL=null,i._currentRedirectedURL=null,i._currentRequestRange=null,i._totalLength=null,i._contentLength=null,i._receivedLength=0,i._lastTimeLoaded=0,i}return l(t,e),t.isSupported=function(){try{var e=new XMLHttpRequest;return e.open("GET","https://example.com",!0),e.responseType="arraybuffer","arraybuffer"===e.responseType}catch(e){return a.default.w("RangeLoader",e.message),!1}},t.prototype.destroy=function(){this.isWorking()&&this.abort(),this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr=null),e.prototype.destroy.call(this)},Object.defineProperty(t.prototype,"currentSpeed",{get:function(){return this._speedSampler.lastSecondKBps},enumerable:!1,configurable:!0}),t.prototype.open=function(e,t){this._dataSource=e,this._range=t,this._status=s.LoaderStatus.kConnecting;var r=!1;null!=this._dataSource.filesize&&0!==this._dataSource.filesize&&(r=!0,this._totalLength=this._dataSource.filesize),this._totalLengthReceived||r?this._openSubRange():(this._waitForTotalLength=!0,this._internalOpen(this._dataSource,{from:0,to:-1}))},t.prototype._openSubRange=function(){var e=1024*this._currentChunkSizeKB,t=this._range.from+this._receivedLength,r=t+e;null!=this._contentLength&&r-this._range.from>=this._contentLength&&(r=this._range.from+this._contentLength-1),this._currentRequestRange={from:t,to:r},this._internalOpen(this._dataSource,this._currentRequestRange)},t.prototype._internalOpen=function(e,t){this._lastTimeLoaded=0;var r=e.url;this._config.reuseRedirectedURL&&(null!=this._currentRedirectedURL?r=this._currentRedirectedURL:null!=e.redirectedURL&&(r=e.redirectedURL));var i=this._seekHandler.getConfig(r,t);this._currentRequestURL=i.url;var a=this._xhr=new XMLHttpRequest;if(a.open("GET",i.url,!0),a.responseType="arraybuffer",a.onreadystatechange=this._onReadyStateChange.bind(this),a.onprogress=this._onProgress.bind(this),a.onload=this._onLoad.bind(this),a.onerror=this._onXhrError.bind(this),e.withCredentials&&(a.withCredentials=!0),"object"==typeof i.headers){var n=i.headers;for(var s in n)n.hasOwnProperty(s)&&a.setRequestHeader(s,n[s])}if("object"==typeof this._config.headers)for(var s in n=this._config.headers)n.hasOwnProperty(s)&&a.setRequestHeader(s,n[s]);a.send()},t.prototype.abort=function(){this._requestAbort=!0,this._internalAbort(),this._status=s.LoaderStatus.kComplete},t.prototype._internalAbort=function(){this._xhr&&(this._xhr.onreadystatechange=null,this._xhr.onprogress=null,this._xhr.onload=null,this._xhr.onerror=null,this._xhr.abort(),this._xhr=null)},t.prototype._onReadyStateChange=function(e){var t=e.target;if(2===t.readyState){if(null!=t.responseURL){var r=this._seekHandler.removeURLParameters(t.responseURL);t.responseURL!==this._currentRequestURL&&r!==this._currentRedirectedURL&&(this._currentRedirectedURL=r,this._onURLRedirect&&this._onURLRedirect(r))}if(t.status>=200&&t.status<=299){if(this._waitForTotalLength)return;this._status=s.LoaderStatus.kBuffering}else{if(this._status=s.LoaderStatus.kError,!this._onError)throw new o.RuntimeException("RangeLoader: Http code invalid, "+t.status+" "+t.statusText);this._onError(s.LoaderErrors.HTTP_STATUS_CODE_INVALID,{code:t.status,msg:t.statusText})}}},t.prototype._onProgress=function(e){if(this._status!==s.LoaderStatus.kError){if(null===this._contentLength){var t=!1;if(this._waitForTotalLength){this._waitForTotalLength=!1,this._totalLengthReceived=!0,t=!0;var r=e.total;this._internalAbort(),null!=r&0!==r&&(this._totalLength=r)}if(-1===this._range.to?this._contentLength=this._totalLength-this._range.from:this._contentLength=this._range.to-this._range.from+1,t)return void this._openSubRange();this._onContentLengthKnown&&this._onContentLengthKnown(this._contentLength)}var i=e.loaded-this._lastTimeLoaded;this._lastTimeLoaded=e.loaded,this._speedSampler.addBytes(i)}},t.prototype._normalizeSpeed=function(e){var t=this._chunkSizeKBList,r=t.length-1,i=0,a=0,n=r;if(e<t[0])return t[0];for(;a<=n;){if((i=a+Math.floor((n-a)/2))===r||e>=t[i]&&e<t[i+1])return t[i];t[i]<e?a=i+1:n=i-1}},t.prototype._onLoad=function(e){if(this._status!==s.LoaderStatus.kError)if(this._waitForTotalLength)this._waitForTotalLength=!1;else{this._lastTimeLoaded=0;var t=this._speedSampler.lastSecondKBps;if(0===t&&(this._zeroSpeedChunkCount++,this._zeroSpeedChunkCount>=3&&(t=this._speedSampler.currentKBps)),0!==t){var r=this._normalizeSpeed(t);this._currentSpeedNormalized!==r&&(this._currentSpeedNormalized=r,this._currentChunkSizeKB=r)}var i=e.target.response,a=this._range.from+this._receivedLength;this._receivedLength+=i.byteLength;var n=!1;null!=this._contentLength&&this._receivedLength<this._contentLength?this._openSubRange():n=!0,this._onDataArrival&&this._onDataArrival(i,a,this._receivedLength),n&&(this._status=s.LoaderStatus.kComplete,this._onComplete&&this._onComplete(this._range.from,this._range.from+this._receivedLength-1))}},t.prototype._onXhrError=function(e){this._status=s.LoaderStatus.kError;var t=0,r=null;if(this._contentLength&&this._receivedLength>0&&this._receivedLength<this._contentLength?(t=s.LoaderErrors.EARLY_EOF,r={code:-1,msg:"RangeLoader meet Early-Eof"}):(t=s.LoaderErrors.EXCEPTION,r={code:-1,msg:e.constructor.name+" "+e.type}),!this._onError)throw new o.RuntimeException(r.msg);this._onError(t,r)},t}(s.BaseLoader);t.default=_},"./src/player/flv-player.js":
/*!**********************************!*\
  !*** ./src/player/flv-player.js ***!
  \**********************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),a=r.n(i),n=r(/*! ../utils/logger.js */"./src/utils/logger.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ./player-events.js */"./src/player/player-events.js"),l=r(/*! ../core/transmuxer.js */"./src/core/transmuxer.js"),_=r(/*! ../core/transmuxing-events.js */"./src/core/transmuxing-events.js"),d=r(/*! ../core/mse-controller.js */"./src/core/mse-controller.js"),u=r(/*! ../core/mse-events.js */"./src/core/mse-events.js"),c=r(/*! ./player-errors.js */"./src/player/player-errors.js"),h=r(/*! ../config.js */"./src/config.js"),f=r(/*! ../utils/exception.js */"./src/utils/exception.js"),p=function(){function e(e,t){if(this.TAG="FlvPlayer",this._type="FlvPlayer",this._emitter=new(a()),this._config=(0,h.createDefaultConfig)(),"object"==typeof t&&Object.assign(this._config,t),"flv"!==e.type.toLowerCase())throw new f.InvalidArgumentException("FlvPlayer requires an flv MediaDataSource input!");!0===e.isLive&&(this._config.isLive=!0),this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this),onvSeeking:this._onvSeeking.bind(this),onvCanPlay:this._onvCanPlay.bind(this),onvStalled:this._onvStalled.bind(this),onvProgress:this._onvProgress.bind(this)},self.performance&&self.performance.now?this._now=self.performance.now.bind(self.performance):this._now=Date.now,this._pendingSeekTime=null,this._requestSetTime=!1,this._seekpointRecord=null,this._progressChecker=null,this._mediaDataSource=e,this._mediaElement=null,this._msectl=null,this._transmuxer=null,this._mseSourceOpened=!1,this._hasPendingLoad=!1,this._receivedCanPlay=!1,this._mediaInfo=null,this._statisticsInfo=null;var r=s.default.chrome&&(s.default.version.major<50||50===s.default.version.major&&s.default.version.build<2661);this._alwaysSeekKeyframe=!!(r||s.default.msedge||s.default.msie),this._alwaysSeekKeyframe&&(this._config.accurateSeek=!1)}return e.prototype.destroy=function(){null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._transmuxer&&this.unload(),this._mediaElement&&this.detachMediaElement(),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===o.default.MEDIA_INFO?null!=this._mediaInfo&&Promise.resolve().then((function(){r._emitter.emit(o.default.MEDIA_INFO,r.mediaInfo)})):e===o.default.STATISTICS_INFO&&null!=this._statisticsInfo&&Promise.resolve().then((function(){r._emitter.emit(o.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){var t=this;if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),e.addEventListener("seeking",this.e.onvSeeking),e.addEventListener("canplay",this.e.onvCanPlay),e.addEventListener("stalled",this.e.onvStalled),e.addEventListener("progress",this.e.onvProgress),this._msectl=new d.default(this._config),this._msectl.on(u.default.UPDATE_END,this._onmseUpdateEnd.bind(this)),this._msectl.on(u.default.BUFFER_FULL,this._onmseBufferFull.bind(this)),this._msectl.on(u.default.SOURCE_OPEN,(function(){t._mseSourceOpened=!0,t._hasPendingLoad&&(t._hasPendingLoad=!1,t.load())})),this._msectl.on(u.default.ERROR,(function(e){t._emitter.emit(o.default.ERROR,c.ErrorTypes.MEDIA_ERROR,c.ErrorDetails.MEDIA_MSE_ERROR,e)})),this._msectl.attachMediaElement(e),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._msectl.detachMediaElement(),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement.removeEventListener("seeking",this.e.onvSeeking),this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay),this._mediaElement.removeEventListener("stalled",this.e.onvStalled),this._mediaElement.removeEventListener("progress",this.e.onvProgress),this._mediaElement=null),this._msectl&&(this._msectl.destroy(),this._msectl=null)},e.prototype.load=function(){var e=this;if(!this._mediaElement)throw new f.IllegalStateException("HTMLMediaElement must be attached before load()!");if(this._transmuxer)throw new f.IllegalStateException("FlvPlayer.load() has been called, please call unload() first!");this._hasPendingLoad||(this._config.deferLoadAfterSourceOpen&&!1===this._mseSourceOpened?this._hasPendingLoad=!0:(this._mediaElement.readyState>0&&(this._requestSetTime=!0,this._mediaElement.currentTime=0),this._transmuxer=new l.default(this._mediaDataSource,this._config),this._transmuxer.on(_.default.INIT_SEGMENT,(function(t,r){e._msectl.appendInitSegment(r)})),this._transmuxer.on(_.default.MEDIA_SEGMENT,(function(t,r){if(e._msectl.appendMediaSegment(r),e._config.lazyLoad&&!e._config.isLive){var i=e._mediaElement.currentTime;r.info.endDts>=1e3*(i+e._config.lazyLoadMaxDuration)&&null==e._progressChecker&&(n.default.v(e.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),e._suspendTransmuxer())}})),this._transmuxer.on(_.default.LOADING_COMPLETE,(function(){e._msectl.endOfStream(),e._emitter.emit(o.default.LOADING_COMPLETE)})),this._transmuxer.on(_.default.RECOVERED_EARLY_EOF,(function(){e._emitter.emit(o.default.RECOVERED_EARLY_EOF)})),this._transmuxer.on(_.default.IO_ERROR,(function(t,r){e._emitter.emit(o.default.ERROR,c.ErrorTypes.NETWORK_ERROR,t,r)})),this._transmuxer.on(_.default.DEMUX_ERROR,(function(t,r){e._emitter.emit(o.default.ERROR,c.ErrorTypes.MEDIA_ERROR,t,{code:-1,msg:r})})),this._transmuxer.on(_.default.MEDIA_INFO,(function(t){e._mediaInfo=t,e._emitter.emit(o.default.MEDIA_INFO,Object.assign({},t))})),this._transmuxer.on(_.default.METADATA_ARRIVED,(function(t){e._emitter.emit(o.default.METADATA_ARRIVED,t)})),this._transmuxer.on(_.default.SCRIPTDATA_ARRIVED,(function(t){e._emitter.emit(o.default.SCRIPTDATA_ARRIVED,t)})),this._transmuxer.on(_.default.STATISTICS_INFO,(function(t){e._statisticsInfo=e._fillStatisticsInfo(t),e._emitter.emit(o.default.STATISTICS_INFO,Object.assign({},e._statisticsInfo))})),this._transmuxer.on(_.default.RECOMMEND_SEEKPOINT,(function(t){e._mediaElement&&!e._config.accurateSeek&&(e._requestSetTime=!0,e._mediaElement.currentTime=t/1e3)})),this._transmuxer.open()))},e.prototype.unload=function(){this._mediaElement&&this._mediaElement.pause(),this._msectl&&this._msectl.seek(0),this._transmuxer&&(this._transmuxer.close(),this._transmuxer.destroy(),this._transmuxer=null)},e.prototype.seekStart=function(){var e=this._mediaElement.buffered;this._mediaElement.currentTime=e.start(0)},e.prototype.test1=function(){this._mediaElement.buffered.start(0)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._internalSeek(e):this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){return Object.assign({},this._mediaInfo)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){return null==this._statisticsInfo&&(this._statisticsInfo={}),this._statisticsInfo=this._fillStatisticsInfo(this._statisticsInfo),Object.assign({},this._statisticsInfo)},enumerable:!1,configurable:!0}),e.prototype._fillStatisticsInfo=function(e){if(e.playerType=this._type,!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var a=this._mediaElement.getVideoPlaybackQuality();r=a.totalVideoFrames,i=a.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e},e.prototype._onmseUpdateEnd=function(){if(this._config.lazyLoad&&!this._config.isLive){for(var e=this._mediaElement.buffered,t=this._mediaElement.currentTime,r=0,i=0;i<e.length;i++){var a=e.start(i),s=e.end(i);if(a<=t&&t<s){r=s;break}}r>=t+this._config.lazyLoadMaxDuration&&null==this._progressChecker&&(n.default.v(this.TAG,"Maximum buffering duration exceeded, suspend transmuxing task"),this._suspendTransmuxer())}},e.prototype._onmseBufferFull=function(){n.default.v(this.TAG,"MSE SourceBuffer is full, suspend transmuxing task"),null==this._progressChecker&&this._suspendTransmuxer()},e.prototype._suspendTransmuxer=function(){this._transmuxer&&(this._transmuxer.pause(),null==this._progressChecker&&(this._progressChecker=window.setInterval(this._checkProgressAndResume.bind(this),1e3)))},e.prototype._checkProgressAndResume=function(){for(var e=this._mediaElement.currentTime,t=this._mediaElement.buffered,r=!1,i=0;i<t.length;i++){var a=t.start(i),s=t.end(i);if(e>=a&&e<s){e>=s-this._config.lazyLoadRecoverDuration&&(r=!0);break}}r&&(window.clearInterval(this._progressChecker),this._progressChecker=null,r&&(n.default.v(this.TAG,"Continue loading from paused position"),this._transmuxer.resume()))},e.prototype._isTimepointBuffered=function(e){for(var t=this._mediaElement.buffered,r=0;r<t.length;r++){var i=t.start(r),a=t.end(r);if(e>=i&&e<a)return!0}return!1},e.prototype._internalSeek=function(e){var t=this._isTimepointBuffered(e),r=!1,i=0;if(e<1&&this._mediaElement.buffered.length>0){var a=this._mediaElement.buffered.start(0);(a<1&&e<a||s.default.safari)&&(r=!0,i=s.default.safari?.1:a)}if(r)this._requestSetTime=!0,this._mediaElement.currentTime=i;else if(t){if(this._alwaysSeekKeyframe){var n=this._msectl.getNearestKeyframe(Math.floor(1e3*e));this._requestSetTime=!0,this._mediaElement.currentTime=null!=n?n.dts/1e3:e}else this._requestSetTime=!0,this._mediaElement.currentTime=e;null!=this._progressChecker&&this._checkProgressAndResume()}else null!=this._progressChecker&&(window.clearInterval(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e)},e.prototype._checkAndApplyUnbufferedSeekpoint=function(){if(this._seekpointRecord)if(this._seekpointRecord.recordTime<=this._now()-100){var e=this._mediaElement.currentTime;this._seekpointRecord=null,this._isTimepointBuffered(e)||(null!=this._progressChecker&&(window.clearTimeout(this._progressChecker),this._progressChecker=null),this._msectl.seek(e),this._transmuxer.seek(Math.floor(1e3*e)),this._config.accurateSeek&&(this._requestSetTime=!0,this._mediaElement.currentTime=e))}else window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)},e.prototype._checkAndResumeStuckPlayback=function(e){var t=this._mediaElement;if(e||!this._receivedCanPlay||t.readyState<2){var r=t.buffered;r.length>0&&t.currentTime<r.start(0)&&(n.default.w(this.TAG,"Playback seems stuck at "+t.currentTime+", seek to "+r.start(0)),this._requestSetTime=!0,this._mediaElement.currentTime=r.start(0),this._mediaElement.removeEventListener("progress",this.e.onvProgress))}else this._mediaElement.removeEventListener("progress",this.e.onvProgress)},e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null)},e.prototype._onvSeeking=function(e){var t=this._mediaElement.currentTime,r=this._mediaElement.buffered;if(this._requestSetTime)this._requestSetTime=!1;else{if(t<1&&r.length>0){var i=r.start(0);if(i<1&&t<i||s.default.safari)return this._requestSetTime=!0,void(this._mediaElement.currentTime=s.default.safari?.1:i)}if(this._isTimepointBuffered(t)){if(this._alwaysSeekKeyframe){var a=this._msectl.getNearestKeyframe(Math.floor(1e3*t));null!=a&&(this._requestSetTime=!0,this._mediaElement.currentTime=a.dts/1e3)}null!=this._progressChecker&&this._checkProgressAndResume()}else this._seekpointRecord={seekPoint:t,recordTime:this._now()},window.setTimeout(this._checkAndApplyUnbufferedSeekpoint.bind(this),50)}},e.prototype._onvCanPlay=function(e){this._receivedCanPlay=!0,this._mediaElement.removeEventListener("canplay",this.e.onvCanPlay)},e.prototype._onvStalled=function(e){this._checkAndResumeStuckPlayback(!0)},e.prototype._onvProgress=function(e){this._checkAndResumeStuckPlayback()},e}();t.default=p},"./src/player/native-player.js":
/*!*************************************!*\
  !*** ./src/player/native-player.js ***!
  \*************************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),a=r.n(i),n=r(/*! ./player-events.js */"./src/player/player-events.js"),s=r(/*! ../config.js */"./src/config.js"),o=r(/*! ../utils/exception.js */"./src/utils/exception.js"),l=function(){function e(e,t){if(this.TAG="NativePlayer",this._type="NativePlayer",this._emitter=new(a()),this._config=(0,s.createDefaultConfig)(),"object"==typeof t&&Object.assign(this._config,t),"flv"===e.type.toLowerCase())throw new o.InvalidArgumentException("NativePlayer does't support flv MediaDataSource input!");if(e.hasOwnProperty("segments"))throw new o.InvalidArgumentException("NativePlayer("+e.type+") doesn't support multipart playback!");this.e={onvLoadedMetadata:this._onvLoadedMetadata.bind(this)},this._pendingSeekTime=null,this._statisticsReporter=null,this._mediaDataSource=e,this._mediaElement=null}return e.prototype.destroy=function(){this._mediaElement&&(this.unload(),this.detachMediaElement()),this.e=null,this._mediaDataSource=null,this._emitter.removeAllListeners(),this._emitter=null},e.prototype.on=function(e,t){var r=this;e===n.default.MEDIA_INFO?null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(n.default.MEDIA_INFO,r.mediaInfo)})):e===n.default.STATISTICS_INFO&&null!=this._mediaElement&&0!==this._mediaElement.readyState&&Promise.resolve().then((function(){r._emitter.emit(n.default.STATISTICS_INFO,r.statisticsInfo)})),this._emitter.addListener(e,t)},e.prototype.off=function(e,t){this._emitter.removeListener(e,t)},e.prototype.attachMediaElement=function(e){if(this._mediaElement=e,e.addEventListener("loadedmetadata",this.e.onvLoadedMetadata),null!=this._pendingSeekTime)try{e.currentTime=this._pendingSeekTime,this._pendingSeekTime=null}catch(e){}},e.prototype.detachMediaElement=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src"),this._mediaElement.removeEventListener("loadedmetadata",this.e.onvLoadedMetadata),this._mediaElement=null),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.load=function(){if(!this._mediaElement)throw new o.IllegalStateException("HTMLMediaElement must be attached before load()!");this._mediaElement.src=this._mediaDataSource.url,this._mediaElement.readyState>0&&(this._mediaElement.currentTime=0),this._mediaElement.preload="auto",this._mediaElement.load(),this._statisticsReporter=window.setInterval(this._reportStatisticsInfo.bind(this),this._config.statisticsInfoReportInterval)},e.prototype.unload=function(){this._mediaElement&&(this._mediaElement.src="",this._mediaElement.removeAttribute("src")),null!=this._statisticsReporter&&(window.clearInterval(this._statisticsReporter),this._statisticsReporter=null)},e.prototype.play=function(){return this._mediaElement.play()},e.prototype.pause=function(){this._mediaElement.pause()},Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"buffered",{get:function(){return this._mediaElement.buffered},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._mediaElement.duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"volume",{get:function(){return this._mediaElement.volume},set:function(e){this._mediaElement.volume=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"muted",{get:function(){return this._mediaElement.muted},set:function(e){this._mediaElement.muted=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"currentTime",{get:function(){return this._mediaElement?this._mediaElement.currentTime:0},set:function(e){this._mediaElement?this._mediaElement.currentTime=e:this._pendingSeekTime=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"mediaInfo",{get:function(){var e={mimeType:(this._mediaElement instanceof HTMLAudioElement?"audio/":"video/")+this._mediaDataSource.type};return this._mediaElement&&(e.duration=Math.floor(1e3*this._mediaElement.duration),this._mediaElement instanceof HTMLVideoElement&&(e.width=this._mediaElement.videoWidth,e.height=this._mediaElement.videoHeight)),e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"statisticsInfo",{get:function(){var e={playerType:this._type,url:this._mediaDataSource.url};if(!(this._mediaElement instanceof HTMLVideoElement))return e;var t=!0,r=0,i=0;if(this._mediaElement.getVideoPlaybackQuality){var a=this._mediaElement.getVideoPlaybackQuality();r=a.totalVideoFrames,i=a.droppedVideoFrames}else null!=this._mediaElement.webkitDecodedFrameCount?(r=this._mediaElement.webkitDecodedFrameCount,i=this._mediaElement.webkitDroppedFrameCount):t=!1;return t&&(e.decodedFrames=r,e.droppedFrames=i),e},enumerable:!1,configurable:!0}),e.prototype._onvLoadedMetadata=function(e){null!=this._pendingSeekTime&&(this._mediaElement.currentTime=this._pendingSeekTime,this._pendingSeekTime=null),this._emitter.emit(n.default.MEDIA_INFO,this.mediaInfo)},e.prototype._reportStatisticsInfo=function(){this._emitter.emit(n.default.STATISTICS_INFO,this.statisticsInfo)},e}();t.default=l},"./src/player/player-errors.js":
/*!*************************************!*\
  !*** ./src/player/player-errors.js ***!
  \*************************************/function(e,t,r){"use strict";r.r(t),r.d(t,{ErrorTypes:function(){return n},ErrorDetails:function(){return s}});var i=r(/*! ../io/loader.js */"./src/io/loader.js"),a=r(/*! ../demux/demux-errors.js */"./src/demux/demux-errors.js"),n={NETWORK_ERROR:"NetworkError",MEDIA_ERROR:"MediaError",OTHER_ERROR:"OtherError"},s={NETWORK_EXCEPTION:i.LoaderErrors.EXCEPTION,NETWORK_STATUS_CODE_INVALID:i.LoaderErrors.HTTP_STATUS_CODE_INVALID,NETWORK_TIMEOUT:i.LoaderErrors.CONNECTING_TIMEOUT,NETWORK_UNRECOVERABLE_EARLY_EOF:i.LoaderErrors.UNRECOVERABLE_EARLY_EOF,MEDIA_MSE_ERROR:"MediaMSEError",MEDIA_FORMAT_ERROR:a.default.FORMAT_ERROR,MEDIA_FORMAT_UNSUPPORTED:a.default.FORMAT_UNSUPPORTED,MEDIA_CODEC_UNSUPPORTED:a.default.CODEC_UNSUPPORTED}},"./src/player/player-events.js":
/*!*************************************!*\
  !*** ./src/player/player-events.js ***!
  \*************************************/function(e,t,r){"use strict";r.r(t),t.default={ERROR:"error",LOADING_COMPLETE:"loading_complete",RECOVERED_EARLY_EOF:"recovered_early_eof",MEDIA_INFO:"media_info",METADATA_ARRIVED:"metadata_arrived",SCRIPTDATA_ARRIVED:"scriptdata_arrived",STATISTICS_INFO:"statistics_info"}},"./src/remux/aac-silent.js":
/*!*********************************!*\
  !*** ./src/remux/aac-silent.js ***!
  \*********************************/function(e,t,r){"use strict";r.r(t);var i=function(){function e(){}return e.getSilentFrame=function(e,t){if("mp4a.40.2"===e){if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null},e}();t.default=i},"./src/remux/mp4-generator.js":
/*!************************************!*\
  !*** ./src/remux/mp4-generator.js ***!
  \************************************/function(e,t,r){"use strict";r.r(t);var i=function(){function e(){}return e.init=function(){for(var t in e.types={hvc1:[],hvcC:[],avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[],pasp:[],".mp3":[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=e.constants={};r.FTYP=new Uint8Array([105,115,111,109,0,0,0,1,105,115,111,109,97,118,99,49]),r.STSD_PREFIX=new Uint8Array([0,0,0,0,0,0,0,1]),r.STTS=new Uint8Array([0,0,0,0,0,0,0,0]),r.STSC=r.STCO=r.STTS,r.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),r.HDLR_VIDEO=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r.HDLR_AUDIO=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]),r.DREF=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),r.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),r.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])},e.box=function(e){for(var t=8,r=null,i=Array.prototype.slice.call(arguments,1),a=i.length,n=0;n<a;n++)t+=i[n].byteLength;(r=new Uint8Array(t))[0]=t>>>24&255,r[1]=t>>>16&255,r[2]=t>>>8&255,r[3]=255&t,r.set(e,4);var s=8;for(n=0;n<a;n++)r.set(i[n],s),s+=i[n].byteLength;return r},e.generateInitSegment=function(t){var r=e.box(e.types.ftyp,e.constants.FTYP),i=e.moov(t),a=new Uint8Array(r.byteLength+i.byteLength);return a.set(r,0),a.set(i,r.byteLength),a},e.moov=function(t){var r=e.mvhd(t.timescale,t.duration),i=e.trak(t),a=e.mvex(t);return e.box(e.types.moov,r,i,a)},e.mvhd=function(t,r){return e.box(e.types.mvhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]))},e.trak=function(t){return e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.tkhd=function(t){var r=t.id,i=t.duration,a=t.presentWidth,n=t.presentHeight;return e.box(e.types.tkhd,new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>>8&255,255&a,0,0,n>>>8&255,255&n,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t),e.hdlr(t),e.minf(t))},e.mdhd=function(t){var r=t.timescale,i=t.duration;return e.box(e.types.mdhd,new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,i>>>24&255,i>>>16&255,i>>>8&255,255&i,85,196,0,0]))},e.hdlr=function(t){var r=null;return r="audio"===t.type?e.constants.HDLR_AUDIO:e.constants.HDLR_VIDEO,e.box(e.types.hdlr,r)},e.minf=function(t){var r=null;return r="audio"===t.type?e.box(e.types.smhd,e.constants.SMHD):e.box(e.types.vmhd,e.constants.VMHD),e.box(e.types.minf,r,e.dinf(),e.stbl(t))},e.dinf=function(){return e.box(e.types.dinf,e.box(e.types.dref,e.constants.DREF))},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.constants.STTS),e.box(e.types.stsc,e.constants.STSC),e.box(e.types.stsz,e.constants.STSZ),e.box(e.types.stco,e.constants.STCO))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.codec?e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp3(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.mp4a(t)):e.box(e.types.stsd,e.constants.STSD_PREFIX,e.avc1(t))},e.mp3=function(t){var r=t.channelCount,i=t.audioSampleRate,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types[".mp3"],a)},e.mp4a=function(t){var r=t.channelCount,i=t.audioSampleRate,a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,r,0,16,0,0,0,0,i>>>8&255,255&i,0,0]);return e.box(e.types.mp4a,a,e.esds(t))},e.esds=function(t){var r=t.config||[],i=r.length,a=new Uint8Array([0,0,0,0,3,23+i,0,1,0,4,15+i,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([i]).concat(r).concat([6,1,2]));return e.box(e.types.esds,a)},e.avc1=function(t){var r=t.avcc,i=t.codecWidth,a=t.codecHeight,n=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,i>>>8&255,255&i,a>>>8&255,255&a,0,72,0,0,0,72,0,0,0,0,0,0,0,1,10,120,113,113,47,102,108,118,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,255,255]);return t.codec.indexOf("avc1")>=0?e.box(e.types.avc1,n,e.box(e.types.avcC,r)):e.box(e.types.hvc1,n,e.box(e.types.hvcC,r))},e.mvex=function(t){return e.box(e.types.mvex,e.trex(t))},e.trex=function(t){var r=t.id,i=new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return e.box(e.types.trex,i)},e.moof=function(t,r){return e.box(e.types.moof,e.mfhd(t.sequenceNumber),e.traf(t,r))},e.mfhd=function(t){var r=new Uint8Array([0,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,255&t]);return e.box(e.types.mfhd,r)},e.traf=function(t,r){var i=t.id,a=e.box(e.types.tfhd,new Uint8Array([0,0,0,0,i>>>24&255,i>>>16&255,i>>>8&255,255&i])),n=e.box(e.types.tfdt,new Uint8Array([0,0,0,0,r>>>24&255,r>>>16&255,r>>>8&255,255&r])),s=e.sdtp(t),o=e.trun(t,s.byteLength+16+16+8+16+8+8);return e.box(e.types.traf,a,n,o,s)},e.sdtp=function(t){for(var r=t.samples||[],i=r.length,a=new Uint8Array(4+i),n=0;n<i;n++){var s=r[n].flags;a[n+4]=s.isLeading<<6|s.dependsOn<<4|s.isDependedOn<<2|s.hasRedundancy}return e.box(e.types.sdtp,a)},e.trun=function(t,r){var i=t.samples||[],a=i.length,n=12+16*a,s=new Uint8Array(n);r+=8+n,s.set([0,0,15,1,a>>>24&255,a>>>16&255,a>>>8&255,255&a,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0);for(var o=0;o<a;o++){var l=i[o].duration,_=i[o].size,d=i[o].flags,u=i[o].cts;s.set([l>>>24&255,l>>>16&255,l>>>8&255,255&l,_>>>24&255,_>>>16&255,_>>>8&255,255&_,d.isLeading<<2|d.dependsOn,d.isDependedOn<<6|d.hasRedundancy<<4|d.isNonSync,0,0,u>>>24&255,u>>>16&255,u>>>8&255,255&u],12+16*o)}return e.box(e.types.trun,s)},e.mdat=function(t){return e.box(e.types.mdat,t)},e}();i.init(),t.default=i},"./src/remux/mp4-remuxer.js":
/*!**********************************!*\
  !*** ./src/remux/mp4-remuxer.js ***!
  \**********************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! ../utils/logger.js */"./src/utils/logger.js"),a=r(/*! ./mp4-generator.js */"./src/remux/mp4-generator.js"),n=r(/*! ./aac-silent.js */"./src/remux/aac-silent.js"),s=r(/*! ../utils/browser.js */"./src/utils/browser.js"),o=r(/*! ../core/media-segment-info.js */"./src/core/media-segment-info.js"),l=r(/*! ../utils/exception.js */"./src/utils/exception.js"),_=function(){function e(e){this.TAG="MP4Remuxer",this._config=e,this._isLive=!0===e.isLive,this._dtsBase=-1,this._dtsBaseInited=!1,this._audioDtsBase=1/0,this._videoDtsBase=1/0,this._audioNextDts=void 0,this._videoNextDts=void 0,this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList=new o.MediaSegmentInfoList("audio"),this._videoSegmentInfoList=new o.MediaSegmentInfoList("video"),this._onInitSegment=null,this._onMediaSegment=null,this._forceFirstIDR=!(!s.default.chrome||!(s.default.version.major<50||50===s.default.version.major&&s.default.version.build<2661)),this._fillSilentAfterSeek=s.default.msedge||s.default.msie,this._mp3UseMpegAudio=!s.default.firefox,this._fillAudioTimestampGap=this._config.fixAudioTimestampGap}return e.prototype.destroy=function(){this._dtsBase=-1,this._dtsBaseInited=!1,this._audioMeta=null,this._videoMeta=null,this._audioSegmentInfoList.clear(),this._audioSegmentInfoList=null,this._videoSegmentInfoList.clear(),this._videoSegmentInfoList=null,this._onInitSegment=null,this._onMediaSegment=null},e.prototype.bindDataSource=function(e){return e.onDataAvailable=this.remux.bind(this),e.onTrackMetadata=this._onTrackMetadataReceived.bind(this),this},Object.defineProperty(e.prototype,"onInitSegment",{get:function(){return this._onInitSegment},set:function(e){this._onInitSegment=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMediaSegment",{get:function(){return this._onMediaSegment},set:function(e){this._onMediaSegment=e},enumerable:!1,configurable:!0}),e.prototype.insertDiscontinuity=function(){this._audioNextDts=this._videoNextDts=void 0},e.prototype.seek=function(e){this._audioStashedLastSample=null,this._videoStashedLastSample=null,this._videoSegmentInfoList.clear(),this._audioSegmentInfoList.clear()},e.prototype.remux=function(e,t){if(!this._onMediaSegment)throw new l.IllegalStateException("MP4Remuxer: onMediaSegment callback must be specificed!");this._dtsBaseInited||this._calculateDtsBase(e,t),this._remuxVideo(t),this._remuxAudio(e)},e.prototype._onTrackMetadataReceived=function(e,t){var r=null,i="mp4",n=t.codec;if("audio"===e)this._audioMeta=t,"mp3"===t.codec&&this._mp3UseMpegAudio?(i="mpeg",n="",r=new Uint8Array):r=a.default.generateInitSegment(t);else{if("video"!==e)return;this._videoMeta=t,r=a.default.generateInitSegment(t)}if(!this._onInitSegment)throw new l.IllegalStateException("MP4Remuxer: onInitSegment callback must be specified!");this._onInitSegment(e,{type:e,data:r.buffer,codec:n,container:e+"/"+i,mediaDuration:t.duration})},e.prototype._calculateDtsBase=function(e,t){this._dtsBaseInited||(e.samples&&e.samples.length&&(this._audioDtsBase=e.samples[0].dts),t.samples&&t.samples.length&&(this._videoDtsBase=t.samples[0].dts),this._dtsBase=Math.min(this._audioDtsBase,this._videoDtsBase),this._dtsBaseInited=!0)},e.prototype.flushStashedSamples=function(){var e=this._videoStashedLastSample,t=this._audioStashedLastSample,r={type:"video",id:1,sequenceNumber:0,samples:[],length:0};null!=e&&(r.samples.push(e),r.length=e.length);var i={type:"audio",id:2,sequenceNumber:0,samples:[],length:0};null!=t&&(i.samples.push(t),i.length=t.length),this._videoStashedLastSample=null,this._audioStashedLastSample=null,this._remuxVideo(r,!0),this._remuxAudio(i,!0)},e.prototype._remuxAudio=function(e,t){if(null!=this._audioMeta){var r,l=e,_=l.samples,d=void 0,u=-1,c=this._audioMeta.refSampleDuration,h="mp3"===this._audioMeta.codec&&this._mp3UseMpegAudio,f=this._dtsBaseInited&&void 0===this._audioNextDts,p=!1;if(_&&0!==_.length&&(1!==_.length||t)){var m=0,y=null,g=0;h?(m=0,g=l.length):(m=8,g=8+l.length);var v=null;if(_.length>1&&(g-=(v=_.pop()).length),null!=this._audioStashedLastSample){var b=this._audioStashedLastSample;this._audioStashedLastSample=null,_.unshift(b),g+=b.length}null!=v&&(this._audioStashedLastSample=v);var E=_[0].dts-this._dtsBase;if(this._audioNextDts)d=E-this._audioNextDts;else if(this._audioSegmentInfoList.isEmpty())d=0,this._fillSilentAfterSeek&&!this._videoSegmentInfoList.isEmpty()&&"mp3"!==this._audioMeta.originalCodec&&(p=!0);else{var w=this._audioSegmentInfoList.getLastSampleBefore(E);if(null!=w){var S=E-(w.originalDts+w.duration);S<=3&&(S=0),d=E-(w.dts+w.duration+S)}else d=0}if(p){var L=E-d,k=this._videoSegmentInfoList.getLastSegmentBefore(E);if(null!=k&&k.beginDts<L){if(B=n.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount)){var A=k.beginDts,x=L-k.beginDts;i.default.v(this.TAG,"InsertPrefixSilentAudio: dts: "+A+", duration: "+x),_.unshift({unit:B,dts:A,pts:A}),g+=B.byteLength}}else p=!1}for(var T=[],C=0;C<_.length;C++){var R=(b=_[C]).unit,O=b.dts-this._dtsBase,P=(A=O,!1),I=null,M=0;if(!(O<-.001)){if("mp3"!==this._audioMeta.codec){var D=O;if(this._audioNextDts&&(D=this._audioNextDts),(d=O-D)<=-3*c){i.default.w(this.TAG,"Dropping 1 audio frame (originalDts: "+O+" ms ,curRefDts: "+D+" ms)  due to dtsCorrection: "+d+" ms overlap.");continue}if(d>=3*c&&this._fillAudioTimestampGap&&!s.default.safari){P=!0;var B,F=Math.floor(d/c);i.default.w(this.TAG,"Large audio timestamp gap detected, may cause AV sync to drift. Silent frames will be generated to avoid unsync.\noriginalDts: "+O+" ms, curRefDts: "+D+" ms, dtsCorrection: "+Math.round(d)+" ms, generate: "+F+" frames"),A=Math.floor(D),M=Math.floor(D+c)-A,null==(B=n.default.getSilentFrame(this._audioMeta.originalCodec,this._audioMeta.channelCount))&&(i.default.w(this.TAG,"Unable to generate silent frame for "+this._audioMeta.originalCodec+" with "+this._audioMeta.channelCount+" channels, repeat last frame"),B=R),I=[];for(var U=0;U<F;U++){D+=c;var N=Math.floor(D),j=Math.floor(D+c)-N,V={dts:N,pts:N,cts:0,unit:B,size:B.byteLength,duration:j,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}};I.push(V),g+=V.size}this._audioNextDts=D+c}else A=Math.floor(D),M=Math.floor(D+c)-A,this._audioNextDts=D+c}else A=O-d,M=C!==_.length-1?_[C+1].dts-this._dtsBase-d-A:null!=v?v.dts-this._dtsBase-d-A:T.length>=1?T[T.length-1].duration:Math.floor(c),this._audioNextDts=A+M;-1===u&&(u=A),T.push({dts:A,pts:A,cts:0,unit:b.unit,size:b.unit.byteLength,duration:M,originalDts:O,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0}}),P&&T.push.apply(T,I)}}if(0===T.length)return l.samples=[],void(l.length=0);for(h?y=new Uint8Array(g):((y=new Uint8Array(g))[0]=g>>>24&255,y[1]=g>>>16&255,y[2]=g>>>8&255,y[3]=255&g,y.set(a.default.types.mdat,4)),C=0;C<T.length;C++)R=T[C].unit,y.set(R,m),m+=R.byteLength;var G=T[T.length-1];r=G.dts+G.duration;var H=new o.MediaSegmentInfo;H.beginDts=u,H.endDts=r,H.beginPts=u,H.endPts=r,H.originalBeginDts=T[0].originalDts,H.originalEndDts=G.originalDts+G.duration,H.firstSample=new o.SampleInfo(T[0].dts,T[0].pts,T[0].duration,T[0].originalDts,!1),H.lastSample=new o.SampleInfo(G.dts,G.pts,G.duration,G.originalDts,!1),this._isLive||this._audioSegmentInfoList.append(H),l.samples=T,l.sequenceNumber++;var z=null;z=h?new Uint8Array:a.default.moof(l,u),l.samples=[],l.length=0;var W={type:"audio",data:this._mergeBoxes(z,y).buffer,sampleCount:T.length,info:H};h&&f&&(W.timestampOffset=u),this._onMediaSegment("audio",W)}}},e.prototype._remuxVideo=function(e,t){if(null!=this._videoMeta){var r,i,n=e,s=n.samples,l=void 0,_=-1,d=-1;if(s&&0!==s.length&&(1!==s.length||t)){var u=8,c=null,h=8+e.length,f=null;if(s.length>1&&(h-=(f=s.pop()).length),null!=this._videoStashedLastSample){var p=this._videoStashedLastSample;this._videoStashedLastSample=null,s.unshift(p),h+=p.length}null!=f&&(this._videoStashedLastSample=f);var m=s[0].dts-this._dtsBase;if(this._videoNextDts)l=m-this._videoNextDts;else if(this._videoSegmentInfoList.isEmpty())l=0;else{var y=this._videoSegmentInfoList.getLastSampleBefore(m);if(null!=y){var g=m-(y.originalDts+y.duration);g<=3&&(g=0),l=m-(y.dts+y.duration+g)}else l=0}for(var v=new o.MediaSegmentInfo,b=[],E=0;E<s.length;E++){var w=(p=s[E]).dts-this._dtsBase,S=p.isKeyframe,L=w-l,k=p.cts,A=L+k;-1===_&&(_=L,d=A);var x=0;if(x=E!==s.length-1?s[E+1].dts-this._dtsBase-l-L:null!=f?f.dts-this._dtsBase-l-L:b.length>=1?b[b.length-1].duration:Math.floor(this._videoMeta.refSampleDuration),S){var T=new o.SampleInfo(L,A,x,p.dts,!0);T.fileposition=p.fileposition,v.appendSyncPoint(T)}b.push({dts:L,pts:A,cts:k,units:p.units,size:p.length,isKeyframe:S,duration:x,originalDts:w,flags:{isLeading:0,dependsOn:S?2:1,isDependedOn:S?1:0,hasRedundancy:0,isNonSync:S?0:1}})}for((c=new Uint8Array(h))[0]=h>>>24&255,c[1]=h>>>16&255,c[2]=h>>>8&255,c[3]=255&h,c.set(a.default.types.mdat,4),E=0;E<b.length;E++)for(var C=b[E].units;C.length;){var R=C.shift().data;c.set(R,u),u+=R.byteLength}var O=b[b.length-1];if(r=O.dts+O.duration,i=O.pts+O.duration,this._videoNextDts=r,v.beginDts=_,v.endDts=r,v.beginPts=d,v.endPts=i,v.originalBeginDts=b[0].originalDts,v.originalEndDts=O.originalDts+O.duration,v.firstSample=new o.SampleInfo(b[0].dts,b[0].pts,b[0].duration,b[0].originalDts,b[0].isKeyframe),v.lastSample=new o.SampleInfo(O.dts,O.pts,O.duration,O.originalDts,O.isKeyframe),this._isLive||this._videoSegmentInfoList.append(v),n.samples=b,n.sequenceNumber++,this._forceFirstIDR){var P=b[0].flags;P.dependsOn=2,P.isNonSync=0}var I=a.default.moof(n,_);n.samples=[],n.length=0,this._onMediaSegment("video",{type:"video",data:this._mergeBoxes(I,c).buffer,sampleCount:b.length,info:v})}}},e.prototype._mergeBoxes=function(e,t){var r=new Uint8Array(e.byteLength+t.byteLength);return r.set(e,0),r.set(t,e.byteLength),r},e}();t.default=_},"./src/utils/browser.js":
/*!******************************!*\
  !*** ./src/utils/browser.js ***!
  \******************************/function(e,t,r){"use strict";r.r(t);var i={};!function(){var e=self.navigator.userAgent.toLowerCase(),t=/(edge)\/([\w.]+)/.exec(e)||/(opr)[\/]([\w.]+)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(iemobile)[\/]([\w.]+)/.exec(e)||/(version)(applewebkit)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+).*(version)[ \/]([\w.]+).*(safari)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("trident")>=0&&/(rv)(?::| )([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(firefox)[ \/]([\w.]+)/.exec(e)||[],r=/(ipad)/.exec(e)||/(ipod)/.exec(e)||/(windows phone)/.exec(e)||/(iphone)/.exec(e)||/(kindle)/.exec(e)||/(android)/.exec(e)||/(windows)/.exec(e)||/(mac)/.exec(e)||/(linux)/.exec(e)||/(cros)/.exec(e)||[],a={browser:t[5]||t[3]||t[1]||"",version:t[2]||t[4]||"0",majorVersion:t[4]||t[2]||"0",platform:r[0]||""},n={};if(a.browser){n[a.browser]=!0;var s=a.majorVersion.split(".");n.version={major:parseInt(a.majorVersion,10),string:a.version},s.length>1&&(n.version.minor=parseInt(s[1],10)),s.length>2&&(n.version.build=parseInt(s[2],10))}if(a.platform&&(n[a.platform]=!0),(n.chrome||n.opr||n.safari)&&(n.webkit=!0),n.rv||n.iemobile){n.rv&&delete n.rv;var o="msie";a.browser=o,n[o]=!0}if(n.edge){delete n.edge;var l="msedge";a.browser=l,n[l]=!0}if(n.opr){var _="opera";a.browser=_,n[_]=!0}if(n.safari&&n.android){var d="android";a.browser=d,n[d]=!0}for(var u in n.name=a.browser,n.platform=a.platform,i)i.hasOwnProperty(u)&&delete i[u];Object.assign(i,n)}(),t.default=i},"./src/utils/exception.js":
/*!********************************!*\
  !*** ./src/utils/exception.js ***!
  \********************************/function(e,t,r){"use strict";r.r(t),r.d(t,{RuntimeException:function(){return n},IllegalStateException:function(){return s},InvalidArgumentException:function(){return o},NotImplementedException:function(){return l}});var i,a=(i=function(e,t){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},i(e,t)},function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),n=function(){function e(e){this._message=e}return Object.defineProperty(e.prototype,"name",{get:function(){return"RuntimeException"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"message",{get:function(){return this._message},enumerable:!1,configurable:!0}),e.prototype.toString=function(){return this.name+": "+this.message},e}(),s=function(e){function t(t){return e.call(this,t)||this}return a(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"IllegalStateException"},enumerable:!1,configurable:!0}),t}(n),o=function(e){function t(t){return e.call(this,t)||this}return a(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"InvalidArgumentException"},enumerable:!1,configurable:!0}),t}(n),l=function(e){function t(t){return e.call(this,t)||this}return a(t,e),Object.defineProperty(t.prototype,"name",{get:function(){return"NotImplementedException"},enumerable:!1,configurable:!0}),t}(n)},"./src/utils/logger.js":
/*!*****************************!*\
  !*** ./src/utils/logger.js ***!
  \*****************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),a=r.n(i),n=function(){function e(){}return e.e=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","error",i),e.ENABLE_ERROR&&(console.error?console.error(i):console.warn)},e.i=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","info",i),e.ENABLE_INFO&&console.info&&console.info(i)},e.w=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","warn",i),e.ENABLE_WARN&&console.warn},e.d=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","debug",i),e.ENABLE_DEBUG&&console.debug&&console.debug(i)},e.v=function(t,r){t&&!e.FORCE_GLOBAL_TAG||(t=e.GLOBAL_TAG);var i="["+t+"] > "+r;e.ENABLE_CALLBACK&&e.emitter.emit("log","verbose",i),e.ENABLE_VERBOSE},e}();n.GLOBAL_TAG="flv.js",n.FORCE_GLOBAL_TAG=!1,n.ENABLE_ERROR=!0,n.ENABLE_INFO=!0,n.ENABLE_WARN=!0,n.ENABLE_DEBUG=!0,n.ENABLE_VERBOSE=!0,n.ENABLE_CALLBACK=!1,n.emitter=new(a()),t.default=n},"./src/utils/logging-control.js":
/*!**************************************!*\
  !*** ./src/utils/logging-control.js ***!
  \**************************************/function(e,t,r){"use strict";r.r(t);var i=r(/*! events */"./node_modules/events/events.js"),a=r.n(i),n=r(/*! ./logger.js */"./src/utils/logger.js"),s=function(){function e(){}return Object.defineProperty(e,"forceGlobalTag",{get:function(){return n.default.FORCE_GLOBAL_TAG},set:function(t){n.default.FORCE_GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"globalTag",{get:function(){return n.default.GLOBAL_TAG},set:function(t){n.default.GLOBAL_TAG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableAll",{get:function(){return n.default.ENABLE_VERBOSE&&n.default.ENABLE_DEBUG&&n.default.ENABLE_INFO&&n.default.ENABLE_WARN&&n.default.ENABLE_ERROR},set:function(t){n.default.ENABLE_VERBOSE=t,n.default.ENABLE_DEBUG=t,n.default.ENABLE_INFO=t,n.default.ENABLE_WARN=t,n.default.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableDebug",{get:function(){return n.default.ENABLE_DEBUG},set:function(t){n.default.ENABLE_DEBUG=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableVerbose",{get:function(){return n.default.ENABLE_VERBOSE},set:function(t){n.default.ENABLE_VERBOSE=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableInfo",{get:function(){return n.default.ENABLE_INFO},set:function(t){n.default.ENABLE_INFO=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableWarn",{get:function(){return n.default.ENABLE_WARN},set:function(t){n.default.ENABLE_WARN=t,e._notifyChange()},enumerable:!1,configurable:!0}),Object.defineProperty(e,"enableError",{get:function(){return n.default.ENABLE_ERROR},set:function(t){n.default.ENABLE_ERROR=t,e._notifyChange()},enumerable:!1,configurable:!0}),e.getConfig=function(){return{globalTag:n.default.GLOBAL_TAG,forceGlobalTag:n.default.FORCE_GLOBAL_TAG,enableVerbose:n.default.ENABLE_VERBOSE,enableDebug:n.default.ENABLE_DEBUG,enableInfo:n.default.ENABLE_INFO,enableWarn:n.default.ENABLE_WARN,enableError:n.default.ENABLE_ERROR,enableCallback:n.default.ENABLE_CALLBACK}},e.applyConfig=function(e){n.default.GLOBAL_TAG=e.globalTag,n.default.FORCE_GLOBAL_TAG=e.forceGlobalTag,n.default.ENABLE_VERBOSE=e.enableVerbose,n.default.ENABLE_DEBUG=e.enableDebug,n.default.ENABLE_INFO=e.enableInfo,n.default.ENABLE_WARN=e.enableWarn,n.default.ENABLE_ERROR=e.enableError,n.default.ENABLE_CALLBACK=e.enableCallback},e._notifyChange=function(){var t=e.emitter;if(t.listenerCount("change")>0){var r=e.getConfig();t.emit("change",r)}},e.registerListener=function(t){e.emitter.addListener("change",t)},e.removeListener=function(t){e.emitter.removeListener("change",t)},e.addLogListener=function(t){n.default.emitter.addListener("log",t),n.default.emitter.listenerCount("log")>0&&(n.default.ENABLE_CALLBACK=!0,e._notifyChange())},e.removeLogListener=function(t){n.default.emitter.removeListener("log",t),0===n.default.emitter.listenerCount("log")&&(n.default.ENABLE_CALLBACK=!1,e._notifyChange())},e}();s.emitter=new(a()),t.default=s},"./src/utils/polyfill.js":
/*!*******************************!*\
  !*** ./src/utils/polyfill.js ***!
  \*******************************/function(e,t,r){"use strict";r.r(t);var i=function(){function e(){}return e.install=function(){Object.setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},Object.assign=Object.assign||function(e){if(null==e)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(null!=i)for(var a in i)i.hasOwnProperty(a)&&(t[a]=i[a])}return t},"function"!=typeof self.Promise&&r(/*! es6-promise */"./node_modules/es6-promise/dist/es6-promise.js").polyfill()},e}();i.install(),t.default=i},"./src/utils/utf8-conv.js":
/*!********************************!*\
  !*** ./src/utils/utf8-conv.js ***!
  \********************************/function(e,t,r){"use strict";function i(e,t,r){var i=e;if(t+r<i.length){for(;r--;)if(128!=(192&i[++t]))return!1;return!0}return!1}r.r(t),t.default=function(e){for(var t=[],r=e,a=0,n=e.length;a<n;)if(r[a]<128)t.push(String.fromCharCode(r[a])),++a;else{if(r[a]<192);else if(r[a]<224){if(i(r,a,1)&&(s=(31&r[a])<<6|63&r[a+1])>=128){t.push(String.fromCharCode(65535&s)),a+=2;continue}}else if(r[a]<240){if(i(r,a,2)&&(s=(15&r[a])<<12|(63&r[a+1])<<6|63&r[a+2])>=2048&&55296!=(63488&s)){t.push(String.fromCharCode(65535&s)),a+=3;continue}}else if(r[a]<248){var s;if(i(r,a,3)&&(s=(7&r[a])<<18|(63&r[a+1])<<12|(63&r[a+2])<<6|63&r[a+3])>65536&&s<1114112){s-=65536,t.push(String.fromCharCode(s>>>10|55296)),t.push(String.fromCharCode(1023&s|56320)),a+=4;continue}}t.push(String.fromCharCode(65533)),++a}return t.join("")}}},r={};function i(e){var a=r[e];if(void 0!==a)return a.exports;var n=r[e]={exports:{}};return t[e].call(n.exports,n,n.exports,i),n.exports}return i.m=t,i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,{a:t}),t},i.d=function(e,t){for(var r in t)i.o(t,r)&&!i.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i("./src/index.js")}()},"object"==typeof r&&"object"==typeof t?t.exports=a():"function"==typeof define&&define.amd?define([],a):"object"==typeof r?r.flvjshevc=a():i.flvjshevc=a()}).call(this)}).call(this,e("_process"))},{_process:1}],7:[function(e,t,r){const i=e("../consts");r.Mp4Player=class{constructor(e){this.configFormat={width:e.width||i.DEFAULT_WIDTH,height:e.height||i.DEFAULT_HEIGHT,fps:e.fps||i.DEFAULT_FPS,fixed:e.fixed||i.DEFAULT_FIXED,sampleRate:e.sampleRate||i.DEFAULT_SAMPLERATE,appendHevcType:e.appendHevcType||i.APPEND_TYPE_STREAM,frameDurMs:e.frameDur||i.DEFAULT_FRAME_DUR,playerId:e.playerId||i.DEFAILT_WEBGL_PLAY_ID,audioNone:e.audioNone||!1,token:e.token||null,videoCodec:e.videoCodec||i.CODEC_H265,autoPlay:e.autoPlay||!1},this.videoTag=null,this.isPlaying=!1,this.duration=-1,this.seekTarget=-1,this.bufferInterval=null,this.onLoadFinish=null,this.onPlayingTime=null,this.onPlayingFinish=null,this.onPlayState=null,this.onCacheProcess=null,this.onSeekStart=null,this.onSeekFinish=null}makeIt(e){let t=this,r=document.querySelector("div#"+this.configFormat.playerId);this.videoTag=document.createElement("video"),!0===this.configFormat.autoPlay&&(this.videoTag.muted="muted",this.videoTag.autoplay="autoplay",window.onclick=document.body.onclick=function(e){t.videoTag.muted=!1,t.isPlayingState()}),this.videoTag.addEventListener("seeking",(()=>{t.onSeekStart&&t.onSeekStart(t.seekTarget)})),this.videoTag.addEventListener("seeked",(()=>{t.videoTag.currentTime,t.onSeekFinish&&t.onSeekFinish(t.videoTag.currentTime)})),this.videoTag.onplay=function(){const e=t.isPlayingState();t.onPlayState&&t.onPlayState(e)},this.videoTag.onpause=function(){const e=t.isPlayingState();t.onPlayState&&t.onPlayState(e)},this.videoTag.ontimeupdate=()=>{t.onPlayingTime&&t.onPlayingTime(t.videoTag.currentTime)},this.videoTag.onended=()=>{t.onPlayingFinish&&t.onPlayingFinish()},this.videoTag.onloadedmetadata=e=>{t.duration=t.videoTag.duration,t.onLoadFinish&&t.onLoadFinish(),null!==t.bufferInterval&&(window.clearInterval(t.bufferInterval),t.bufferInterval=null),t.bufferInterval=window.setInterval((function(){const e=t.videoTag.buffered.end(0);if(e>=t.duration-.04)return t.onCacheProcess&&t.onCacheProcess(t.duration),void window.clearInterval(t.bufferInterval);t.onCacheProcess&&t.onCacheProcess(e)}),200)},this.videoTag.src=e,this.videoTag.style.width="100%",this.videoTag.style.height="100%",r.appendChild(this.videoTag)}setPlaybackRate(e=1){return!(e<=0||null==this.videoTag||null===this.videoTag)&&(this.videoTag.playbackRate=e,!0)}getPlaybackRate(){return null==this.videoTag||null===this.videoTag?0:this.videoTag.playbackRate}getSize(){return{width:this.videoTag.videoWidth>0?this.videoTag.videoWidth:this.configFormat.width,height:this.videoTag.videoHeight>0?this.videoTag.videoHeight:this.configFormat.height}}play(){this.videoTag.play()}seek(e){this.seekTarget=e,this.videoTag.currentTime=e}pause(){this.videoTag.pause()}setVoice(e){this.videoTag.volume=e}isPlayingState(){return this.videoTag&&!this.videoTag.paused}release(){this.videoTag&&this.videoTag.remove(),this.videoTag=null,this.onLoadFinish=null,this.onPlayingTime=null,this.onPlayingFinish=null,this.onPlayState=null,this.onSeekStart=null,this.onSeekFinish=null,null!==this.bufferInterval&&(window.clearInterval(this.bufferInterval),this.bufferInterval=null),window.onclick=document.body.onclick=null}nativeNextFrame(){void 0!==this.videoTag&&null!==this.videoTag&&(this.videoTag.currentTime+=1/this.configFormat.fps)}}},{"../consts":5}],8:[function(e,t,r){const i=e("../consts"),a=e("./flv-hevc/flv-hevc.js"),n=e("../av-common");r.NvFlvjsCore=class{constructor(e){this.configFormat={width:e.width||i.DEFAULT_WIDTH,height:e.height||i.DEFAULT_HEIGHT,playerId:e.playerId||i.DEFAILT_WEBGL_PLAY_ID,ignoreAudio:e.ignoreAudio,duration:e.duration,autoPlay:e.autoPlay||!1,audioNone:e.audioNone},this.audioVoice=1,this.myPlayerID=this.configFormat.playerId+"-flv-hevc",this.myPlayer=null,this.videoContaner=null,this.videoTag=null,this.duration=-1,this.width=-1,this.height=-1,this.isPlaying=!1,this.vCodecID=i.V_CODEC_NAME_AVC,this.audioNone=!1,this.showScreen=!1,this.playPTS=0,this.vCachePTS=0,this.aCachePTS=0,this.isInitDecodeFrames=!1,this.lastDecodedFrame=0,this.lastDecodedFrameTime=-1,this.checkStartIntervalCount=0,this.checkStartInterval=null,this.checkPicBlockInterval=null,this.bufferInterval=null,this.onPlayState=null,this.onLoadFinish=null,this.onPlayingTime=null,this.onPlayingFinish=null,this.onSeekStart=null,this.onSeekFinish=null,this.onReadyShowDone=null,this.onCacheProcess=null}_reBuildFlvjs(e){this._releaseFlvjs(),this.makeIt(e)}_checkPicBlock(e){let t=this;this.checkPicBlockInterval=window.setInterval((function(){if(t.lastDecodedFrameTime>0&&n.GetMsTime()-t.lastDecodedFrameTime>1e4)return window.clearInterval(t.checkPicBlockInterval),t.checkPicBlockInterval=null,void t._reBuildFlvjs(e)}),1e3)}_checkLoadState(e){let t=this;this.checkStartIntervalCount=0,this.checkStartInterval=window.setInterval((function(){return t.lastDecodedFrame,t.isInitDecodeFrames,t.checkStartIntervalCount,!1!==t.isInitDecodeFrames?(t.checkStartIntervalCount=0,window.clearInterval(t.checkStartInterval),void(t.checkStartInterval=null)):(t.checkStartIntervalCount+=1,t.checkStartIntervalCount>20?(window.clearInterval(t.checkStartInterval),t.checkStartIntervalCount=0,t.checkStartInterval=null,void(!1===t.isInitDecodeFrames&&t._reBuildFlvjs(e))):void 0)}),500)}makeIt(e){let t=this;if(a.isSupported()){let r=document.querySelector("#"+this.configFormat.playerId);this.videoTag=document.createElement("video"),this.videoTag.id=this.myPlayerID,this.videoTag.style.width=this.configFormat.width+"px",this.videoTag.style.height=this.configFormat.height+"px",r.appendChild(this.videoTag),!0===this.configFormat.autoPlay&&(this.videoTag.muted="muted",this.videoTag.autoplay="autoplay",window.onclick=document.body.onclick=function(e){t.videoTag.muted=!1,t.isPlayingState(),window.onclick=document.body.onclick=null}),this.videoTag.onplay=function(){const e=t.isPlayingState();t.onPlayState&&t.onPlayState(e)},this.videoTag.onpause=function(){const e=t.isPlayingState();t.onPlayState&&t.onPlayState(e)},this.videoTag.addEventListener("seeking",(()=>{t.onSeekStart&&t.onSeekStart(t.seekTarget)})),this.videoTag.addEventListener("seeked",(()=>{t.videoTag.currentTime,t.onSeekFinish&&t.onSeekFinish(t.videoTag.currentTime)}));let i={hasVideo:!0,hasAudio:!(!0===this.configFormat.audioNone),type:"flv",url:e,isLive:this.configFormat.duration<=0,withCredentials:!1};this.myPlayer=a.createPlayer(i),this.myPlayer.attachMediaElement(this.videoTag),this.myPlayer.on(a.Events.MEDIA_INFO,(function(e){t.videoTag.videoWidth,!1===t.isInitDecodeFrames&&(t.isInitDecodeFrames=!0,t.width=Math.max(t.videoTag.videoWidth,e.width),t.height=Math.max(t.videoTag.videoHeight,e.height),t.duration=t.videoTag.duration,t.duration,t.onLoadFinish&&t.onLoadFinish(),t.onReadyShowDone&&t.onReadyShowDone(),t._loopBufferState(),t.isPlayingState(),t.videoTag.ontimeupdate=()=>{t.onPlayingTime&&t.onPlayingTime(t.videoTag.currentTime)},t.duration!==1/0&&t.duration>0&&(t.videoTag.onended=()=>{t.onPlayingFinish&&t.onPlayingFinish()}))})),this.myPlayer.on(a.Events.STATISTICS_INFO,(function(e){t.videoTag.videoWidth,t.videoTag.videoHeight,t.videoTag.duration,!1===t.isInitDecodeFrames&&t.videoTag.videoWidth>0&&t.videoTag.videoHeight>0&&(t.isInitDecodeFrames=!0,t.width=t.videoTag.videoWidth,t.height=t.videoTag.videoHeight,t.duration=t.videoTag.duration,t.duration,t.onLoadFinish&&t.onLoadFinish(),t.onReadyShowDone&&t.onReadyShowDone(),t._loopBufferState(),t.isPlayingState(),t.videoTag.ontimeupdate=()=>{t.onPlayingTime&&t.onPlayingTime(t.videoTag.currentTime)},t.duration!==1/0&&(t.videoTag.onended=()=>{t.onPlayingFinish&&t.onPlayingFinish()})),t.lastDecodedFrame=e.decodedFrames,t.lastDecodedFrameTime=n.GetMsTime()})),this.myPlayer.on(a.Events.SCRIPTDATA_ARRIVED,(function(e){})),this.myPlayer.on(a.Events.METADATA_ARRIVED,(function(e){!1===t.isInitDecodeFrames&&e.width&&e.width>0&&(t.isInitDecodeFrames=!0,t.duration=e.duration,t.width=e.width,t.height=e.height,t.duration,t.onLoadFinish&&t.onLoadFinish(),t.onReadyShowDone&&t.onReadyShowDone(),t._loopBufferState(),t.isPlayingState(),t.videoTag.ontimeupdate=()=>{t.onPlayingTime&&t.onPlayingTime(t.videoTag.currentTime)},t.duration!==1/0&&(t.videoTag.onended=()=>{t.onPlayingFinish&&t.onPlayingFinish()}))})),this.myPlayer.on(a.Events.ERROR,(function(r,i,a){t.myPlayer&&t._reBuildFlvjs(e)})),this.myPlayer.load(),this._checkLoadState(e),this._checkPicBlock(e)}else console.error("FLV is AVC/H.264, But your brower do not support mse!")}setPlaybackRate(e=1){return!(e<=0||null==this.videoTag||null===this.videoTag)&&(this.videoTag.playbackRate=e,!0)}getPlaybackRate(){return null==this.videoTag||null===this.videoTag?0:this.videoTag.playbackRate}getSize(){return{width:this.videoTag.videoWidth>0?this.videoTag.videoWidth:this.width,height:this.videoTag.videoHeight>0?this.videoTag.videoHeight:this.height}}play(){this.myPlayer.play()}seek(e){this.myPlayer.test1(),e<=0?this.myPlayer.seekStart():this.myPlayer.currentTime=e}pause(){this.myPlayer.pause()}setVoice(e){this.myPlayer.volume=e}isPlayingState(){return!this.videoTag.paused}_loopBufferState(){let e=this;e.duration<=0&&(e.duration=e.videoTag.duration),null!==e.bufferInterval&&(window.clearInterval(e.bufferInterval),e.bufferInterval=null),e.bufferInterval=window.setInterval((function(){if(!e.duration||e.duration<0)return void window.clearInterval(e.bufferInterval);const t=e.videoTag.buffered.end(0);if(t>=e.duration-.04)return e.onCacheProcess&&e.onCacheProcess(e.duration),void window.clearInterval(e.bufferInterval);e.onCacheProcess&&e.onCacheProcess(t)}),200)}_releaseFlvjs(){this.myPlayer,this.myPlayer.pause(),this.myPlayer.unload(),this.myPlayer.detachMediaElement(),this.myPlayer.destroy(),this.myPlayer=null,this.videoTag.remove(),this.videoTag=null,null!==this.checkStartInterval&&(this.checkStartIntervalCount=0,window.clearInterval(this.checkStartInterval),this.checkStartInterval=null),null!==this.checkPicBlockInterval&&(window.clearInterval(this.checkPicBlockInterval),this.checkPicBlockInterval=null),this.isInitDecodeFrames=!1,this.lastDecodedFrame=0,this.lastDecodedFrameTime=-1}release(){null!==this.checkStartInterval&&(this.checkStartIntervalCount=0,window.clearInterval(this.checkStartInterval),this.checkStartInterval=null),null!==this.checkPicBlockInterval&&(window.clearInterval(this.checkPicBlockInterval),this.checkPicBlockInterval=null),null!==this.bufferInterval&&(window.clearInterval(this.bufferInterval),this.bufferInterval=null),this._releaseFlvjs(),this.myPlayerID=null,this.videoContaner=null,this.onLoadFinish=null,this.onPlayingTime=null,this.onPlayingFinish=null,this.onSeekStart=null,this.onSeekFinish=null,this.onReadyShowDone=null,this.onPlayState=null,window.onclick=document.body.onclick=null}}},{"../av-common":4,"../consts":5,"./flv-hevc/flv-hevc.js":6}],9:[function(e,t,r){e("../consts"),e("../av-common");t.exports=class{constructor(e){this._wasm_main_thread_exports=e,this._width=0,this._height=0,this._win_w=0,this._win_h=0,this._canvas_id="",this._play_state=!1,this.av_align_doing_status=!1,this.av_align_doing_info={slow_down_count:-1,adjusted_duration:-1},this.av_align_audio_time_ms=-1,this.av_align_audio_duration_ms=-1,this.av_playback_rate=1,this.av_ignore_audio=!1,this._render_play_interval=null,this._align_av_interval=null,this.event_data_callback=null}init(e,t,r,i,a){if(this._wasm_main_thread_exports.ccall("init_cylopengl_ctx","number",[]),this._width=e,this._height=t,this._canvas_id=a,this._win_w=r,this._win_h=i,this._wasm_main_thread_exports){const n=this._wasm_main_thread_exports.ccall("cylopengl_create_context","number",["number","number","number","number","string"],[this._width,this._height,r,i,a]);if(0!=n)return console.error("cylopengl_create_context failed"),-1;return this._wasm_main_thread_exports.ccall("cylopengl_create_shader_algorithm","number",["number","number","number","number"],[e,t,0,0])<0?(console.error("cylopengl_create_shader_algorithm failed"),-1):n}return-1}append_yuv420p_texture(e,t,r,i,a,n,s,o,l){let _=-1;if(this._wasm_main_thread_exports){const d=this._wasm_main_thread_exports._malloc(e.byteLength);this._wasm_main_thread_exports.HEAPU8.set(e,d);const u=this._wasm_main_thread_exports._malloc(t.byteLength);this._wasm_main_thread_exports.HEAPU8.set(t,u);const c=this._wasm_main_thread_exports._malloc(r.byteLength);this._wasm_main_thread_exports.HEAPU8.set(r,c),_=this._wasm_main_thread_exports.ccall("cylopengl_append_cache_yuv420p","number",["number","number","number","number","number","number","number","number","number"],[d,u,c,i,a,n,s,o,l]),this._wasm_main_thread_exports._free(d),this._wasm_main_thread_exports._free(u),this._wasm_main_thread_exports._free(c)}return _}get_yuv420p_cache_length(){return this._wasm_main_thread_exports?this._wasm_main_thread_exports.ccall("cylopengl_get_cache_yuv_length","number",[]):-1}clean_cache_queue(){return this._wasm_main_thread_exports?this._wasm_main_thread_exports.ccall("cylopengl_clean_cache_queue","number",[]):-1}check_with_audio_pts_ms(e,t){let r=this;return e<0?-2:(this._align_av_interval&&(clearInterval(this._align_av_interval),this._align_av_interval=null),this._wasm_main_thread_exports&&(this._align_av_interval&&(clearInterval(this._align_av_interval),this._align_av_interval=null),this._align_av_interval=setInterval((()=>{let i=r._wasm_main_thread_exports.ccall("cylopengl_first_cache_pts_ms","number",[],[]);if(i<0)return console.error("cylopengl check_with_audio_pts_ms INTERVAL cylopengl_first_cache_pts_ms failed"),clearInterval(r._align_av_interval),r._align_av_interval=null,-3;if(e>i){const e=r._wasm_main_thread_exports.ccall("cylopengl_pop_cache_yuv420p","number",[]);if(e<0)return console.error("cylopengl check_with_audio_pts_ms INTERVAL cylopengl_pop_cache_yuv420p failed"),clearInterval(r._align_av_interval),r._align_av_interval=null,-4;r.event_data_callback&&r.event_data_callback({type:"set_cache_size",payload:{cache_size:e}})}else clearInterval(r._align_av_interval),r._align_av_interval=null,t&&t()}),5)),-1)}render_yuv420p_texture(){let e=this;if(this._wasm_main_thread_exports){const t=this._wasm_main_thread_exports.ccall("cylopengl_render_cache_yuv420p","number",[]);return this.event_data_callback&&this.event_data_callback({type:"render_progress",payload:{pts:t,width:this._width,height:this._height,cache_size:e.get_yuv420p_cache_length()}}),t}return console.error("render_yuv420p_texture _wasm_main_thread_exports is null"),-1}audio_play_info(e,t){this._wasm_main_thread_exports&&(this.av_align_audio_time_ms=e,this.av_align_audio_duration_ms=t)}set_playback_rate(e=1){this.av_playback_rate=e||1}render_play(e,t,r=!1){let i=this;this.av_ignore_audio=r||!1,this._render_play_interval&&(cancelAnimationFrame(this._render_play_interval),this._render_play_interval=null);let a=t;a=t/this.av_playback_rate;let n=performance.now()+a;if(this._play_state=!0,this.av_ignore_audio){const e=()=>{if(this._play_state){if(performance.now()>=n){const e=i.render_yuv420p_texture();e>=0&&(i._wasm_main_thread_exports.av_align_video_play_ms=e),n+=a}a=t/i.av_playback_rate,i._render_play_interval=requestAnimationFrame(e)}};i._render_play_interval=requestAnimationFrame(e)}else{const e=()=>{if(this._play_state){if(performance.now()>=n){const e=i.render_yuv420p_texture();if(e>=0&&(i._wasm_main_thread_exports.av_align_video_play_ms=e),n+=a,!i.av_align_doing_status&&i.av_align_audio_time_ms>0&&i.av_align_audio_duration_ms>0&&i._wasm_main_thread_exports.av_align_video_play_ms>0){i.av_align_doing_status=!0;const t=i.av_align_audio_time_ms-e,r=Math.abs(t);if(r>(i.av_align_audio_duration_ms||15*a)){if(i.av_align_doing_info.slow_down_count=Math.ceil(r/a),i.av_align_doing_info.adjusted_duration=Math.min(1.2*a,a+7)-a,t<0){if(console.error("gl render audio is Slower than video, slow_down_count:",i.av_align_doing_info.slow_down_count,"adjusted_duration:",i.av_align_doing_info.adjusted_duration),r>1e3)return void(i.event_data_callback&&this.event_data_callback({type:"av_align_audio_slower_too_much",payload:r}))}else if(i.av_align_doing_info.adjusted_duration=-1*i.av_align_doing_info.adjusted_duration,console.error("gl render audio is Faster than video, slow_down_count:",i.av_align_doing_info.slow_down_count,"adjusted_duration:",i.av_align_doing_info.adjusted_duration),r>1e3)return void(i.event_data_callback&&this.event_data_callback({type:"av_align_audio_faster_too_much",payload:r}));n+=i.av_align_doing_info.adjusted_duration,i.av_align_doing_info.slow_down_count--}}else n+=i.av_align_doing_info.adjusted_duration,i.av_align_doing_info.slow_down_count--,i.av_align_doing_info.slow_down_count<=0&&(i.av_align_doing_status=!1,i.av_align_doing_info.slow_down_count=-1,i.av_align_doing_info.adjusted_duration=-1)}a=t/i.av_playback_rate,i._render_play_interval=requestAnimationFrame(e)}};i._render_play_interval=requestAnimationFrame(e)}}is_playing(){return!!this._render_play_interval}render_pause(){this._play_state=!1,this._render_play_interval&&(cancelAnimationFrame(this._render_play_interval),this._render_play_interval=null),this._align_av_interval&&(clearInterval(this._align_av_interval),this._align_av_interval=null)}release(){return render_pause(),this.event_data_callback=null,this._wasm_main_thread_exports&&this._wasm_main_thread_exports.ccall("cylopengl_release_renderer_source","number",[]),0}}},{"../av-common":4,"../consts":5}],10:[function(e,t,r){function i(){const e=[{code:"1",name:"Main"},{code:"2",name:"Main 10"},{code:"3",name:"Main Still Picture"}],t=["B","A"],r=["93","120","123","150","153","156"],i=[];for(const a of e)for(const e of t)for(const t of r)i.push(`hvc1.${a.code}.${t}.${e}0`),i.push(`hev1.${a.code}.${t}.${e}0`),i.push(`hvc1.${a.code}.${t}.${e}`),i.push(`hev1.${a.code}.${t}.${e}`);i.push("hvc1.1.6.L93.B0"),i.push("hev1.1.6.L93.B0");const a={supported:!1,supportedCodecs:[],unsupportedCodecs:[]};return i.forEach((e=>{const t=`video/mp4;codecs="${e}"`;MediaSource.isTypeSupported(t)?(a.supported=!0,a.supportedCodecs.push(e)):a.unsupportedCodecs.push(e)})),a.supportedCodecs,a.unsupportedCodecs,console.groupEnd(),a.supported}function a(){try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0]));return!0}}catch(e){}return!1}async function n(e=""){if(/^((?!chrome|android).)*safari/i.test(navigator.userAgent))return!1;const t=["hvc1.1.6.L93.B0","hev1.1.6.L93.B0","hvc1.1.6.L93.0","hev1.1.6.L93.0","hvc1.1.6.L93","hev1.1.6.L93","hvc1.1.6.L90","hev1.1.6.L90","hvc1.1.6.L90.0","hev1.1.6.L90.0","hvc1.1.6.L80","hev1.1.6.L80","hvc1.1.6.L80.0","hev1.1.6.L80.0","hvc1.1.6.L70","hev1.1.6.L70","hvc1.1.6.L70.0","hev1.1.6.L70.0","hvc1.1.6.L60","hev1.1.6.L60","hvc1.1.6.L60.0","hev1.1.6.L60.0","hvc1.1.6.L50","hev1.1.6.L50","hvc1.1.6.L50.0","hev1.1.6.L50.0","hvc1.1.6.L40","hev1.1.6.L40","hvc1.1.6.L40.0","hev1.1.6.L40.0","hvc1.1.6.L30","hev1.1.6.L30","hvc1.1.6.L30.0","hev1.1.6.L93"];return await async function(){for(const r of t)try{const t={codec:r,width:1280,height:720,description:e.buffer},i=await VideoDecoder.isConfigSupported(t);if(i.supported,i.supported)return!0}catch(e){}return!1}()}t.exports={testSupportMseHEVC:i,testWebCodecSupportHEVC:n,testWebAssemblySupport:a,testCheckAllSupport:async function(){const e={mse_hevc:null,wasm_hevc:null,webcodec_hevc:null};return e.mse_hevc=i(),e.wasm_hevc=a(),e.webcodec_hevc=await n(),e},CORE_TYPE_WEBCODEC_HEVC:"webcodec_hevc",CORE_TYPE_WASM_HEVC:"wasm_hevc",CORE_TYPE_MSE_HEVC:"mse_hevc",CORE_TYPE_MSE_MP4:"mse_mp4",CORE_TYPE_MSE_VIDEOJS:"mse_videojs",CORE_TYPE_MSE_FLVJS:"mse_flvjs",CORE_TYPE_EXT_H265WEB:"ext_h265web",PLAYER_MODE_NOTIME_LIVE:"live",PLAYER_MODE_VOD:"vod"}},{}],11:[function(e,t,r){e("../consts");const i=e("../av-common");create_worker_decoder=function(){return new Worker(i.GetScriptPath((function(){let e=!1,t=[],r=null,i=null,a=null,n=!1,s={slow_down_count:-1,adjusted_duration:-1},o=-1,l=-1,_=100;let d=-1,u=1,c=!1,h=null,f=null;function p(){d=-1,a&&(clearInterval(a),a=null),t.forEach((e=>{e.data=null})),t=[],t.length=0}function m(){a&&(clearInterval(a),a=null);let e=0;a=setInterval((()=>{if(!r)return void console.error("decode worker wasm is null");if(r.decoder_error_wait)return void console.error("decoder info:wasmCodecExports.decoder_error_wait");let a=r.ccall("wcodec_get_frame_queue_length","number",["number"],[i]);if(a<=0&&1!==e?(e=1,self.postMessage({type:"on_load_cache"})):a>0&&2!==e&&(e=2,self.postMessage({type:"on_finish_cache",payload:{store_length:a}})),a>=_)return;if(t.length<1)return void self.postMessage({type:"request_demux",payload:{recv_v_count:100,recv_a_count:200}});const n=t.shift();if(!n)return;const s=r._malloc(n.data.byteLength);r.HEAPU8.set(n.data,s),r.ccall("wcodec_feed_data","",["number","number","number","number","number"],[i,s,n.data.byteLength,BigInt(Math.floor(Number(1e3*n.pts))),n.isKey]),r._free(s)}),10)}async function y(e,t){if("undefined"==typeof WebAssembly)return self.postMessage({type:"error",payload:"当前浏览器不支持WebAssembly"}),!1;try{importScripts(e);const a=t;if(r=await new Promise((e=>{const t=WasmModule({locateFile:e=>a,onRuntimeInitialized:()=>{e(t)}})})),!r)return console.error("decoder info:WebAssembly module initialized wasmCodecExports: False"),!1;r._main(),Object.keys(r);r?(i=r.ccall("init_webcodec_ctx","number",[],[]),r.decoder_ctx_ptr=i):console.error("decoder info:initDecoder: wasmCodecExports is NULL");self.postMessage({type:"ready"})}catch(e){return console.error("decoder info:worker-decoder.js Failed to initialize WebAssembly:",e),self.postMessage({type:"error",payload:e.message}),!1}return!0}async function g(e,t=1920,i=1080){const a=await async function(e,t,r){const i=["hvc1.1.6.L93.B0","hev1.1.6.L93.B0","hvc1.1.6.L93.0","hev1.1.6.L93.0","hvc1.1.6.L93","hev1.1.6.L93","hvc1.1.6.L90","hev1.1.6.L90","hvc1.1.6.L90.0","hev1.1.6.L90.0","hvc1.1.6.L80","hev1.1.6.L80","hvc1.1.6.L80.0","hev1.1.6.L80.0","hvc1.1.6.L70","hev1.1.6.L70","hvc1.1.6.L70.0","hev1.1.6.L70.0","hvc1.1.6.L60","hev1.1.6.L60","hvc1.1.6.L60.0","hev1.1.6.L60.0","hvc1.1.6.L50","hev1.1.6.L50","hvc1.1.6.L50.0","hev1.1.6.L50.0","hvc1.1.6.L40","hev1.1.6.L40","hvc1.1.6.L40.0","hev1.1.6.L40.0","hvc1.1.6.L30","hev1.1.6.L30","hvc1.1.6.L30.0","hev1.1.6.L93"],a=await async function(){const a=[];for(const n of i)try{const i={codec:n,width:t,height:r,description:e.buffer},s=await VideoDecoder.isConfigSupported(i);s.supported,s.supported&&a.push(s.config.codec)}catch(e){}return a}();return a}(e,t,i);if(a.length<=0)return console.error("decoder info:not support codec"),!1;const n={codec:a[0],width:t,height:i,optimizeForLatency:!0,latencyMode:"realtime",description:e.buffer};Array.from(new Uint8Array(e.slice(0,4))),Array.from(new Uint8Array(e.slice(4,8))),Array.from(new Uint8Array(e.slice(8,12)));try{const e=await VideoDecoder.isConfigSupported(n);if(!e.supported)return void console.error("brower not support codec");r.decoder_conf=n,r.decoder.configure(r.decoder_conf)}catch(e){return void console.error("brower codec decode failed:",e)}}self.onmessage=async function(a){if("init"===a.data.type)return c=a.data.payload.ignore_audio||!1,a.data,a.data.payload.wasm_js_path,a.data.payload.wasm_wasm_path,void await y(a.data.payload.wasm_js_uri,a.data.payload.wasm_wasm_uri);if("canvas"===a.data.type){a.data,r.canvas=a.data.payload.offscreen,r.canvas_id=a.data.payload.canvas_id;const e=a.data.payload.width,t=a.data.payload.height,n=r.canvas.getContext("webgl2",{antialias:!1,powerPreference:"high-performance"});if(r.gl=n,r.ccall("wcodec_init_gl_cb","",["number","string"],[i,r.canvas_id]),r.decoder){const r=new Uint8Array(a.data.payload.extra_data);r.buffer,await g(r,e,t)}else console.error("wasmCodecExports decoder is null")}else if("demuxer_extradata_cb"===a.data.type){if(a.data,r.decoder){const e=new Uint8Array(a.data.payload.extra_data);e.buffer,await g(e)}}else if("demuxer_nalu_cb"===a.data.type){a.data;const e=a.data.payload.pts,r=a.data.payload.dts,i=a.data.payload.w,n=a.data.payload.h,s=a.data.payload.isKey,o={data:a.data.payload.nalu,pts:e,dts:r,width:i,height:n,isKey:s};t.push(o),t.length}else if("get_nalu_len"===a.data.type){const e=t.length;self.postMessage({type:"get_nalu_len_result",payload:e})}else if("cache_tex"===a.data.type){if(t.length<1)return;let e=r.ccall("wcodec_get_frame_queue_length","number",["number"],[i]);const n=a.data.payload.recv_v_count,s=e+n;for(let a=0;a<n;a++){if(a>=n&&(e=r.ccall("wcodec_get_frame_queue_length","number",["number"],[i]),e>=s))return;const o=t.shift();if(!o)return;const l=r._malloc(o.data.byteLength);r.HEAPU8.set(o.data,l),r.ccall("wcodec_feed_data","",["number","number","number","number","number"],[i,l,o.data.byteLength,BigInt(Math.floor(Number(1e3*o.pts))),o.isKey]),r._free_buffer(l)}}else if("get_tex_len"===a.data.type){const e=r.ccall("wcodec_get_frame_queue_length","number",["number"],[i]);self.postMessage({type:"get_tex_len_result",payload:e})}else if("clean_cache_queue"===a.data.type)p(),r.ccall("wcodec_clean_tex_queue","",["number"],[i]);else if("seek_decode"===a.data.type)a.data.payload,d=BigInt(Math.floor(1e3*Number(a.data.payload.seekTime))),r.webcodec_seek_target_pts=d,m();else if("render_tex"===a.data.type){r.ccall("wcodec_render_frame_from_queue","number",["number"],[i])}else if("set_playback_rate"===a.data.type)a.data.payload,u=a.data.payload.playback_rate||1;else if("render_play"===a.data.type){h&&(cancelAnimationFrame(h),h=null),f&&(clearInterval(f),f=null);const e=a.data.payload.frame_duraiton;let t=e/u;a.data.payload.fps;let _=performance.now()+t;if(c){const a=()=>{if(performance.now()>=_){r.ccall("wcodec_render_frame_from_queue","number",["number"],[i]);_+=t}t=e/u,h=requestAnimationFrame(a)};h=requestAnimationFrame(a)}else{const a=()=>{if(performance.now()>=_){r.ccall("wcodec_render_frame_from_queue","number",["number"],[i]);if(_+=t,!n&&o>0&&l>0&&r.av_align_video_play_ms>0){const e=r.av_align_video_play_ms;n=!0;const a=o-e,d=Math.abs(a);if(d>(l||15*t)){if(s.slow_down_count=Math.ceil(d/t),s.adjusted_duration=Math.min(1.2*t,t+7)-t,a<0){if(s.slow_down_count,s.adjusted_duration,d>1e3)return void self.postMessage({type:"av_align_audio_slower_too_much",payload:d})}else if(s.adjusted_duration=-1*s.adjusted_duration,s.slow_down_count,s.adjusted_duration,d>1e3)return self.postMessage({type:"av_align_audio_faster_too_much",payload:d}),void function(e=-1){e<0||(f&&(clearInterval(f),f=null),f=setInterval((()=>{let t=r.av_align_video_play_ms;if(t<0)return console.error("align_av_timestamp INTERVAL first cache pts ms failed"),clearInterval(f),f=null,-3;if(e>t){if(r.ccall("cylopengl_pop_cache","number",["number"],[i])<0)return console.error("align_av_timestamp INTERVAL cylopengl_pop_cache failed"),clearInterval(f),f=null,-4}else clearInterval(f),f=null,h&&self.postMessage({type:"av_align_finished"})}),50))}(l);_+=s.adjusted_duration,s.slow_down_count--}}else _+=s.adjusted_duration,s.slow_down_count--,s.slow_down_count<=0&&(n=!1,s.slow_down_count=-1,s.adjusted_duration=-1)}t=e/u,h=requestAnimationFrame(a)};h=requestAnimationFrame(a)}}else if("render_pause"===a.data.type)h&&(cancelAnimationFrame(h),h=null);else if("gpu_memory_info"===a.data.type){const e=r.ccall("wcodec_gpu_memory_info","number",["number"],[i]);self.postMessage({type:"gpu_memory_info_result",payload:e})}else"probe_ok"===a.data.type?(e=!0,_=!a.data.payload.w||!a.data.payload.h||a.data.payload.w<=0||a.data.payload.h<=0?100:function(e,t){const[r,i]=e>t?[e,t]:[t,e],a=4096,n=8192,s=24576,o=r*i*4*1.1/1048576;return{resolution:`${r}x${i}`,frameSizeMB:o.toFixed(2),capacities:{integrated:Math.floor(a/o),mainstream:Math.floor(n/o),flagship:Math.floor(s/o)},currentDevice:{estimated:Math.floor(4096/o/5)}}}(a.data.payload.w,a.data.payload.h).currentDevice.estimated,m()):"audio_play_info"===a.data.type?(o=a.data.payload.pts,l=a.data.payload.duration):"release"===a.data.type&&(r?i?(r.ccall("release_webcodec_ctx","number",["number"],[i]),i=null,r.decoder_ctx_ptr=null,r&&(r.webcodec_seek_target_pts=-1,r._free&&r._free(),r=null),h&&(cancelAnimationFrame(h),h=null),p()):console.error("decoder info:releaseDecoder: decoder_ctx_ptr is NULL"):console.error("decoder info:releaseDecoder: wasmCodecExports is NULL"),self.close())}})))},t.exports=create_worker_decoder},{"../av-common":4,"../consts":5}],12:[function(e,t,r){const i=e("../av-common");create_worker_demuxer=function(){return new Worker(i.GetScriptPath((function(){class e{constructor(e,t,r,i){this.pts=e,this.dts=e,this.isKey=t,this.data=r,this.video=i}setFrame(e,t,r,i){this.pts=e,this.isKey=t,this.data=r,this.video=i}}const t=(e=100)=>{let t="UNKNOWN";switch(e){case 0:default:t="MP4";break;case 1:t="FLV";break;case 2:t="MKV";break;case 3:t="HLS";break;case 4:t="TS"}return t.toLowerCase()},r="live",i="vod";let a=null,n=null,s=null,o=new AbortController,l=o.signal,_=null,d=-1,u=null,c=r,h=0,f=0,p=0,m=!1,y=null,g=null,v=null,b=!1,E=0,w=0,S=(()=>{let t={videoBuffer:[],audioBuffer:[],idrIdxBuffer:[],appendFrame:(r,i,a=!0,n=!1)=>{let s=new e(r,n,i,a),o=parseInt(r);return a?(t.videoBuffer.length-1>=o?t.videoBuffer[o].push(s):t.videoBuffer.push([s]),n&&!t.idrIdxBuffer.includes(r)&&t.idrIdxBuffer.push(r)):t.audioBuffer.length-1>=o&&null!=t.audioBuffer[o]&&null!=t.audioBuffer[o]?t.audioBuffer[o]&&t.audioBuffer[o].push(s):t.audioBuffer.push([s]),!0}};return t.appendFrameWithDts=(r,i,a,n=!0,s=!1)=>{let o=((t,r,i,a,n)=>{let s=new e(t,i,a,n);return s.dts=r,s})(r,i,s,a,n),l=parseInt(i);return n?(t.videoBuffer.length-1>=l?t.videoBuffer[l].push(o):t.videoBuffer.push([o]),s&&!t.idrIdxBuffer.includes(i)&&t.idrIdxBuffer.push(i)):t.audioBuffer.length-1>=l&&null!=t.audioBuffer[l]&&null!=t.audioBuffer[l]?t.audioBuffer[l]&&t.audioBuffer[l].push(o):t.audioBuffer.push([o]),t.videoBuffer,t.idrIdxBuffer,!0},t.appendFrameByBufferFrame=e=>{let r=e.pts,i=parseInt(r);return e.video?(t.videoBuffer.length-1>=i?t.videoBuffer[i].push(e):t.videoBuffer.push([e]),isKey&&!t.idrIdxBuffer.includes(r)&&t.idrIdxBuffer.push(r)):t.audioBuffer.length-1>=i?t.audioBuffer[i].push(e):t.audioBuffer.push([e]),!0},t.cleanPipeline=()=>{t.idrIdxBuffer.length=0;for(let e=0;e<t.videoBuffer.length;e++){for(let r=0;r<t.videoBuffer[e].length;r++)t.videoBuffer[e][r].data=null;t.videoBuffer[e].length=0}t.videoBuffer.length=0;for(let e=0;e<t.audioBuffer.length;e++){for(let r=0;r<t.audioBuffer[e].length;r++)t.audioBuffer[e][r].data=null;t.audioBuffer[e].length=0}t.audioBuffer.length=0},t.vFrame=(e=-1)=>{if(!(e<0||e>t.videoBuffer.length-1))return t.videoBuffer[e]},t.aFrame=(e=-1)=>{if(!(e<0||e>t.audioBuffer.length-1))return t.audioBuffer[e]},t.seekIDR=(e=-1)=>{if(e=Number(e),t.idrIdxBuffer,t.videoBuffer,e<0)return null;if(t.idrIdxBuffer.includes(e)){const r=t.idrIdxBuffer.indexOf(e);return r-1>=0?t.idrIdxBuffer[r-1]:e}for(let r=0;r<t.idrIdxBuffer.length;r++)if(t.idrIdxBuffer[r],t.idrIdxBuffer[r+1],r===t.idrIdxBuffer.length-1||t.idrIdxBuffer[r]<e&&t.idrIdxBuffer[r+1]>e||0===r&&t.idrIdxBuffer[r]>=e){for(let e=1;e>=0;e--){let i=r-e;if(i>=0)return t.idrIdxBuffer[i],t.idrIdxBuffer[i]}return t.idrIdxBuffer[r],j,t.idrIdxBuffer[r]}},t})(),L=-1,k=-1,A={video_count:0,audio_count:0},x=!1,T=null,C=null,R=null,O=null,P=null,I=null,M=null;let D=null;function B(){return o&&o.abort(),u&&u.close(),u=null,y&&(clearInterval(y),y=null),g&&(clearInterval(g),g=null),v&&(clearInterval(v),v=null),b=!1,k=0,L=0,D&&(D=null),a&&n?(a.ccall("release_demuxer_ctx","number",["number"],[n]),n=null,T&&a.removeFunction(T),C&&a.removeFunction(C),R&&a.removeFunction(R),O&&a.removeFunction(O),P&&a.removeFunction(P),I&&a.removeFunction(I),M&&a.removeFunction(M),T=null,C=null,R=null,O=null,P=null,I=null,M=null,a&&(a._free&&a._free(),a=null),S.cleanPipeline(),m=!1,!0):(console.error("release: ctx_ptr is NULL"),!1)}function F(e=1,t=1){if(!a||!n)return console.error("demux: ctx_ptr is NULL"),!1;return a.ccall("demuxer_video_pkt","number",["number","number","number"],[n,e,t])}function U(){g||(g=setInterval((function(){if(A.video_count>0){let e=L<0?0:Number(Math.floor(L)),t=0;for(;S.videoBuffer[e]&&!(S.videoBuffer[e].length<=0);){if(t>S.videoBuffer[e].length-1){if(S.videoBuffer[e+1]&&S.videoBuffer[e+1].length>0){e++,t=0;continue}break}const r=S.videoBuffer[e][t];if(t++,!(L>0&&r.dts<=L)&&(self.postMessage({type:"demuxer_nalu_cb",payload:{pts:r.pts,dts:r.dts,isKey:r.isKey,nalu:r.data,w:h,h:f}}),L=r.dts,A.video_count--,A.video_count<=0))break}}}),50)),v||(v=setInterval((function(){if(A.audio_count>0){let e=k<0?0:Number(Math.floor(k)),t=0;for(;S.audioBuffer[e]&&!(S.audioBuffer[e].length<=0);){if(t>S.audioBuffer[e].length-1){if(S.audioBuffer[e+1]&&S.audioBuffer[e+1].length>0){t=0,e++;continue}break}const r=S.audioBuffer[e][t];if(t++,!(k>0&&r.pts<=k)&&(self.postMessage({type:"demuxer_aac_cb",payload:{pts:r.pts,nalu:r.data,len:r.data.byteLength,ch:p}}),k=r.pts,A.audio_count--,A.audio_count<=0))break}}}),50))}function N(e,t){const r=new Uint8Array(e.length+t.length);return r.set(e),r.set(t,e.length),r}function V(e,t=!1){s=e;let h=4096;if(!a||!n)return void console.error("release: ctx_ptr is NULL");if(-1!==["ws","wss","websocket"].indexOf(_))try{return function(e){u&&u.close(),u=null,u=new WebSocket(e),u.binaryType="arraybuffer";let t=4096;u.onopen=function(e){c=r,a&&n&&(a.ccall("ffdemuxer_set_read_frame_multiple_times","number",["number","number"],[n,d>0?d:2]),a.ccall("ffdemuxer_set_mode_live","number",["number"],[n]))},u.onmessage=function(e){if(e.data instanceof ArrayBuffer){var r=e.data;if(D){const e=new Uint8Array(r);D=N(D,e)}else D=new Uint8Array(r);if(m&&(t=4096),r.byteLength>0&&(D.length>=t||c==i)){if(a){data=D;const e=a._malloc(data.length);a.HEAPU8.set(data,e),a.ccall("push_buffer","number",["number","number","number","number"],[n,e,data.length,4096]),a._free(e)}D=null}}},u.onclose=function(e){D&&(D=null),self.postMessage({type:"fetch-done",payload:{url:s,msg:"fetch-done",is_vod:!1,is_complete:!0}})}}(e)}catch(e){return void console.error("WebSocket link err:",e)}o||(o=new AbortController,l=o.signal);let f=0;fetch(e,{demuxer_fetch_signal:l}).then((e=>{if(!e.ok)return D&&(D=null),void self.postMessage({type:"fetch-response-error",payload:{url:s,msg:"fetch-response-error"}});e.status,e.statusText,t&&self.postMessage({type:"fetch-retry-response-ok",payload:{url:s,msg:"fetch-retry-response-ok"}});const o=e.headers.get("Content-Length");o&&o>0?(c=i,a.ccall("ffdemuxer_set_read_frame_multiple_times","number",["number","number"],[n,d>0?d:3])):(c=r,a&&n&&(a.ccall("ffdemuxer_set_read_frame_multiple_times","number",["number","number"],[n,d>0?d:2]),a.ccall("ffdemuxer_set_mode_live","number",["number"],[n])));const l=e.body.getReader();return l.read().then((function e({done:t,value:r}){if(t){if(demuxer_fetch_done=!0,a&&a.ccall("fetch_done_buffer","number",["number"],[n]),D){if(a){const e=a._malloc(D.length);a.HEAPU8.set(D,e),D.length;a.ccall("push_buffer","number",["number","number","number","number"],[n,e,D.length,4096]);a._free(e)}D=null}else if(a){a.ccall("push_probe","number",["number","number"],[n,4096])}return c===i&&f===parseInt(o)?void self.postMessage({type:"fetch-done",payload:{url:s,msg:"fetch-done",is_vod:!0,is_complete:!0}}):void self.postMessage({type:"fetch-done",payload:{url:s,msg:"fetch-done",is_vod:c===i}})}if(r&&(f+=r.byteLength),D){const e=new Uint8Array(r);D=N(D,e)}else D=new Uint8Array(r);if(m&&(h=4096),D.length>=h||c==i){if(a){const e=a._malloc(D.length);a.HEAPU8.set(D,e),D.length;a.ccall("push_buffer","number",["number","number","number","number"],[n,e,D.length,4096]);a._free(e)}D=null}return l.read().then(e)}))})).catch((function(e){if(D&&(D=null),!e.toString().includes("user aborted")){const t=" httplive request error:"+e+" start to retry";console.error("fetch error:",t),self.postMessage({type:"fetch-error",payload:t})}}))}async function G(e,s){if("undefined"==typeof WebAssembly)return self.postMessage({type:"error",payload:"当前浏览器不支持WebAssembly"}),!1;try{importScripts(e);const o=s;if(a=await new Promise((e=>{const t=WasmModule({locateFile:e=>o,onRuntimeInitialized:()=>{e(t)}})})),!a)return console.error("initialized wasm ptr: False"),!1;a._main(),Object.keys(a);a?n=a.ccall("init_demuxer_ctx","number",[],[]):console.error("ctx_ptr is NULL");const l={test:"v",probe:"vidiidiiiiiiii",extra:"vii",yuv:"viiiiiiiidi",nalu:"viiiiidd",pcm:"viid",aac:"viiid"};if(!a)return void console.error("ctx_ptr is NULL");T=a.addFunction((()=>{}),l.test),C=a.addFunction(((e,n,s,o,l,_,d,u,g,v,S,L,k)=>{if(!a)return void console.error("ctx_ptr is NULL");const A=a.UTF8ToString(v);m=!0;const x=new Uint8Array(L);x.set(new Uint8Array(a.HEAPU8.buffer,k,L)),x.buffer,c=n>0?i:r,h=s,f=o,p=u,self.postMessage({type:"demuxer_probe_cb",payload:{needSwr:e,duration:n,demuxer_media_type:c,w:s,h:o,fps:l,audioIndex:_,sampleRate:d,channel:u,codec:g,fmt:A,media_fmt:t(S),extra_data:x.buffer,extra_size:L}},[x.buffer]),c==i&&(y||(y=setInterval((function(){100==F(100,200)&&(b=!0,self.postMessage({type:"demuxer_vod_nalu_done",payload:{v_last_dts_sec:E,a_last_dts_sec:w,v_last_dts:1e3*E,a_last_dts:1e3*w}}),clearInterval(y),y=null)}),100)),U())}),l.probe),R=a.addFunction(((e,t)=>{}),l.extra),O=a.addFunction(((e,t,r,i,a,n,s,o,l,_)=>{}),l.yuv),P=a.addFunction(((e,t,r,n,s,o,l)=>{if(E=Math.max(E,l),!a)return void console.error("ctx_ptr is NULL");const _=new Uint8Array(t);_.set(a.HEAPU8.subarray(e,e+t)),c===i?S.appendFrameWithDts(o,l,_,!0,r):self.postMessage({type:"demuxer_nalu_cb",payload:{nalu:_,pts:o,dts:l,isKey:r,w:n,h:s}})}),l.nalu),I=a.addFunction(((e,t,r)=>{if(w=Math.max(w,r),!a)return void console.error("ctx_ptr is NULL");const n=new Uint8Array(t);n.set(a.HEAPU8.subarray(e,e+t)),c===i?S.appendFrame(r,n,!1,!0):self.postMessage({type:"demuxer_aac_cb",payload:{nalu:n,len:t,pts:r,ch:1}})}),l.pcm),M=a.addFunction(((e,t,r,n)=>{if(w=Math.max(w,n),!a)return void console.error("ctx_ptr is NULL");const s=new Uint8Array(t);s.set(a.HEAPU8.subarray(e,e+t)),c===i?S.appendFrame(n,s,!1,!0):self.postMessage({type:"demuxer_aac_cb",payload:{nalu:s,len:t,pts:n,ch:r}})}),l.aac);a.ccall("bind_demuxer_callback","number",["number","number","number","number","number","number","number","number","number","number"],[n,T,C,R,O,P,I,M,x?1:0,30])}catch(e){return console.error("worker.js Failed to initialize WebAssembly:",e),self.postMessage({type:"error",payload:e.message}),!1}return self.postMessage({type:"ready"}),!0}onmessage=async function(e){if("init"===e.data.type)return e.data,e.data.payload.wasm_js_path,e.data.payload.wasm_wasm_path,x=e.data.payload.ignore_audio||!1,await G(e.data.payload.wasm_js_uri,e.data.payload.wasm_wasm_uri),a?(_=e.data.payload.protocol,d=e.data.payload.readframe_multi_times||-1,void(e.data.payload.media_uri&&V(e.data.payload.media_uri))):void console.error("wasm not initialized");if("loadMedia"===e.data.type){e.data.payload;const t=Date.now(),r=1e4,i=setInterval((()=>{a?(clearInterval(i),clearTimeout(n),_=e.data.payload.protocol,V(e.data.payload.media_uri)):Date.now()-t>r&&(clearInterval(i),console.error("WASM load timeout 10s"),self.postMessage({type:"error",payload:"WASM模块初始化超时"}))}),100),n=setTimeout((()=>{clearInterval(i)}),r)}else if("retry_load_media"===e.data.type){if(!a)return void console.error("wasm not initialized");a&&n&&(o&&o.abort(),o=null,l=null,o=new AbortController,l=o.signal,setTimeout((function(){V(s,!0)}),3e3))}else if("demux"===e.data.type){if(!a)return void console.error("wasm not initialized");const t=e.data.payload.recv_v_count||1,r=e.data.payload.recv_a_count||1;c==i?0!==A.video_count&&0!==A.audio_count||(A.video_count=t,A.audio_count=r):F(t,r)}else if("seek_demux"===e.data.type){seekTime=e.data.payload.seekTime;let t=S.seekIDR(seekTime);seekTime,L=t,k=seekTime,U(),self.postMessage({type:"ready_seek_demux",payload:{seekTime:seekTime}})}else if("test2"===e.data.type)for(;;)await new Promise((e=>setTimeout(e,0)));else if("release"===e.data.type)e.data,a&&(B(),a=null),self.close();else if("stop_cache_pkt_to_decoder"===e.data.type)g&&(clearInterval(g),g=null),v&&(clearInterval(v),v=null),A.video_count=0,A.audio_count=0;else if("restart_cache_pkt_to_decoder"===e.data.type);else if("test1"===e.data.type)for(;;)await new Promise((e=>setTimeout(e,0)))}})))},t.exports=create_worker_demuxer},{"../av-common":4}],13:[function(e,t,r){e("../consts");const i=e("../av-common");create_worker_ffdecoder=function(){return new Worker(i.GetScriptPath((function(){let e=!1,t=[],r=null,i=null,a=null,n=0,s=-1,o=0,l=0,_=!1,d=null,u=null,c=100;function h(){s=-1,a&&(clearInterval(a),a=null),t.forEach((e=>{e.data=null})),t=[],t.length=0,o=0,l=0}function f(){a&&(clearInterval(a),a=null);let e=0;a=setInterval((()=>{if(!r)return;if(r.decoder_error_wait)return void console.error("cyl debug wasmFFDecodeExports.decoder_error_wait");const a=n;if(a<=0&&1!==e?(e=1,self.postMessage({type:"on_load_cache"})):a>0&&2!==e&&(e=2,self.postMessage({type:"on_finish_cache",payload:{store_length:a}})),a>=c)return;if(t.length<1)return void self.postMessage({type:"request_demux",payload:{recv_v_count:100,recv_a_count:200}});const s=t.shift();if(!s)return void console.error("cyl debug cache_tex !naluData");let o=r._malloc(s.data.byteLength);r.HEAPU8.set(s.data,o),r.ccall("ffdecoder_decode_video_frame","",["number","number","number","number","number","number"],[i,o,s.data.length,s.pts,s.dts,s.isKey]),r._free(o),o=null}),10)}self.onmessage=async function(a){if("init"!==a.data.type)if("set_video_decoder"===a.data.type){if(!r)return void console.error("cyl debug releaseDecoder: wasmFFDecodeExports is NULL");if(!i)return void console.error("cyl debug releaseDecoder: ffdecoder_ctx_ptr is NULL");let e=new Uint8Array(a.data.payload.extra_data);e.buffer;let t=r._malloc(e.byteLength);r.HEAPU8.set(e,t);const n=a.data.payload.codec;r.ccall("ffdecoder_set_video_decoder_with_extra","number",["number","number","number","number","number","number"],[i,n,a.data.payload.width,a.data.payload.height,t,e.byteLength]);r._free(t),t=null,e=null}else if("set_audio_decoder"===a.data.type){if(!r)return void console.error("cyl debug releaseDecoder: wasmFFDecodeExports is NULL");if(!i)return void console.error("cyl debug releaseDecoder: ffdecoder_ctx_ptr is NULL");const e=a.data.payload.codec,t=a.data.payload.timebase;r.ccall("ffdecoder_set_audio_decoder","number",["number","number","number"],[i,e,t])}else if("demuxer_nalu_cb"===a.data.type){a.data;const e=a.data.payload.pts,r=a.data.payload.dts,i=a.data.payload.w,n=a.data.payload.h,s=a.data.payload.isKey,o={data:a.data.payload.nalu,pts:Math.floor(Number(1e3*e)),dts:Math.floor(Number(1e3*r)),width:i,height:n,isKey:s};t.push(o),t.length}else if("demuxer_vod_nalu_done"===a.data.type)o=a.data.payload.v_last_dts,l=a.data.payload.a_last_dts;else if("get_nalu_len"===a.data.type){const e=t.length;self.postMessage({type:"get_nalu_len_result",payload:e})}else"probe_ok"===a.data.type?(e=!0,c=function(e,t){const[r,i]=e>t?[e,t]:[t,e],a=4096,n=8192,s=24576,o=r*i*4*1.1/1048576;return{resolution:`${r}x${i}`,frameSizeMB:o.toFixed(2),capacities:{integrated:Math.floor(a/o),mainstream:Math.floor(n/o),flagship:Math.floor(s/o)},currentDevice:{estimated:Math.floor(4096/o/5)}}}(a.data.payload.w,a.data.payload.h).currentDevice.estimated,f()):"audio_play_info"===a.data.type?(av_align_audio_time_ms=a.data.payload.pts,av_align_audio_duration_ms=a.data.payload.duration):"clean_cache_queue"===a.data.type?h():"release"===a.data.type?(r?i?(r.ccall("release_ffdecoder_ctx","number",["number"],[i]),i=null,i&&r.removeFunction(d),d=null,i&&r.removeFunction(u),u=null,r.ffdecoder_ctx_ptr=null,r&&(r._free&&r._free(),r=null),h()):console.error("cyl debug releaseDecoder: ffdecoder_ctx_ptr is NULL"):console.error("cyl debug releaseDecoder: wasmFFDecodeExports is NULL"),self.close()):"seek_decode"===a.data.type?(a.data.payload,s=parseInt(Math.floor(1e3*Number(a.data.payload.seekTime))),r.ccall("ffdecoder_seek_set","",["number","number"],[i,s]),f()):"set_cache_size"===a.data.type&&(n=a.data.payload.cache_size);else{if(a.data,a.data.payload.wasm_js_uri,a.data.payload.wasm_wasm_uri,_=a.data.payload.ignore_audio||!1,!await async function(e,t){if("undefined"==typeof WebAssembly)return self.postMessage({type:"error",payload:"当前浏览器不支持WebAssembly"}),!1;try{importScripts(e);const i=t;if(r=await new Promise((e=>{const t=WasmModule({locateFile:e=>i,onRuntimeInitialized:()=>{e(t)}})})),!r)return console.error("cyl debug WebAssembly module initialized wasmFFDecodeExports: False"),!1;r._main(),Object.keys(r)}catch(e){return console.error("cyl debug worker-decoder.js Failed to initialize WebAssembly:",e),self.postMessage({type:"error",payload:e.message}),!1}return!0}(a.data.payload.wasm_js_uri,a.data.payload.wasm_wasm_uri))return;r.canvas_id=a.data.payload.canvas_id;(function(){if(!r)return console.error("cyl debug initDecoderObject: wasmFFDecodeExports is NULL"),!1;i=r.ccall("init_ffdecoder_ctx","number",[],[]),r.ffdecoder_ctx_ptr=i;const e="viiiiiiiiiii",t="viiiii";d=r.addFunction(((e,t,i,a,n,o,l,_,d,u,c)=>{const h=new Uint8Array(o*n);h.set(r.HEAPU8.subarray(e,e+o*n));const f=new Uint8Array(l*n);f.set(r.HEAPU8.subarray(t,t+l*n));const p=new Uint8Array(_*n);p.set(r.HEAPU8.subarray(i,i+_*n)),self.postMessage({type:"decode_video_progress",payload:{y_data:h,u_data:f,v_data:p,width:a,height:n,y_linesize:o,u_linesize:l,v_linesize:_,pts:d,dts:u,tag:c}}),s>=0&&d>=s&&(self.postMessage({type:"seek_success_target",payload:{width:a,height:n,pts:d,target_pts:s}}),s=-1)}),e),ffdecoder_ccallback_pcm_ptr=r.addFunction(((e,t,r,i,a)=>{pcm}),t),r.ccall("ffdecoder_bind_callback","number",["ffdecoder_ctx_ptr","number","number"],[i,d,ffdecoder_ccallback_pcm_ptr])})();self.postMessage({type:"ready"})}}})))},t.exports=create_worker_ffdecoder},{"../av-common":4,"../consts":5}],14:[function(e,t,r){(function(r){(function(){const i=e("./consts"),a=e("./av-common"),n=e("./probe"),s=e("./audio/audio-aac-core"),o=e("./audio/audio-pcm-core"),l=e("./worker/create-worker-demuxer"),_=e("./worker/create-worker-decoder"),d=e("./worker/create_worker_ffdecoder"),u=e("./opengl/cylopengl"),c=e("./native/mp4-player"),h=e("./native/nv-flvjs-core");class f{constructor(){let e=this;this._audioAACCtx=null,this._demuxer_worker=null,this._decoder_worker=null,this._video_render_pts=-1,this._player_id=null,this._player_box=null,this._canvas=null,this._canvas_id=null,this._player_width=0,this._player_height=0,this._player_video_core=null,this._play_url=null,this._wasm_js_uri=null,this._wasm_wasm_uri=null,this._wasm_main_thread_exports=null,this._opengl_render=null,this._ext_src_js_uri=null,this._ext_wasm_js_uri=null,this._ext_h265webjs_core=null,this._ext_h265webjs_loaded=!1,this._enable_play_button=!1,this._play_button_id=null,this._play_button=null,this._play_icon=null,this._pause_icon=null,this._native_core=null,this._first_frame_render=!1,this._expect_play=!1,this._media_info={needSwr:0,duration:-1,demuxer_media_type:n.PLAYER_MODE_VOD,w:-1,h:-1,fps:-1,audioIndex:-1,sampleRate:-1,channel:-1,codec:-1,fmt:"",extra_data:null,extra_size:0},this._player_vlast_dts=-1,this._player_alast_dts=-1,this._player_playbackRate=1,this._player_voice=1,this._format_type=null,this._workerFetch=null,this._workerParse=null,this._wait_init_interval=null,this._on_inited=!1,this.gpu_info_callback=null,this.video_probe_callback=null,this.video_nalu_callback=null,this.video_frame_callback=null,this.audio_frame_callback=null,this.video_render_callback=null,this.audio_render_callback=null,this.av_sync_callback=null,this.nalu_length_callback=null,this.tex_length_callback=null,this.request_pkt_callback=null,this.on_ready_show_done_callback=null,this.on_load_caching_callback=null,this.on_play_time=null,this.on_play_finished=null,this.on_finish_cache_callback=null,this.on_release_done_callback=null,this.on_seek_start_callback=null,this.on_seek_done_callback=null,this.on_cache_process_callback=null,this.auto_screen_close=!0,this.on_open_fullscreen=null,this.on_close_fullscreen=null,this.on_error_callback=null,this.screenW=window.screen.width,this.screenH=window.screen.height,document.addEventListener("fullscreenchange",(function(t){e._isFullScreen()?e.on_open_fullscreen&&e.on_open_fullscreen():(!0===e.auto_screen_close&&e.closeFullScreen(!0),e.on_close_fullscreen&&e.on_close_fullscreen())}))}_checkScreenDisplaySize(e,t,r,i){let a=r/e>i/t,n=(e/r).toFixed(2),s=(t/i).toFixed(2),o=a?n:s,l=this.fixed?e:parseInt(r*o),_=this.fixed?t:parseInt(i*o);return[parseInt((t-_)/2),parseInt((e-l)/2),l,_]}_isFullScreen(){let e=document.fullscreenElement||document.mozFullscreenElement||document.webkitFullscreenElement;document.fullscreenEnabled||document.mozFullscreenEnabled||document.webkitFullscreenEnabled;return null!=e}_requestFullScreen(e){e.requestFullscreen?e.requestFullscreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen?e.msRequestFullscreen():e.webkitRequestFullscreen&&e.webkitRequestFullScreen()}_exitFull(){document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}_full_canvas_screen(e){this._player_box.style.width=this.screenW+"px",this._player_box.style.height=this.screenH+"px";let t=this._checkScreenDisplaySize(this.screenW,this.screenH,this._media_info.w,this._media_info.h);e.style.marginTop=t[0]+"px",e.style.marginLeft=t[1]+"px",e.style.width=t[2]+"px",e.style.height=t[3]+"px",this._requestFullScreen(this._player_box)}fullScreen(){if(this.autoScreenClose=!0,this._media_info.codec,this._player_video_core,-1!==[n.CORE_TYPE_WEBCODEC_HEVC,n.CORE_TYPE_WASM_HEVC].indexOf(this._player_video_core)){let e=this._player_box.getElementsByTagName("canvas")[0];if(!e)return void console.error("fullScreen Canvas is null");this._full_canvas_screen(e)}else{let e=this._player_box.getElementsByTagName("video")[0];if(e)this._requestFullScreen(e);else{if(e=this._player_box.getElementsByTagName("canvas")[0],!e)return void console.error("fullScreen Video is null");this._full_canvas_screen(e)}}}closeFullScreen(e=!1){!1===e&&(this.autoScreenClose=!1,this._exitFull());let t=this._player_box.getElementsByTagName("canvas")[0];if(!t)return;this._player_box.style.width=this._player_width+"px",this._player_box.style.height=this._player_height+"px";let r=this._checkScreenDisplaySize(this._player_width,this._player_height,this._media_info.w,this._media_info.h);t.style.marginTop=r[0]+"px",t.style.marginLeft=r[1]+"px",t.style.width=r[2]+"px",t.style.height=r[3]+"px"}screenshot(e){const t=document.getElementById(e);if(t)if(-1!==[n.CORE_TYPE_WEBCODEC_HEVC,n.CORE_TYPE_WASM_HEVC].indexOf(this._player_video_core)){let e=this._player_box.getElementsByTagName("canvas")[0];if(!e)return void console.error("screenshot canvas is null");const r=e.toDataURL("image/png");t.src=r}else{let e=this._player_box.getElementsByTagName("video")[0];if(!e)return void console.error("screenshot Video is null");let r=document.createElement("canvas");r.width=e.videoWidth||e.width,r.height=e.videoHeight||e.height;let i=r.getContext("2d");i.drawImage(e,0,0,r.width,r.height),t.src=r.toDataURL("image/png"),r.width=1,r.height=1,r.remove(),r=null,i=null}else console.error("screenshot img is null")}next_frame(){if(-1!==[n.CORE_TYPE_WEBCODEC_HEVC,n.CORE_TYPE_WASM_HEVC].indexOf(this._player_video_core))this.render_tex();else{let e=this._player_box.getElementsByTagName("video")[0];if(!e)return void console.error("next_frame Video is null");const t=this._media_info.fps>0?this._media_info.fps:25;e.currentTime+=1/t}}resize(e,t){let r=this;if(!(e&&t&&r._media_info.w&&r._media_info.h))return console.error("resize width or height is null"),!1;const i=r._media_info.w,a=r._media_info.h;if(this._player_box.style.width=e+"px",this._player_box.style.height=t+"px",-1!==[n.CORE_TYPE_WEBCODEC_HEVC,n.CORE_TYPE_WASM_HEVC].indexOf(this._player_video_core)){let r=(e,t)=>{let r=i/e>a/t,n=(e/i).toFixed(2),s=(t/a).toFixed(2),o=r?n:s,l=parseInt(i*o,10),_=parseInt(a*o,10);return[parseInt((t-_)/2,10),parseInt((e-l)/2,10),l,_]},n=this._player_box.getElementsByTagName("canvas")[0],s=r(e,t);n.style.marginTop=s[0]+"px",n.style.marginLeft=s[1]+"px",n.style.width=s[2]+"px",n.style.height=s[3]+"px"}else{let r=this._player_box.getElementsByTagName("video")[0];r.style.width=e+"px",r.style.height=t+"px"}return!0}build(e={}){let t=this;if(!wasm_js_uri||!wasm_wasm_uri)return console.error("wasm_js_uri or wasm_wasm_uri is null"),!1;if(this._player_id=e.player_id||"h265web.js",!this._player_id)return console.error("canvas_id is null",this._player_id),!1;if(this._wasm_js_uri=e.wasm_js_uri||null,this._wasm_wasm_uri=e.wasm_wasm_uri||null,this._ext_src_js_uri=e.ext_src_js_uri||null,this._ext_wasm_js_uri=e.ext_wasm_js_uri||null,this._player_box=document.getElementById(t._player_id)||null,!this._player_box)return console.error("box is null"),!1;this._player_box.ondblclick=()=>{if(t._first_frame_render)try{t._isFullScreen()?t.closeFullScreen():t.fullScreen()}catch(e){console.error("full screen error:",e)}},this._player_color=e.color||"black",this._player_color&&(this._player_box.style.backgroundColor=this._player_color);{document.getElementById("debug-float-text")&&document.getElementById("debug-float-text").remove();const e=document.createElement("div");e.id="debug-float-text",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.transform="translate(-50%, -50%) rotate(-15deg)",e.style.fontSize="100px",e.style.color="rgba(0, 0, 0, 0.3)",e.style.fontFamily="monospace",e.style.zIndex="9997",e.style.pointerEvents="none",e.textContent="h265web.js",this._player_box.appendChild(e)}this._player_width="string"==typeof e.width&&"100%"===e.width?t._player_box.parentElement.offsetWidth:e.width||640,this._player_height="string"==typeof e.height&&"100%"===e.height?t._player_box.parentElement.offsetHeight:e.height||360,this._player_wanted_core=e.core||null,this._player_ignore_audio=e.ignore_audio||!1,this._format_type=e.format_type||null,this._protocol_type=e.protocol||null,this._wasm_demuxer_readframe_multi_times=e.readframe_multi_times||-1,this._enable_play_button=e.enable_play_button||!1,this._enable_play_button&&(this._play_button_id=this._player_id+"_play_button"),this._play_url=e.media_uri||null,this._auto_play=e.auto_play||!1,this._format_type||this._play_url&&(this._format_type=a.GetUriFormat(this._play_url),this._protocol_type=a.GetUriProtocol(this._play_url)),this._init_canvas_dom(),this._player_box.style.width=this._player_width+"px",this._player_box.style.height=this._player_height+"px";const r=()=>{t._player_wanted_core!==n.CORE_TYPE_WEBCODEC_HEVC||t._check_is_webcodec()||(t._player_wanted_core=null),t._player_wanted_core!==n.CORE_TYPE_WASM_HEVC||t._check_is_wasm()||(t._player_wanted_core=null),window.YLPlayerSupport,!0===window.YLPlayerSupport.wasm_hevc?(t._init_demuxer_worker(),t._demuxer_worker.postMessage({type:"init",payload:{wasm_js_uri:t._wasm_js_uri,wasm_wasm_uri:t._wasm_wasm_uri,media_uri:t._play_url,ignore_audio:t._player_ignore_audio,format_type:t._format_type,protocol:t._protocol_type,readframe_multi_times:t._wasm_demuxer_readframe_multi_times}}),t._init_main_thread_wasm()):console.error("unsupport webassembly")};return window.YLPlayerSupport?r():n.testCheckAllSupport().then((e=>{window.YLPlayerSupport=e,r()})),!0}_init_play_button(){let e=this;this._enable_play_button&&this._player_box&&(this._play_button=document.createElement("div"),this._play_button.id=this._play_button_id,this._play_button.style.position="absolute",this._play_button.style.left="50%",this._play_button.style.top="50%",this._play_button.style.transform="translate(-50%, -50%)",this._play_button.style.width="80px",this._play_button.style.height="80px",this._play_button.style.backgroundColor="rgba(0, 0, 0, 0.7)",this._play_button.style.borderRadius="15%",this._play_button.style.cursor="pointer",this._play_button.style.transition="all 0.3s",this._play_button.onmouseover=()=>{e._play_button.style.backgroundColor="rgba(0, 0, 0, 0.9)",e._play_button.style.transform="translate(-50%, -50%) scale(1.1)"},this._play_button.onmouseout=()=>{e._play_button.style.backgroundColor="rgba(0, 0, 0, 0.7)",e._play_button.style.transform="translate(-50%, -50%)"},this._player_box.style.position="relative",this._player_box.appendChild(this._play_button),this._play_icon=document.createElement("div"),this._play_icon.style.position="absolute",this._play_icon.style.left="50%",this._play_icon.style.top="50%",this._play_icon.style.transform="translate(-40%, -50%)",this._play_icon.style.width="0",this._play_icon.style.height="0",this._play_icon.style.borderTop="20px solid transparent",this._play_icon.style.borderBottom="20px solid transparent",this._play_icon.style.borderLeft="30px solid #fff",this._play_icon.style.display="none",this._play_icon.onclick=t=>{e.play()},this._play_button.appendChild(this._play_icon),this._pause_icon=document.createElement("div"),this._pause_icon.style.position="absolute",this._pause_icon.style.left="46%",this._pause_icon.style.top="50%",this._pause_icon.style.transform="translate(-40%, -50%)",this._pause_icon.style.width="30%",this._pause_icon.style.height="50%",this._pause_icon.style.borderLeft="4px solid #e9e9e9",this._pause_icon.style.borderRight="4px solid #e9e9e9",this._pause_icon.style.display="none",this._pause_icon.onclick=t=>{e.pause()},this._play_button.appendChild(this._pause_icon),this._auto_play?(this._play_button.style.display="none",this._player_box.onmouseleave=()=>{e._play_button.style.display="none"},this._player_box.onmouseover=()=>{e._play_button.style.display="block"}):(this._play_button.style.display="block",this._play_icon.style.display="block"))}_remove_play_button(){this._play_button_id&&this._player_box&&this._play_button&&(this._player_box.removeChild(this._play_button),this._play_button=null,this._play_icon=null,this._pause_icon=null)}_init_canvas_dom(){this._canvas_id=this._player_id+"_canvas",this._canvas||(this._canvas=document.createElement("canvas"),this._canvas.id=this._canvas_id,this._canvas.width=this._player_width,this._canvas.height=this._player_height,this._player_box.appendChild(this._canvas))}_remove_canvas_dom(){this._canvas&&this._player_box&&(this._player_box.removeChild(this._canvas),this._canvas=null)}async _init_main_thread_wasm(){let e=this;if("undefined"==typeof WebAssembly)return console.error("main thread WebAssembly is not supported"),!1;try{await new Promise((t=>{const r=document.createElement("script");r.src=e._wasm_js_uri,r.onload=()=>{t()},document.head.appendChild(r)}));const t=e._wasm_wasm_uri;if(e._wasm_main_thread_exports=await new Promise((e=>{const r=WasmModule({locateFile:e=>t,onRuntimeInitialized:()=>{e(r)}})})),!e._wasm_main_thread_exports)return console.error("main thread WebAssembly module initialized _this._wasm_main_thread_exports: False"),!1;e._wasm_main_thread_exports._main(),Object.keys(e._wasm_main_thread_exports)}catch(e){return console.error("main thread Failed to initialize WebAssembly:",e),!1}return!0}async load_past_core(e){let t=this;if("undefined"==typeof WebAssembly)return console.error("main thread WebAssembly is not supported"),!1;if(!t._ext_src_js_uri||!t._ext_wasm_js_uri)return console.error("main thread ext_src_js_uri or ext_wasm_js_uri is null"),!1;if(t._ext_h265webjs_loaded||window.STATIC_MEM_wasmDecoderState>0)return t._remove_canvas_dom(),e&&e(),!0;t._remove_canvas_dom();try{if(window)window.addEventListener("h265webjsWasmLoaded",(function(r){window.STATIC_MEM_wasmDecoderState=1,t._ext_h265webjs_loaded=!0,e&&e()}));else{if(!r)return console.error("main thread window or global is not defined"),!1;r.h265webjsWasmLoaded=()=>{event,r.STATIC_MEM_wasmDecoderState=1,t._ext_h265webjs_loaded=!0,e&&e()}}await new Promise((e=>{const r=document.createElement("script");r.src=t._ext_src_js_uri,r.onload=()=>{e()},document.head.appendChild(r)})),await new Promise((e=>{const r=document.createElement("script");r.src=t._ext_wasm_js_uri,r.onload=()=>{e()},document.head.appendChild(r)}))}catch(e){return console.error("main thread Failed to initialize WebAssembly:",e),!1}}change_media(e){let t=this;if(!e)return console.error("media_uri is null"),!1;this._play_url=null;const r={player_id:t._player_id,wasm_js_uri:t._wasm_js_uri,wasm_wasm_uri:t._wasm_wasm_uri,ext_src_js_uri:t._ext_src_js_uri,ext_wasm_js_uri:t._ext_wasm_js_uri,width:t._player_width,height:t._player_height,color:t._player_color,media_uri:null,core:t._player_wanted_core,ignore_audio:t._player_ignore_audio,format_type:t._format_type,protocol:t._protocol_type};return this.release((()=>{if(!t.build(r))return console.error("build failed"),!1;t.load_media(e)})),!0}rebuild(e=!1){let t=this;const r={player_id:t._player_id,wasm_js_uri:t._wasm_js_uri,wasm_wasm_uri:t._wasm_wasm_uri,ext_src_js_uri:t._ext_src_js_uri,ext_wasm_js_uri:t._ext_wasm_js_uri,width:t._player_width,height:t._player_height,color:t._player_color,media_uri:e?t._play_url:null,core:t._player_wanted_core,ignore_audio:t._player_ignore_audio,format_type:t._format_type,protocol:t._protocol_type,readframe_multi_times:t._wasm_demuxer_readframe_multi_times};return this.release((()=>{if(!t.build(r))return console.error("build failed"),!1})),!0}_release_demuxer(e){let t=this;this._wait_init_interval&&(clearInterval(this._wait_init_interval),this._wait_init_interval=null,this._on_inited=!1),this._demuxer_worker&&(this._demuxer_worker.onmessage=function(r){if("release_done"===r.data.type)t._demuxer_worker.terminate(),t._demuxer_worker=null,null===t._decoder_worker&&e&&e()},this._demuxer_worker.postMessage({type:"release"}))}release(e=null){let t=this;this.pause(),this._remove_play_button(),this._demuxer_worker,this._release_demuxer(e),this._decoder_worker,this._decoder_worker&&(this._decoder_worker.onmessage=function(r){if("release_done"===r.data.type)t._decoder_worker.terminate(),t._decoder_worker=null,null===t._demuxer_worker&&e&&e()},this._decoder_worker.postMessage({type:"release"})),this._workerFetch,void 0!==this._workerFetch&&null!==this._workerFetch&&(this._workerFetch.postMessage({cmd:"stop",params:"",type:this.mediaExtProtocol}),this._workerFetch.onmessage=null),this._workerParse,void 0!==this._workerParse&&null!==this._workerParse&&(this._workerParse.postMessage({cmd:"stop",params:""}),this._workerParse.onmessage=null),this._workerFetch=null,this._workerParse=null,this._audioAACCtx,this._audioAACCtx&&(this._audioAACCtx.pause(),this._audioAACCtx.stop(),this._audioAACCtx=null),this._audioWAVCtx,this._ext_h265webjs_core&&(this._ext_h265webjs_core.release(),this._ext_h265webjs_core=null,e&&e()),this._native_core,this._native_core&&(this._native_core.release(),this._native_core=null,e&&e()),this._canvas,this._remove_canvas_dom(),this._player_box=null,this._first_frame_render=!1,this._player_video_core=null,this._expect_play=!1,this._media_info={needSwr:0,duration:-1,demuxer_media_type:n.PLAYER_MODE_VOD,w:-1,h:-1,fps:-1,audioIndex:-1,sampleRate:-1,channel:-1,codec:-1,fmt:"",extra_data:null,extra_size:0},this._player_vlast_dts=-1,this._player_alast_dts=-1,this._player_playbackRate=1,this._player_voice=1,setTimeout((()=>{t.on_release_done_callback&&t.on_release_done_callback()}),500)}gpu_memory_info(){if(!this._decoder_worker)return console.error("gpu_memory_info _decoder_worker is null"),!1;this._decoder_worker.postMessage({type:"gpu_memory_info"})}_makeNativePlayer(){let e=this;e._remove_canvas_dom(),this._native_core=new c.Mp4Player({width:e._player_width,height:e._player_height,fixed:!1,playerId:e._player_id,audioNone:e._player_ignore_audio,autoPlay:e._auto_play}),this._native_core.makeIt(this._play_url),this._native_core.onPlayingTime=t=>{e._video_render_pts=1e3*t,e.on_play_time&&e.on_play_time(t)},this._native_core.onPlayingFinish=()=>{e.pause(),e.on_play_finished&&e.on_play_finished()},this._native_core.onLoadFinish=()=>{e._media_info.duration=1e3*e._native_core.duration;const t=e._native_core.getSize();e._media_info.w=t.width,e._media_info.h=t.height,e._media_info.demuxer_media_type=n.PLAYER_MODE_VOD,e.video_probe_callback&&e.video_probe_callback(e._media_info),e._first_frame_render=!0,e.on_ready_show_done_callback&&e.on_ready_show_done_callback(),e._init_play_button()},this._native_core.onPlayState=e=>{this._enable_play_button&&(this._play_button&&this._play_icon&&this._pause_icon?e?(this._play_icon.style.display="none",this._pause_icon.style.display="block"):(this._play_icon.style.display="block",this._pause_icon.style.display="none"):this._remove_play_button())},this._native_core.onCacheProcess=t=>{e.on_cache_process_callback&&e.on_cache_process_callback(t)},this._native_core.onSeekStart=t=>{e.on_seek_start_callback&&e.on_seek_start_callback(t)},this._native_core.onSeekFinish=t=>{e.on_seek_done_callback&&e.on_seek_done_callback(t),e._expect_play&&e._native_core.play()}}_flvJsPlayer(e=-1,t=!1){let r=this;r._remove_canvas_dom();let i={width:r._player_width,height:r._player_height,playerId:r._player_id,ignoreAudio:r._player_ignore_audio?1:0,duration:e,autoPlay:r._auto_play,audioNone:r._player_ignore_audio?1:0};this._native_core=new h.NvFlvjsCore(i),this._native_core.onLoadFinish=()=>{!r._native_core.duration||NaN===r._native_core.duration||r._native_core.duration===1/0||r._native_core.duration<0?(r._media_info.duration=-1,r._media_info.demuxer_media_type=n.PLAYER_MODE_NOTIME_LIVE):(r._media_info.duration=1e3*r._native_core.duration,r._media_info.demuxer_media_type=n.PLAYER_MODE_VOD);const e=r._native_core.getSize();r._media_info.w=e.width,r._media_info.h=e.height,r.video_probe_callback&&r.video_probe_callback(r._media_info)},this._native_core.onReadyShowDone=()=>{r._first_frame_render=!0,r.on_ready_show_done_callback&&r.on_ready_show_done_callback(),r._init_play_button()},this._native_core.onPlayingTime=e=>{r._video_render_pts=1e3*e,r.on_play_time&&r.on_play_time(e)},this._native_core.onPlayingFinish=()=>{r.pause(),r.on_play_finished&&r.on_play_finished()},this._native_core.onPlayState=e=>{this._enable_play_button&&(this._play_button&&this._play_icon&&this._pause_icon?e?(this._play_icon.style.display="none",this._pause_icon.style.display="block"):(this._play_icon.style.display="block",this._pause_icon.style.display="none"):this._remove_play_button())},this._native_core.onCacheProcess=e=>{r.on_cache_process_callback&&r.on_cache_process_callback(e)},this._native_core.onSeekStart=e=>{r.on_seek_start_callback&&r.on_seek_start_callback(e)},this._native_core.onSeekFinish=e=>{r.on_seek_done_callback&&r.on_seek_done_callback(e),r._expect_play&&r._native_core.play()},this._native_core.makeIt(this._play_url)}_check_already_load_media(){if(!this._player_box){if(!document.getElementById(this._player_id))return console.error("player_box is null"),!1;this._player_box=document.getElementById(this._player_id)}if(-1!==[n.CORE_TYPE_WEBCODEC_HEVC,n.CORE_TYPE_WASM_HEVC].indexOf(this._player_video_core)){return!!this._player_box.getElementsByTagName("canvas")[0]&&this._first_frame_render}return!!this._player_box.getElementsByTagName("video")[0]}load_media(e){let t=this;if(!e)return console.error("media_uri is null"),!1;if(this._check_already_load_media())return console.error("load_media already load media, release first"),this.change_media(e),!0;this._play_url=e,this._format_type||this._play_url&&(this._format_type=a.GetUriFormat(this._play_url),this._protocol_type=a.GetUriProtocol(this._play_url)),this._format_type,this._protocol_type;const r=function(){if(-1!==["flv"].indexOf(t._format_type)&&!t._check_is_webcodec()&&!t._check_is_wasm())return setTimeout((()=>{t._release_demuxer(),t._player_video_core=n.CORE_TYPE_MSE_FLVJS,t._flvJsPlayer()}),500),!0;-1!==["mp4"].indexOf(t._format_type)&&t._check_is_mse()?setTimeout((()=>{t._release_demuxer(),t._player_video_core=n.CORE_TYPE_MSE_MP4,t._makeNativePlayer()}),500):-1!==["m3u8","hls"].indexOf(t._format_type)?setTimeout((()=>{t._release_demuxer(),t._player_video_core=n.CORE_TYPE_EXT_H265WEB,t.load_past_core((()=>{t.do_ext_h265web_media()}))}),500):-1!==["raw265"].indexOf(t._format_type)?(t._player_wanted_core=n.CORE_TYPE_WASM_HEVC,t._player_ignore_audio=!0,t._format_type,t._protocol_type,t._player_wanted_core,t._demuxer_worker||(console.error("demux _demuxer_worker is null"),t._init_demuxer_worker()),t._demuxer_worker.postMessage({type:"loadMedia",payload:{media_uri:e,format_type:t._format_type,protocol:t._protocol_type}})):(t._demuxer_worker||(console.error("demux _demuxer_worker is null"),t._init_demuxer_worker()),t._demuxer_worker.postMessage({type:"loadMedia",payload:{media_uri:e,format_type:t._format_type,protocol:t._protocol_type}}))};if(t._on_inited)r();else{const e=document.getElementById("debug-float-text");e.textContent="LOADING...";let i=0;t._wait_init_interval=setInterval((()=>t._on_inited?(e.textContent="h265web.js-pro",r(),clearInterval(t._wait_init_interval),void(t._wait_init_interval=null)):(i+=1,i>1500?(console.error("wait init WebAssembly interval timeout"),clearInterval(t._wait_init_interval),void(t._wait_init_interval=null)):void 0)),200)}return!0}do_ext_h265web_media(){let e=this;const t={player:e._player_id,width:e._player_width,height:e._player_height,token:"base64:QXV0aG9yOmNoYW5neWFubG9uZ3xudW1iZXJ3b2xmLEdpdGh1YjpodHRwczovL2dpdGh1Yi5jb20vbnVtYmVyd29sZixFbWFpbDpwb3JzY2hlZ3QyM0Bmb3htYWlsLmNvbSxRUTo1MzEzNjU4NzIsSG9tZVBhZ2U6aHR0cDovL3h2aWRlby52aWRlbyxEaXNjb3JkOm51bWJlcndvbGYjODY5NCx3ZWNoYXI6bnVtYmVyd29sZjExLEJlaWppbmcsV29ya0luOkJhaWR1",extInfo:{probeSize:8192,ignoreAudio:e._player_ignore_audio?1:0,coreProbePart:.1,autoPlay:e._auto_play,cacheLength:50,rawFps:24}};e._ext_h265webjs_core&&(e._ext_h265webjs_core.release(),e._ext_h265webjs_core=null),e._ext_h265webjs_core=window.new265webjs(e._play_url,t),e._ext_h265webjs_core.onSeekStart=t=>{e.on_seek_start_callback&&e.on_seek_start_callback(t)},e._ext_h265webjs_core.onSeekFinish=()=>{e.on_seek_done_callback&&e.on_seek_done_callback()},e._ext_h265webjs_core.onPlayFinish=()=>{e.on_play_finished&&e.on_play_finished()},e._ext_h265webjs_core.on_open_fullscreen=()=>{},e._ext_h265webjs_core.on_close_fullscreen=()=>{},e._ext_h265webjs_core.onLoadCache=()=>{e.on_load_caching_callback&&e.on_load_caching_callback()},e._ext_h265webjs_core.onLoadCacheFinshed=()=>{e.on_finish_cache_callback&&e.on_finish_cache_callback()},e._ext_h265webjs_core.onReadyShowDone=()=>{e._first_frame_render=!0,e.on_ready_show_done_callback&&e.on_ready_show_done_callback(),e._init_play_button()},e._ext_h265webjs_core.onLoadFinish=()=>{e._ext_h265webjs_core.setVoice(1);const t=e._ext_h265webjs_core.mediaInfo();let r=i.V_CODEC_NAME_HEVC;!1===t.meta.isHEVC&&(r=i.V_CODEC_NAME_AVC),e._media_info.codec=r,e._media_info.fps=t.meta.fps||-1,e._media_info.w=t.meta.size.width||-1,e._media_info.h=t.meta.size.height||-1,e._media_info.sampleRate=t.meta.sampleRate||-1,e._format_type||e._play_url&&(e._format_type=a.GetUriFormat(e._play_url),e._protocol_type=a.GetUriProtocol(e._play_url)),e._media_info.media_fmt=e._format_type,e._media_info.duration=t.meta.durationMs/1e3||-1,"vod"==t.videoType?e._media_info.demuxer_media_type=n.PLAYER_MODE_VOD:e._media_info.demuxer_media_type=n.PLAYER_MODE_LIVE,e._media_info,e.video_probe_callback&&e.video_probe_callback(e._media_info)},e._ext_h265webjs_core.onCacheProcess=t=>{e.on_cache_process&&e.on_cache_process(t)},e._ext_h265webjs_core.onPlayTime=t=>{e.on_play_time&&e.on_play_time(t)},e._ext_h265webjs_core.do()}cache_demux(e=1,t=1){if(-1!==["raw265"].indexOf(this._format_type));else{if(!this._demuxer_worker)return!1;this._demuxer_worker.postMessage({type:"demux",payload:{recv_v_count:e,recv_a_count:t}})}return!0}get_nalu_len(){if(!this._decoder_worker)return console.error("get_tex_len _decoder_worker is null"),!1;this._decoder_worker.postMessage({type:"get_nalu_len"})}get_tex_len(){if(!this._decoder_worker)return console.error("get_tex_len _decoder_worker is null"),!1;this._decoder_worker.postMessage({type:"get_tex_len"})}render_tex(){this._player_video_core,this._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC?this._decoder_worker&&this._decoder_worker.postMessage({type:"render_tex"}):this._player_video_core===n.CORE_TYPE_WASM_HEVC?this._opengl_render&&this._opengl_render.render_yuv420p_texture():this._decoder_worker&&this._decoder_worker.postMessage({type:"render_tex"})}audio_play(){return!!this._player_ignore_audio||(this._audioAACCtx?(this._audioAACCtx.play(),!0):(console.error("audio ctx is null"),!1))}audio_pause(){return!!this._player_ignore_audio||(this._audioAACCtx?(this._audioAACCtx.pause(),!0):(console.error("audio ctx is null"),!1))}get_audio_pts(){return this._player_ignore_audio?-1:this._audioAACCtx?{pts:this._audioAACCtx.getTimestamp(),duration:this._audioAACCtx.getTimestampDurMs()}:(console.error("get_audio_pts _audioAACCtx is null"),-2)}set_mute(){this.set_voice(0)}set_voice(e=1){if(this._player_voice=e,-1===[n.CORE_TYPE_MSE_MP4,n.CORE_TYPE_MSE_FLVJS].indexOf(this._player_video_core))return this._player_video_core===n.CORE_TYPE_EXT_H265WEB?(this._ext_h265webjs_core&&this._ext_h265webjs_core.setVoice(e),0):void(this._player_video_core===n.CORE_TYPE_WASM_HEVC||this._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC?this._audioAACCtx&&this._audioAACCtx.setVoice(e):(this._player_video_core,n.CORE_TYPE_MSE_HEVC));this._native_core&&this._native_core.setVoice(e)}set_playback_rate(e=1){if(this._player_playbackRate=e,-1===[n.CORE_TYPE_MSE_MP4,n.CORE_TYPE_MSE_FLVJS].indexOf(this._player_video_core)){if(this._player_video_core===n.CORE_TYPE_EXT_H265WEB)return this._ext_h265webjs_core&&this._ext_h265webjs_core.setPlaybackRate(e),0;this._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC?this._decoder_worker&&this._decoder_worker.postMessage({type:"set_playback_rate",payload:{playback_rate:e}}):this._player_video_core===n.CORE_TYPE_WASM_HEVC?this._opengl_render&&this._opengl_render.set_playback_rate(e):this._player_video_core===n.CORE_TYPE_MSE_HEVC||this._decoder_worker&&this._decoder_worker.postMessage({type:"set_playback_rate",payload:{playback_rate:e}}),this._audioAACCtx&&this._audioAACCtx.setPlaybackRate(this._player_playbackRate)}else this._native_core&&this._native_core.setPlaybackRate(e)}play(e=!0){let t=this;if(this.chase_frame_count=0,this._expect_play=e,this._enable_play_button&&(this._play_button&&this._play_icon&&this._pause_icon?(this._play_icon.style.display="none",this._pause_icon.style.display="block",this._player_box.onmouseleave=()=>{t._play_button.style.display="none"},this._player_box.onmouseover=()=>{t._play_button.style.display="block"}):this._remove_play_button()),-1!==[n.CORE_TYPE_MSE_MP4,n.CORE_TYPE_MSE_FLVJS].indexOf(this._player_video_core))return void(this._video_render_pts>=this._media_info.duration-100?this._native_core&&this._native_core.seek(0):this._native_core&&this._native_core.play());if(this._player_video_core===n.CORE_TYPE_EXT_H265WEB)return void(this._ext_h265webjs_core&&this._ext_h265webjs_core.play());if(t._media_info.demuxer_media_type==n.PLAYER_MODE_VOD&&t._player_vlast_dts>0&&t._player_vlast_dts<=t._video_render_pts)return t._player_vlast_dts,t._video_render_pts,t._video_render_pts=0,void t.seek(0);const r=t._media_info.fps<=0?30:t._media_info.fps,i=Math.floor(1e3/r);if(this._audioAACCtx&&this._audioAACCtx.check_with_video_pts_ms(this._video_render_pts),t._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC)this.audio_play(),this._decoder_worker&&this._decoder_worker.postMessage({type:"render_play",payload:{fps:r,frame_duraiton:i}});else if(this._player_video_core===n.CORE_TYPE_WASM_HEVC){if(this._opengl_render.is_playing())return;this.audio_play(),this._opengl_render&&this._opengl_render.render_play(r,i,t._player_ignore_audio)}else this._player_video_core===n.CORE_TYPE_MSE_HEVC||(this.audio_play(),this._decoder_worker&&this._decoder_worker.postMessage({type:"render_play",payload:{fps:r,frame_duraiton:i}}))}pause(){this._expect_play=!1,this._enable_play_button&&(this._play_button&&this._play_icon&&this._pause_icon?(this._play_button.style.display="block",this._play_icon.style.display="block",this._pause_icon.style.display="none",this._player_box.onmouseleave=()=>{},this._player_box.onmouseover=()=>{}):this._remove_play_button()),-1===[n.CORE_TYPE_MSE_MP4,n.CORE_TYPE_MSE_FLVJS].indexOf(this._player_video_core)?this._player_video_core!==n.CORE_TYPE_EXT_H265WEB?this.av_pause():this._ext_h265webjs_core&&this._ext_h265webjs_core.pause():this._native_core&&this._native_core.pause()}seek(e=-1){return this._media_info.demuxer_media_type===n.PLAYER_MODE_NOTIME_LIVE?(console.error("ylplayer seek live media type not support"),-1):e<0?-1:-1!==[n.CORE_TYPE_MSE_MP4,n.CORE_TYPE_MSE_FLVJS].indexOf(this._player_video_core)?(this._native_core,this._native_core&&this._native_core.seek(e),0):this._player_video_core===n.CORE_TYPE_EXT_H265WEB?(this._ext_h265webjs_core&&this._ext_h265webjs_core.seek(e),0):(this.on_seek_start_callback&&this.on_seek_start_callback(e),this.av_pause(),this.stop_and_clean_cache(),this._demuxer_worker.postMessage({type:"seek_demux",payload:{seekTime:e}}),0)}stop_and_clean_cache(){this._demuxer_worker?(this._demuxer_worker.postMessage({type:"stop_cache_pkt_to_decoder"}),this._audioAACCtx&&this._audioAACCtx.cleanQueue(),this._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC?this._decoder_worker&&this._decoder_worker.postMessage({type:"clean_cache_queue"}):this._player_video_core===n.CORE_TYPE_WASM_HEVC?(this._decoder_worker&&this._decoder_worker.postMessage({type:"clean_cache_queue"}),this._decoder_worker&&this._decoder_worker.postMessage({type:"set_cache_size",payload:{cache_size:0}}),this._opengl_render&&this._opengl_render.clean_cache_queue()):(this._player_video_core,n.CORE_TYPE_MSE_HEVC)):console.error("stop_and_clean_cache _demuxer_worker is null")}av_pause(){if(this.audio_pause(),this._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC){if(!this._decoder_worker)return console.error("render decoder_worker is null"),!1;this._decoder_worker.postMessage({type:"render_pause"})}else this._player_video_core===n.CORE_TYPE_WASM_HEVC?this._opengl_render&&this._opengl_render.render_pause():(this._player_video_core,n.CORE_TYPE_MSE_HEVC)}_init_audio_aac_ctx(e=44100,t=i.APPEND_TYPE_FRAME){let r=this;return!r._player_ignore_audio&&(!this._audioAACCtx&&(r._media_info,r._media_info.needSwr?(r._audioAACCtx=o(),r._audioAACCtx.isLIVE=!0):(r._audioAACCtx=new s({sampleRate:e<=0?44100:e,appendType:t}),r._audioAACCtx.isLIVE=!0,r._audioAACCtx.build()),this._audioAACCtx,r._audioAACCtx.onPlayCallback=function(e){const t=1e3*e;r.audio_render_callback&&r.audio_render_callback(t),r._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC?r._decoder_worker.postMessage({type:"audio_play_info",payload:{pts:t,duration:r._audioAACCtx.getTimestampDurMs()}}):r._player_video_core===n.CORE_TYPE_WASM_HEVC?r._opengl_render&&r._opengl_render.audio_play_info(t,r._audioAACCtx.getTimestampDurMs()):(r._player_video_core,n.CORE_TYPE_MSE_HEVC)},!0))}_checkScreenDisplayAspectSize(e,t,r,i){let a=r/e>i/t,n=(e/r).toFixed(2),s=(t/i).toFixed(2),o=a?n:s,l=this.fixed?e:parseInt(r*o),_=this.fixed?t:parseInt(i*o);return[parseInt((t-_)/2),parseInt((e-l)/2),l,_]}_auto_adaptive_screen(e,t,r,i){let a=this;a._canvas||(console.error("_auto_adaptive_screen _canvas is null"),this._init_canvas_dom()),a._canvas.width=r,a._canvas.height=i;let n=this._checkScreenDisplayAspectSize(e,t,r,i);return a._canvas.style.marginTop=n[0]+"px",a._canvas.style.marginLeft=n[1]+"px",a._canvas.style.width=n[2]+"px",a._canvas.style.height=n[3]+"px",!0}_check_is_mse(){let e=this;return!e._player_wanted_core&&!0===window.YLPlayerSupport.mse_hevc||null===window.YLPlayerSupport.mse_hevc||e._player_wanted_core&&e._player_wanted_core===n.CORE_TYPE_MSE_HEVC}_check_is_wasm(){let e=this;return!1!==window.YLPlayerSupport.wasm_hevc&&(!e._player_wanted_core&&!0===window.YLPlayerSupport.wasm_hevc||null===window.YLPlayerSupport.wasm_hevc||e._player_wanted_core&&e._player_wanted_core===n.CORE_TYPE_WASM_HEVC)}_check_is_webcodec(){let e=this;return!1!==window.YLPlayerSupport.webcodec_hevc&&(!e._player_wanted_core&&!0===window.YLPlayerSupport.webcodec_hevc||null===window.YLPlayerSupport.webcodec_hevc||e._player_wanted_core&&e._player_wanted_core===n.CORE_TYPE_WEBCODEC_HEVC)}_init_demuxer_worker(){let e=this;if(this._demuxer_worker)return;this._demuxer_worker=l();let t=0,r=0;this._player_vlast_dts=-1,this._player_alast_dts=-1,this._demuxer_worker.onmessage=function(a){switch(a.data.type){case"ready":e._on_inited=!0;break;case"reload_page":location.reload();break;case"alert_page":alert(a.data.payload);break;case"demuxer_probe_cb":if(a.data.payload,e._player_wanted_core,e._media_info=a.data.payload,null!=e._format_type&&""!=e._format_type||(e._format_type=a.data.payload.media_fmt),e._media_info.codec==i.V_CODEC_NAME_AVC)return console.error("unsupport codec 264, to mse"),-1!==["flv"].indexOf(e._format_type)?(e._release_demuxer(),e._player_video_core=n.CORE_TYPE_MSE_FLVJS,e._flvJsPlayer(),!0):void(-1!==["mp4"].indexOf(this._format_type)&&this._check_is_mse()&&(this._release_demuxer(),this._player_video_core=n.CORE_TYPE_MSE_MP4,this._makeNativePlayer()));const s=a.data.payload.sampleRate;if(e._init_audio_aac_ctx(s,i.APPEND_TYPE_FRAME),e._auto_adaptive_screen(e._player_width,e._player_height,e._media_info.w,e._media_info.h),(s<=0||""==e._media_info.fmt)&&(e._player_ignore_audio=!0),e._check_is_webcodec())e._player_video_core=n.CORE_TYPE_WEBCODEC_HEVC,e._init_decoder_worker(),e._decoder_worker.postMessage({type:"init",payload:{wasm_js_uri:e._wasm_js_uri,wasm_wasm_uri:e._wasm_wasm_uri,ignore_audio:e._player_ignore_audio}}),e.video_probe_callback&&e.video_probe_callback(a.data.payload),e._decoder_worker.postMessage({type:"probe_ok",payload:a.data.payload});else if(e._check_is_wasm())e._player_video_core=n.CORE_TYPE_WASM_HEVC,e._init_ffdecoder_worker(),e._decoder_worker.postMessage({type:"init",payload:{wasm_js_uri:e._wasm_js_uri,wasm_wasm_uri:e._wasm_wasm_uri,ignore_audio:e._player_ignore_audio}}),e.video_probe_callback&&e.video_probe_callback(a.data.payload),-1!==["raw265"].indexOf(e._format_type)?(e._raw265Entry(),e._release_demuxer()):e._decoder_worker.postMessage({type:"probe_ok",payload:a.data.payload});else{if(!e._check_is_mse())return void console.error("the media can not support play",a.data.payload);e._player_video_core=n.CORE_TYPE_MSE_HEVC}break;case"demuxer_nalu_cb":a.data.payload.nalu,a.data.payload.pts,a.data.payload.dts,e._decoder_worker.postMessage({type:"demuxer_nalu_cb",payload:a.data.payload}),e.video_nalu_callback&&e.video_nalu_callback(a.data.payload.pts,a.data.payload.dts),e.on_cache_process_callback&&e.on_cache_process_callback(a.data.payload.dts);break;case"demuxer_aac_cb":if(e._audioAACCtx){const t={pts:a.data.payload.pts,data:a.data.payload.nalu};e._audioAACCtx.addSample(t),e.audio_frame_callback&&e.audio_frame_callback(a.data.payload.pts,e._audioAACCtx.getSampleQueueLen())}break;case"demuxer_extradata_cb":break;case"demuxer_vod_nalu_done":const o=a.data.payload.v_last_dts,l=a.data.payload.a_last_dts;e._player_vlast_dts=o,e._player_alast_dts=l;break;case"fetch-done":if(a.data.payload&&a.data.payload.is_complete)return a.data.payload.is_complete,t=0,void(e._player_video_core!==n.CORE_TYPE_WASM_HEVC&&e._player_video_core!==n.CORE_TYPE_WEBCODEC_HEVC||e._decoder_worker.postMessage({type:"fetch-done",payload:{}}));e.av_pause(),t<10?(e._demuxer_worker.postMessage({type:"retry_load_media"}),t++):t=0;break;case"fetch-error":console.error("Worker fetch-error, but not support yet"),t<10?(e.av_pause(),e._demuxer_worker.postMessage({type:"retry_load_media"}),t++):t=0;break;case"fetch-response-error":console.error("Worker fetch-response-error, but not support yet"),t<10?(e.av_pause(),e._demuxer_worker.postMessage({type:"retry_load_media"}),t++):t=0;break;case"fetch-retry-response-ok":!0===e._expect_play&&e.play();break;case"restart-load-media":r<10?(e.change_media(e._play_url),r++):(e.rebuild(),r=0);break;case"ready_seek_demux":const _=a.data.payload.seekTime;e._player_video_core===n.CORE_TYPE_WEBCODEC_HEVC||e._player_video_core===n.CORE_TYPE_WASM_HEVC?e._decoder_worker&&e._decoder_worker.postMessage({type:"seek_decode",payload:{seekTime:_}}):e._player_video_core===n.CORE_TYPE_MSE_HEVC||e._decoder_worker&&e._decoder_worker.postMessage({type:"seek_decode",payload:{seekTime:_}});break;case"error":console.error("Worker error:",a.data.payload)}}}_init_decoder_worker(){let e=this;this._decoder_worker||(this._decoder_worker=_(),this._decoder_worker.onmessage=function(t){switch(t.data.type){case"ready":e._canvas_id,e._init_canvas_dom();const r=e._canvas.transferControlToOffscreen();e._decoder_worker.postMessage({type:"canvas",payload:{offscreen:r,canvas_id:e._canvas_id,extra_data:e._media_info.extra_data,extra_size:e._media_info.extra_size,width:e._media_info.w,height:e._media_info.h}},[r]);break;case"reload_page":location.reload();break;case"alert_page":alert(t.data.payload);break;case"error":console.error("decoder worker error:",t.data.payload);break;case"decode_video_progress":e._first_frame_render||(e.render_tex(),e._first_frame_render=!0,e.on_ready_show_done_callback&&e.on_ready_show_done_callback(),e._init_play_button(),e._audioAACCtx&&e._audioAACCtx.check_with_video_pts_ms(t.data.payload.pts),e._auto_play&&(e.set_mute(),setTimeout((()=>{e.play()}),30))),e.video_frame_callback&&e.video_frame_callback(t.data.payload.pts,t.data.payload.width,t.data.payload.height,t.data.payload.cache_size);break;case"render_progress":t.data.payload.pts,t.data.payload.width,t.data.payload.height,e._video_render_pts=t.data.payload.pts,e.video_render_callback&&e.video_render_callback(e._video_render_pts,t.data.payload.width,t.data.payload.height),e.on_play_time&&(e._audioAACCtx?e.on_play_time(Math.max(e._video_render_pts,e._audioAACCtx?e._audioAACCtx.getTimestampMs():0)/1e3):e.on_play_time(e._video_render_pts/1e3)),e._media_info.demuxer_media_type==n.PLAYER_MODE_VOD&&e._player_vlast_dts>0&&e._player_vlast_dts<=e._video_render_pts&&(e._player_vlast_dts,e._video_render_pts,e.pause(),e.on_play_finished&&e.on_play_finished());break;case"request_demux":e.cache_demux(t.data.payload.recv_v_count,t.data.payload.recv_a_count),e.request_pkt_callback&&e.request_pkt_callback(t.data.payload.recv_v_count,t.data.payload.recv_a_count);break;case"get_nalu_len_result":e.nalu_length_callback&&e.nalu_length_callback(t.data.payload);break;case"get_tex_len_result":e.tex_length_callback&&e.tex_length_callback(t.data.payload);break;case"gpu_memory_info_result":t.data.payload,e.gpu_info_callback&&e.gpu_info_callback(t.data.payload);break;case"on_load_cache":e.on_load_caching_callback&&e.on_load_caching_callback(t.data.payload),e.av_pause();break;case"on_finish_cache":e.on_finish_cache_callback&&e.on_finish_cache_callback(t.data.payload),e._expect_play&&e.play();break;case"av_align_audio_slower_too_much":e._audioAACCtx&&(e.av_pause(),e._audioAACCtx&&e._audioAACCtx.check_with_video_pts_ms(e._video_render_pts),e.play());break;case"av_align_audio_faster_too_much":e._audioAACCtx&&e.av_pause();break;case"av_align_finished":e._expect_play&&e.play();break;case"seek_success_target":t.data.payload,e._expect_play,e.on_seek_done_callback&&e.on_seek_done_callback(t.data.payload),e._expect_play?e.play():e.render_tex()}})}_init_ffdecoder_worker(){let e=this;if(this._decoder_worker)return;this._decoder_worker=d();const t=function(t){switch(t.type){case"render_progress":t.payload;const r=t.payload.pts;e._video_render_pts=r,e.video_render_callback&&e.video_render_callback(r,t.payload.width,t.payload.height),e.on_play_time&&(e._audioAACCtx?e.on_play_time(Math.max(e._video_render_pts,e._audioAACCtx?e._audioAACCtx.getTimestampMs():0)/1e3):e.on_play_time(e._video_render_pts/1e3)),e._media_info.demuxer_media_type==n.PLAYER_MODE_VOD&&e._player_vlast_dts>0&&e._player_vlast_dts<=e._video_render_pts&&(e._player_vlast_dts,e._video_render_pts,e.pause(),e.on_play_finished&&e.on_play_finished()),e._decoder_worker.postMessage({type:"set_cache_size",payload:{cache_size:t.payload.cache_size}});break;case"set_cache_size":e._decoder_worker.postMessage({type:"set_cache_size",payload:{cache_size:t.payload.cache_size}});break;case"av_align_audio_slower_too_much":e._audioAACCtx&&(e.av_pause(),e._audioAACCtx&&e._audioAACCtx.check_with_video_pts_ms(e._video_render_pts),e.play());break;case"av_align_audio_faster_too_much":e._audioAACCtx&&(e.av_pause(),e._opengl_render&&e._opengl_render.check_with_audio_pts_ms(e._audioAACCtx.getTimestampMs(),(()=>{e.play()})))}};this._decoder_worker.onmessage=function(r){switch(r.data.type){case"ready":e._decoder_worker.postMessage({type:"set_video_decoder",payload:{codec:e._media_info.codec,width:e._media_info.w,height:e._media_info.h,extra_data:e._media_info.extra_data,extra_size:e._media_info.extra_size}}),e._init_canvas_dom(),e._opengl_render=new u(e._wasm_main_thread_exports),e._opengl_render.event_data_callback=t,e._opengl_render.init(e._media_info.w,e._media_info.h,e._media_info.w,e._media_info.h,e._canvas_id);break;case"reload_page":location.reload();break;case"alert_page":alert(r.data.payload);break;case"error":console.error("decoder_worker error:",r.data.payload);break;case"decode_video_progress":const i=e._opengl_render.append_yuv420p_texture(r.data.payload.y_data,r.data.payload.u_data,r.data.payload.v_data,r.data.payload.width,r.data.payload.height,r.data.payload.y_linesize,r.data.payload.u_linesize,r.data.payload.v_linesize,r.data.payload.pts);i>0&&e._decoder_worker.postMessage({type:"set_cache_size",payload:{cache_size:i}}),e._first_frame_render||(e.render_tex(),e._first_frame_render=!0,e.on_ready_show_done_callback&&e.on_ready_show_done_callback(),e._init_play_button(),e._audioAACCtx&&e._audioAACCtx.check_with_video_pts_ms(r.data.payload.pts),e._auto_play&&(e.set_mute(),setTimeout((()=>{e.play()}),30))),e.video_frame_callback&&e.video_frame_callback(r.data.payload.pts,r.data.payload.width,r.data.payload.height,i);break;case"request_demux":e.cache_demux(r.data.payload.recv_v_count,r.data.payload.recv_a_count),e.request_pkt_callback&&e.request_pkt_callback(r.data.payload.recv_v_count,r.data.payload.recv_a_count);break;case"get_nalu_len_result":e.nalu_length_callback&&e.nalu_length_callback(r.data.payload);break;case"get_tex_len_result":e.tex_length_callback&&e.tex_length_callback(r.data.payload);break;case"gpu_memory_info_result":r.data.payload,e.gpu_info_callback&&e.gpu_info_callback(r.data.payload);break;case"on_load_cache":e.on_load_caching_callback&&e.on_load_caching_callback(r.data.payload),e.av_pause();break;case"on_finish_cache":e.on_finish_cache_callback&&e.on_finish_cache_callback(r.data.payload),e._expect_play&&e.play();break;case"seek_success_target":r.data.payload,e.on_seek_done_callback&&e.on_seek_done_callback(r.data.payload),e._expect_play?e.play():e.render_tex()}}}append265NaluFrame(e,t){this._decoder_worker&&this._decoder_worker.postMessage({type:"demuxer_nalu_cb",payload:{nalu:e,pts:t,dts:t,w:this._media_info.w,h:this._media_info.h,isKey:!0}})}_raw265Entry(){let e=this;this.videoURL,e._decoder_worker&&e._decoder_worker.postMessage({type:"probe_ok",payload:{w:e._media_info.w,h:e._media_info.h}});let t=0,r=parseInt(1/e._media_info.fps*1e3),i=function(){setTimeout((()=>{e._workerParse.postMessage({cmd:"get-nalu",data:null,msg:"get-nalu"}),e._workerParse.parseEmpty,e._workerFetch.onMsgFetchFinished,!0===e._workerFetch.onMsgFetchFinished&&!0===e._workerParse.frameListEmpty&&!1===e._workerParse.streamEmpty&&e._workerParse.postMessage({cmd:"last-nalu",data:null,msg:"last-nalu"}),!0===e._workerParse.parseEmpty&&(e._workerParse.stopNaluInterval=!0),!0!==e._workerParse.stopNaluInterval&&i()}),1e3)};e._workerFetch=new Worker(a.GetScriptPath((function(){let e=new AbortController,t=e.signal,r=null;onmessage=i=>{let a=i.data,n=null;switch(n=void 0===a.cmd||null===a.cmd?"":a.cmd,n){case"start":let i=a.url;"http"===a.type?function(e){let r=!1,i=!1;i||(i=!0,fetch(e,{signal:t}).then((function(e){let t=function(e){return e.read().then((function(i){if(i.done)return r=!0,void postMessage({cmd:"fetch-fin",data:null,msg:"fetch-fin"});let a=i.value;return postMessage({cmd:"fetch-chunk",data:a,msg:"fetch-chunk"}),t(e)}))};return t(e.body.getReader())})).catch((function(e){})))}(i):"websocket"===a.type&&(r=new WebSocket(i),r.binaryType="arraybuffer",r.onopen=function(e){r.send("Hello WebSockets!")},r.onmessage=function(e){if(e.data instanceof ArrayBuffer){var t=e.data;t.byteLength>0&&postMessage({cmd:"fetch-chunk",data:new Uint8Array(t),msg:"fetch-chunk"})}},r.onclose=function(e){postMessage({cmd:"fetch-fin",data:null,msg:"fetch-fin"})}),postMessage({cmd:"default",data:"WORKER STARTED",msg:"default"});break;case"stop":"http"===a.type?e.abort():"websocket"===a.type&&r&&r.close(),close()}}}))),e._workerFetch.onMsgFetchFinished=!1,e._workerFetch.onmessage=function(t){let r=t.data,a=null;switch(a=void 0===r.cmd||null===r.cmd?"":r.cmd,a){case"fetch-chunk":let t=r.data;e._workerParse.postMessage({cmd:"append-chunk",data:t,msg:"append-chunk"});break;case"fetch-fin":e._workerFetch.onMsgFetchFinished=!0,i()}},e._workerParse=new Worker(a.GetScriptPath((function(){let e=function(){let e=new Object;return e.frameList=[],e.stream=null,e.frameListEmpty=function(){return e.frameList.length<=0},e.streamEmpty=function(){return null===e.stream||e.stream.length<=0},e.checkEmpty=function(){return!0===e.streamEmpty()&&!0===e.frameListEmpty()||(e.stream,e.frameList,!1)},e.pushFrameRet=function(t){return!(!t||null==t||null==t||(e.frameList&&null!=e.frameList&&null!=e.frameList||(e.frameList=[]),e.frameList.push(t),0))},e.nextFrame=function(){return!e.frameList&&null==e.frameList||null==e.frameList&&e.frameList.length<1?null:e.frameList.shift()},e.clearFrameRet=function(){e.frameList=null},e.setStreamRet=function(t){e.stream=t},e.getStreamRet=function(){return e.stream},e.appendStreamRet=function(t){if(!t||void 0===t||null==t)return!1;if(!e.stream||void 0===e.stream||null==e.stream)return e.stream=t,!0;let r=e.stream.length,i=t.length,a=new Uint8Array(r+i);a.set(e.stream,0),a.set(t,r),e.stream=a;for(let t=0;t<9999;t++){let t=e.nextNalu();if(!1===t||null==t)break;e.frameList.push(t)}return!0},e.subBuf=function(t,r){let i=new Uint8Array(e.stream.subarray(t,r+1));return e.stream=new Uint8Array(e.stream.subarray(r+1)),i},e.lastNalu=function(){const t=e.subBuf(0,e.stream.length);e.frameList.push(t)},e.nextNalu=function(t=1){if(null==e.stream||e.stream.length<=4)return!1;let r=-1,i=null;for(let a=0;a<e.stream.length;a++){if(a+5>=e.stream.length)return!1;if(0==e.stream[a]&&0==e.stream[a+1]&&1==e.stream[a+2]||0==e.stream[a]&&0==e.stream[a+1]&&0==e.stream[a+2]&&1==e.stream[a+3]){let n=a;if(a+=3,-1==r)r=n;else{if(t<=1)return i=e.subBuf(r,n-1),i;t-=1}}}return!1},e.nextNalu2=function(t=1){if(null==e.stream||e.stream.length<=4)return!1;let r=-1,i=null;for(let a=0;a<e.stream.length;a++){if(a+5>=e.stream.length)return-1!=r&&(i=e.subBuf(r,e.stream.length-1),i);let n="0 0 1"==e.stream.slice(a,a+3).join(" "),s="0 0 0 1"==e.stream.slice(a,a+4).join(" ");if(n||s){let n=a;if(a+=3,-1==r)r=n;else{if(t<=1)return i=e.subBuf(r,n-1),i;t-=1}}}return!1},e}();onmessage=t=>{let r=t.data,i=null;switch(i=void 0===r.cmd||null===r.cmd?"":r.cmd,i){case"append-chunk":let t=r.data;e.appendStreamRet(t);let i=e.nextFrame();postMessage({cmd:"return-nalu",data:i,msg:"return-nalu",parseEmpty:e.checkEmpty(),streamEmpty:e.streamEmpty(),frameListEmpty:e.frameListEmpty()});break;case"get-nalu":let a=e.nextFrame();postMessage({cmd:"return-nalu",data:a,msg:"return-nalu",parseEmpty:e.checkEmpty(),streamEmpty:e.streamEmpty(),frameListEmpty:e.frameListEmpty()});break;case"last-nalu":let n=e.lastNalu();postMessage({cmd:"return-nalu",data:n,msg:"return-nalu",parseEmpty:e.checkEmpty(),streamEmpty:e.streamEmpty(),frameListEmpty:e.frameListEmpty()});break;case"stop":postMessage("parse - WORKER STOPPED: "+r),close()}}}))),e._workerParse.stopNaluInterval=!1,e._workerParse.parseEmpty=!1,e._workerParse.streamEmpty=!1,e._workerParse.frameListEmpty=!1,e._workerParse.onmessage=i=>{let a=i.data,n=null;if(n=void 0===a.cmd||null===a.cmd?"":a.cmd,"return-nalu"===n){let i=a.data,n=a.parseEmpty,s=a.streamEmpty,o=a.frameListEmpty;e._workerParse.parseEmpty=n,e._workerParse.streamEmpty=s,e._workerParse.frameListEmpty=o,!1===i||null==i?!0===e._workerFetch.onMsgFetchFinished&&!0===n&&(e._workerParse.stopNaluInterval=!0):(e.append265NaluFrame(i,t),t+=r,e._workerParse.postMessage({cmd:"get-nalu",data:null,msg:"get-nalu"}))}},this._workerFetch.postMessage({cmd:"start",url:this._play_url,type:this._protocol_type,msg:"start"})}}t.exports=f,window.H265webjsPlayer=r.H265webjsPlayer=()=>new f,n.testCheckAllSupport().then((e=>{window.YLPlayerSupport=e}))}).call(this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./audio/audio-aac-core":2,"./audio/audio-pcm-core":3,"./av-common":4,"./consts":5,"./native/mp4-player":7,"./native/nv-flvjs-core":8,"./opengl/cylopengl":9,"./probe":10,"./worker/create-worker-decoder":11,"./worker/create-worker-demuxer":12,"./worker/create_worker_ffdecoder":13}]},{},[14]);